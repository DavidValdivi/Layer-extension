<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MiniProgressBar.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.google.appinventor.client.explorer.commands</a> &gt; <span class="el_source">MiniProgressBar.java</span></div><h1>MiniProgressBar.java</h1><pre class="source lang-java linenums">// -*- mode: java; c-basic-offset: 2; -*-
// Copyright 2009-2011 Google, All Rights reserved
// Copyright 2011-2012 MIT, All rights reserved
// Released under the Apache License, Version 2.0
// http://www.apache.org/licenses/LICENSE-2.0
package com.google.appinventor.client.explorer.commands;

import com.google.gwt.user.client.DOM;
import com.google.gwt.user.client.Element;
import com.google.gwt.user.client.ui.Widget;
import com.google.gwt.widgetideas.client.ResizableWidget;
import com.google.gwt.widgetideas.client.ResizableWidgetCollection;

/**
 * A widget that displays progress on an arbitrary scale.
 *
 * &lt;h3&gt;CSS Style Rules&lt;/h3&gt;
 * &lt;ul class='css'&gt;
 * &lt;li&gt;.gwt-ProgressBar-shell { primary style } &lt;/li&gt;
 * &lt;li&gt;.gwt-ProgressBar-shell .gwt-ProgressBar-bar { the actual progress bar }
 * &lt;/li&gt;
 * &lt;li&gt;.gwt-ProgressBar-shell .gwt-ProgressBar-text { text on the bar } &lt;/li&gt;
 * &lt;li&gt;.gwt-ProgressBar-shell .gwt-ProgressBar-text-firstHalf { applied to text
 * when progress is less than 50 percent } &lt;/li&gt;
 * &lt;li&gt;.gwt-ProgressBar-shell .gwt-ProgressBar-text-secondHalf { applied to
 * text when progress is greater than 50 percent } &lt;/li&gt;
 * &lt;/ul&gt;
 */
public class MiniProgressBar extends Widget implements ResizableWidget {
  private static final String DEFAULT_TEXT_CLASS_NAME =
      &quot;gwt-ProgressBar-text&quot;;

<span class="nc" id="L33">  private String textClassName = DEFAULT_TEXT_CLASS_NAME;</span>
<span class="nc" id="L34">  private String textFirstHalfClassName = DEFAULT_TEXT_CLASS_NAME + &quot;-firstHalf&quot;;</span>
<span class="nc" id="L35">  private String textSecondHalfClassName = DEFAULT_TEXT_CLASS_NAME + &quot;-secondHalf&quot;;</span>

  /**
   * A formatter used to format the text displayed in the progress bar widget.
   */
<span class="nc" id="L40">  public abstract static class TextFormatter {</span>
    /**
     * Generate the text to display in the ProgressBar based on the current
     * value.
     *
     * Override this method to change the text displayed within the ProgressBar.
     *
     * @param bar the progress bar
     * @param curProgress the current progress
     * @return the text to display in the progress bar
     */
     protected abstract String getText(MiniProgressBar bar, double curProgress);
  }

  /**
   * The bar element that displays the progress.
   */
  private Element barElement;

  /**
   * The current progress.
   */
  private double curProgress;

  /**
   * The maximum progress.
   */
  private double maxProgress;

  /**
   * The minimum progress.
   */
  private double minProgress;

  /**
   * A boolean that determines if the text is visible.
   */
<span class="nc" id="L77">  private boolean textVisible = true;</span>

  /**
   * The element that displays text on the page.
   */
  private Element textElement;

  /**
   * The current text formatter.
   */
  private TextFormatter textFormatter;

  /**
   * Create a progress bar with default range of 0 to 100.
   */
  public MiniProgressBar() {
<span class="nc" id="L93">    this(0.0, 100.0, 0.0);</span>
<span class="nc" id="L94">  }</span>

  /**
   * Create a progress bar with an initial progress and a default range of 0 to
   * 100.
   *
   * @param curProgress the current progress
   */
  public MiniProgressBar(double curProgress) {
<span class="nc" id="L103">    this(0.0, 100.0, curProgress);</span>
<span class="nc" id="L104">  }</span>

  /**
   * Create a progress bar within the given range.
   *
   * @param minProgress the minimum progress
   * @param maxProgress the maximum progress
   */
  public MiniProgressBar(double minProgress, double maxProgress) {
<span class="nc" id="L113">    this(minProgress, maxProgress, 0.0);</span>
<span class="nc" id="L114">  }</span>

  /**
   * Create a progress bar within the given range starting at the specified
   * progress amount.
   *
   * @param minProgress the minimum progress
   * @param maxProgress the maximum progress
   * @param curProgress the current progress
   */
  public MiniProgressBar(double minProgress, double maxProgress, double curProgress) {
<span class="nc" id="L125">    this(minProgress, maxProgress, curProgress, null);</span>
<span class="nc" id="L126">  }</span>

  /**
   * Create a progress bar within the given range starting at the specified
   * progress amount.
   *
   * @param minProgress the minimum progress
   * @param maxProgress the maximum progress
   * @param curProgress the current progress
   * @param textFormatter the text formatter
   */
  public MiniProgressBar(double minProgress, double maxProgress,
<span class="nc" id="L138">    double curProgress, TextFormatter textFormatter) {</span>
<span class="nc" id="L139">    this.minProgress = minProgress;</span>
<span class="nc" id="L140">    this.maxProgress = maxProgress;</span>
<span class="nc" id="L141">    this.curProgress = curProgress;</span>
<span class="nc" id="L142">    setTextFormatter(textFormatter);</span>

    // Create the outer shell
<span class="nc" id="L145">    setElement(DOM.createDiv());</span>
<span class="nc" id="L146">    DOM.setStyleAttribute(getElement(), &quot;position&quot;, &quot;relative&quot;);</span>
<span class="nc" id="L147">    setStyleName(&quot;gwt-ProgressBar-shell&quot;);</span>

    // Create the bar element
<span class="nc" id="L150">    barElement = DOM.createDiv();</span>
<span class="nc" id="L151">    DOM.appendChild(getElement(), barElement);</span>
<span class="nc" id="L152">    DOM.setStyleAttribute(barElement, &quot;height&quot;, &quot;100%&quot;);</span>
<span class="nc" id="L153">    setBarStyleName(&quot;gwt-ProgressBar-bar&quot;);</span>

    // Create the text element
<span class="nc" id="L156">    textElement = DOM.createDiv();</span>
<span class="nc" id="L157">    DOM.appendChild(getElement(), textElement);</span>
<span class="nc" id="L158">    DOM.setStyleAttribute(textElement, &quot;position&quot;, &quot;absolute&quot;);</span>
<span class="nc" id="L159">    DOM.setStyleAttribute(textElement, &quot;top&quot;, &quot;0px&quot;);</span>

    //Set the current progress
<span class="nc" id="L162">    setProgress(curProgress);</span>
<span class="nc" id="L163">  }</span>

  /**
   * Get the maximum progress.
   *
   * @return the maximum progress
   */
  public double getMaxProgress() {
<span class="nc" id="L171">    return maxProgress;</span>
  }

  /**
   * Get the minimum progress.
   *
   * @return the minimum progress
   */
  public double getMinProgress() {
<span class="nc" id="L180">    return minProgress;</span>
  }

  /**
   * Get the current percent complete, relative to the minimum and maximum
   * values. The percent will always be between 0.0 - 1.0.
   *
   * @return the current percent complete
   */
  public double getPercent() {
    // If we have no range
<span class="nc bnc" id="L191" title="All 2 branches missed.">    if (maxProgress &lt;= minProgress) {</span>
<span class="nc" id="L192">      return 0.0;</span>
    }

    // Calculate the relative progress
<span class="nc" id="L196">    double percent = (curProgress - minProgress) / (maxProgress - minProgress);</span>
<span class="nc" id="L197">    return Math.max(0.0, Math.min(1.0, percent));</span>
  }

  /**
   * Get the current progress.
   *
   * @return the current progress
   */
  public double getProgress() {
<span class="nc" id="L206">    return curProgress;</span>
  }

  /**
   * Get the text formatter.
   *
   * @return the text formatter
   */
  public TextFormatter getTextFormatter() {
<span class="nc" id="L215">    return textFormatter;</span>
  }

  /**
   * Check whether the text is visible or not.
   *
   * @return true if the text is visible
   */
  public boolean isTextVisible() {
<span class="nc" id="L224">    return textVisible;</span>
  }

  /**
   * This method is called when the dimensions of the parent element change.
   * Subclasses should override this method as needed.
   *
   * Move the text to the center of the progress bar.
   *
   * @param width the new client width of the element
   * @param height the new client height of the element
   */
  public void onResize(int width, int height) {
<span class="nc bnc" id="L237" title="All 2 branches missed.">    if (textVisible) {</span>
<span class="nc" id="L238">      int textWidth = DOM.getElementPropertyInt(textElement, &quot;offsetWidth&quot;);</span>
<span class="nc" id="L239">      int left = (width / 2) - (textWidth / 2);</span>
<span class="nc" id="L240">      DOM.setStyleAttribute(textElement, &quot;left&quot;, left + &quot;px&quot;);</span>
    }
<span class="nc" id="L242">  }</span>

  /**
   * Redraw the progress bar when something changes the layout.
   */
  public void redraw() {
<span class="nc bnc" id="L248" title="All 2 branches missed.">    if (isAttached()) {</span>
<span class="nc" id="L249">      int width = DOM.getElementPropertyInt(getElement(), &quot;clientWidth&quot;);</span>
<span class="nc" id="L250">      int height = DOM.getElementPropertyInt(getElement(), &quot;clientHeight&quot;);</span>
<span class="nc" id="L251">      onResize(width, height);</span>
    }
<span class="nc" id="L253">  }</span>

  public void setBarStyleName(String barClassName) {
<span class="nc" id="L256">    DOM.setElementProperty(barElement, &quot;className&quot;, barClassName);</span>
<span class="nc" id="L257">  }</span>

  /**
   * Set the maximum progress. If the minimum progress is more than the current
   * progress, the current progress is adjusted to be within the new range.
   *
   * @param maxProgress the maximum progress
   */
  public void setMaxProgress(double maxProgress) {
<span class="nc" id="L266">    this.maxProgress = maxProgress;</span>
<span class="nc" id="L267">    curProgress = Math.min(curProgress, maxProgress);</span>
<span class="nc" id="L268">    resetProgress();</span>
<span class="nc" id="L269">  }</span>

  /**
   * Set the minimum progress. If the minimum progress is more than the current
   * progress, the current progress is adjusted to be within the new range.
   *
   * @param minProgress the minimum progress
   */
  public void setMinProgress(double minProgress) {
<span class="nc" id="L278">    this.minProgress = minProgress;</span>
<span class="nc" id="L279">    curProgress = Math.max(curProgress, minProgress);</span>
<span class="nc" id="L280">    resetProgress();</span>
<span class="nc" id="L281">  }</span>

  /**
   * Set the current progress.
   *
   * @param curProgress the current progress
   */
  public void setProgress(double curProgress) {
<span class="nc" id="L289">    this.curProgress = Math.max(minProgress, Math.min(maxProgress, curProgress));</span>

    // Calculate percent complete
<span class="nc" id="L292">    int percent = (int) (100 * getPercent());</span>
<span class="nc" id="L293">    DOM.setStyleAttribute(barElement, &quot;width&quot;, percent + &quot;%&quot;);</span>
<span class="nc" id="L294">    DOM.setElementProperty(textElement, &quot;innerHTML&quot;, generateText(curProgress));</span>
<span class="nc" id="L295">    updateTextStyle(percent);</span>

    // Realign the text
<span class="nc" id="L298">    redraw();</span>
<span class="nc" id="L299">  }</span>

  public void setTextFirstHalfStyleName(String textFirstHalfClassName) {
<span class="nc" id="L302">    this.textFirstHalfClassName = textFirstHalfClassName;</span>
<span class="nc" id="L303">    onTextStyleChange();</span>
<span class="nc" id="L304">  }</span>

  /**
   * Set the text formatter.
   *
   * @param textFormatter the text formatter
   */
  public void setTextFormatter(TextFormatter textFormatter) {
<span class="nc" id="L312">    this.textFormatter = textFormatter;</span>
<span class="nc" id="L313">  }</span>

  public void setTextSecondHalfStyleName(String textSecondHalfClassName) {
<span class="nc" id="L316">    this.textSecondHalfClassName = textSecondHalfClassName;</span>
<span class="nc" id="L317">    onTextStyleChange();</span>
<span class="nc" id="L318">  }</span>

  public void setTextStyleName(String textClassName) {
<span class="nc" id="L321">    this.textClassName = textClassName;</span>
<span class="nc" id="L322">    onTextStyleChange();</span>
<span class="nc" id="L323">  }</span>

  /**
   * Sets whether the text is visible over the bar.
   *
   * @param textVisible True to show text, false to hide it
   */
  public void setTextVisible(boolean textVisible) {
<span class="nc" id="L331">    this.textVisible = textVisible;</span>
<span class="nc bnc" id="L332" title="All 2 branches missed.">    if (this.textVisible) {</span>
<span class="nc" id="L333">      DOM.setStyleAttribute(textElement, &quot;display&quot;, &quot;&quot;);</span>
<span class="nc" id="L334">      redraw();</span>
    } else {
<span class="nc" id="L336">      DOM.setStyleAttribute(textElement, &quot;display&quot;, &quot;none&quot;);</span>
    }
<span class="nc" id="L338">  }</span>

  /**
   * Generate the text to display within the progress bar. Override this
   * function to change the default progress percent to a more informative
   * message, such as the number of kilobytes downloaded.
   *
   * @param curProgress the current progress
   * @return the text to display in the progress bar
   */
  protected String generateText(double curProgress) {
<span class="nc bnc" id="L349" title="All 2 branches missed.">    if (textFormatter != null) {</span>
<span class="nc" id="L350">      return textFormatter.getText(this, curProgress);</span>
    } else {
<span class="nc" id="L352">      return (int) (100 * getPercent()) + &quot;%&quot;;</span>
    }
  }

  /**
   * Get the bar element.
   *
   * @return the bar element
   */
  protected Element getBarElement() {
<span class="nc" id="L362">    return barElement;</span>
  }

  /**
   * Get the text element.
   *
   * @return the text element
   */
  protected Element getTextElement() {
<span class="nc" id="L371">    return textElement;</span>
  }

  /**
   * This method is called immediately after a widget becomes attached to the
   * browser's document.
   */
  @Override
  protected void onLoad() {
    // Reset the position attribute of the parent element
<span class="nc" id="L381">    DOM.setStyleAttribute(getElement(), &quot;position&quot;, &quot;relative&quot;);</span>
<span class="nc" id="L382">    ResizableWidgetCollection.get().add(this);</span>
<span class="nc" id="L383">    redraw();</span>
<span class="nc" id="L384">  }</span>

  @Override
  protected void onUnload() {
<span class="nc" id="L388">    ResizableWidgetCollection.get().remove(this);</span>
<span class="nc" id="L389">  }</span>

  /**
   * Reset the progress text based on the current min and max progress range.
   */
  protected void resetProgress() {
<span class="nc" id="L395">    setProgress(getProgress());</span>
<span class="nc" id="L396">  }</span>

  private void onTextStyleChange() {
<span class="nc" id="L399">    int percent = (int) (100 * getPercent());</span>
<span class="nc" id="L400">    updateTextStyle(percent);</span>
<span class="nc" id="L401">  }</span>

  private void updateTextStyle(int percent) {
    // Set the style depending on the size of the bar
<span class="nc bnc" id="L405" title="All 2 branches missed.">    if (percent &lt; 50) {</span>
<span class="nc" id="L406">      DOM.setElementProperty(textElement, &quot;className&quot;,</span>
          textClassName + &quot; &quot; + textFirstHalfClassName);
    } else {
<span class="nc" id="L409">      DOM.setElementProperty(textElement, &quot;className&quot;,</span>
          textClassName + &quot; &quot; + textSecondHalfClassName);
    }
<span class="nc" id="L412">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>