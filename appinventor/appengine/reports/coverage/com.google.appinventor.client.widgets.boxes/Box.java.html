<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Box.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.google.appinventor.client.widgets.boxes</a> &gt; <span class="el_source">Box.java</span></div><h1>Box.java</h1><pre class="source lang-java linenums">// -*- mode: java; c-basic-offset: 2; -*-
// Copyright 2009-2011 Google, All Rights reserved
// Copyright 2011-2012 MIT, All rights reserved
// Released under the Apache License, Version 2.0
// http://www.apache.org/licenses/LICENSE-2.0

package com.google.appinventor.client.widgets.boxes;

import com.google.appinventor.client.Images;
import com.google.appinventor.client.Ode;
import static com.google.appinventor.client.Ode.MESSAGES;
import com.google.appinventor.client.widgets.ContextMenu;
import com.google.appinventor.client.widgets.TextButton;
import com.google.appinventor.shared.properties.json.JSONObject;
import com.google.appinventor.shared.properties.json.JSONUtil;
import com.google.appinventor.shared.properties.json.JSONValue;
import com.google.gwt.event.dom.client.ClickEvent;
import com.google.gwt.event.dom.client.ClickHandler;
import com.google.gwt.user.client.Command;
import com.google.gwt.user.client.DOM;
import com.google.gwt.user.client.Element;
import com.google.gwt.user.client.Window;
import com.google.gwt.user.client.ui.DockPanel;
import com.google.gwt.user.client.ui.FlowPanel;
import com.google.gwt.user.client.ui.Image;
import com.google.gwt.user.client.ui.Label;
import com.google.gwt.user.client.ui.PopupPanel;
import com.google.gwt.user.client.ui.PushButton;
import com.google.gwt.user.client.ui.ScrollPanel;
import com.google.gwt.user.client.ui.SimplePanel;
import com.google.gwt.user.client.ui.VerticalPanel;
import com.google.gwt.user.client.ui.Widget;

import java.util.Map;

/**
 * Abstract superclass for all boxes.
 *
 * &lt;p&gt;A box is a container widget. It automatically handles scrolling for
 * embedded widgets. Boxes can be resized, minimized and restored.
 *
 */
public abstract class Box extends HandlerPanel {

  /**
   * Describes a box in the context of a layout.
   */
  public static final class BoxDescriptor {
    // Field names for JSON encoding of box descriptors
    private static final String NAME_TYPE = &quot;type&quot;;
    private static final String NAME_WIDTH = &quot;width&quot;;
    private static final String NAME_HEIGHT = &quot;height&quot;;
    private static final String NAME_MINIMIZED = &quot;minimized&quot;;

    // Information needed to create a box in a layout
    private final String type;
    private final int width;
    private final int height;
    private final boolean minimized;

    /**
     * Creates a new box description.
     *
     * @param type  type of box
     * @param width  width of box in pixels
     * @param height  height of box in pixels if not minimized
     * @param minimized  indicates whether box is minimized
     */
<span class="nc" id="L69">    private BoxDescriptor(String type, int width, int height, boolean minimized) {</span>
<span class="nc" id="L70">      this.type = type;</span>
<span class="nc" id="L71">      this.width = width;</span>
<span class="nc" id="L72">      this.height = height;</span>
<span class="nc" id="L73">      this.minimized = minimized;</span>
<span class="nc" id="L74">    }</span>

    /**
     * Creates a new box description.
     *
     * @param type  type of box
     * @param width  width of box in pixels
     * @param height  height of box in pixels if not minimized
     * @param minimized  indicates whether box is minimized
     */
    public BoxDescriptor(Class&lt;? extends Box&gt; type, int width, int height, boolean minimized) {
<span class="nc" id="L85">      this(type.getName(), width, height, minimized);</span>
<span class="nc" id="L86">    }</span>

    /**
     * Returns the box type (for use by a {@link BoxRegistry}).
     *
     * @return  box type
     */
    public String getType() {
<span class="nc" id="L94">      return type;</span>
    }

    /**
     * Encodes the box information into JSON format.
     */
    public String toJson() {
<span class="nc" id="L101">      return &quot;{&quot; +</span>
<span class="nc" id="L102">            &quot;\&quot;&quot; + NAME_TYPE + &quot;\&quot;:&quot; + JSONUtil.toJson(type) + &quot;,&quot; +</span>
<span class="nc" id="L103">            &quot;\&quot;&quot; + NAME_WIDTH + &quot;\&quot;:&quot; + JSONUtil.toJson(width) + &quot;,&quot; +</span>
<span class="nc" id="L104">            &quot;\&quot;&quot; + NAME_HEIGHT + &quot;\&quot;:&quot; + JSONUtil.toJson(height) + &quot;,&quot; +</span>
<span class="nc" id="L105">            &quot;\&quot;&quot; + NAME_MINIMIZED + &quot;\&quot;:&quot; + JSONUtil.toJson(minimized) +</span>
          &quot;}&quot;;
    }

    /**
     * Creates a new box descriptor from a JSON object.
     *
     * @param object  box descriptor in JSON format
     */
    public static BoxDescriptor fromJson(JSONObject object) {
<span class="nc" id="L115">      Map&lt;String, JSONValue&gt; properties = object.getProperties();</span>

<span class="nc" id="L117">      return new BoxDescriptor(JSONUtil.stringFromJsonValue(properties.get(NAME_TYPE)),</span>
<span class="nc" id="L118">          JSONUtil.intFromJsonValue(properties.get(NAME_WIDTH)),</span>
<span class="nc" id="L119">          JSONUtil.intFromJsonValue(properties.get(NAME_HEIGHT)),</span>
<span class="nc" id="L120">          JSONUtil.booleanFromJsonValue(properties.get(NAME_MINIMIZED)));</span>
    }

    /**
     * Returns the type of box from a JSON object.
     *
     * @param object  box descriptor in JSON format
     */
    public static String boxTypeFromJson(JSONObject object) {
<span class="nc" id="L129">      Map&lt;String, JSONValue&gt; properties = object.getProperties();</span>

<span class="nc" id="L131">      return JSONUtil.stringFromJsonValue(properties.get(NAME_TYPE));</span>
    }
  }

  /**
   * Control for resizing boxes.
   */
  private final class ResizeControl extends PopupPanel {

    /**
     * Creates a control to resize the box.
     */
<span class="nc" id="L143">    private ResizeControl() {</span>
<span class="nc" id="L144">      super(false); // no autohide</span>

<span class="nc" id="L146">      VerticalPanel buttonPanel = new VerticalPanel();</span>
<span class="nc" id="L147">      buttonPanel.setSpacing(10);</span>
<span class="nc" id="L148">      addControlButton(buttonPanel, &quot;-&quot;, new Command() {</span>
        @Override
        public void execute() {
<span class="nc" id="L151">          height = Math.max(100, height - 20);</span>
<span class="nc" id="L152">          restoreHeight = height;</span>
<span class="nc" id="L153">          onResize(width, height);</span>
<span class="nc" id="L154">        }</span>
      });
<span class="nc" id="L156">      addControlButton(buttonPanel, &quot;+&quot;, new Command() {</span>
        @Override
        public void execute() {
<span class="nc" id="L159">          height = height + 20;</span>
<span class="nc" id="L160">          restoreHeight = height;</span>
<span class="nc" id="L161">          onResize(width, height);</span>
<span class="nc" id="L162">        }</span>
      });
<span class="nc" id="L164">      addControlButton(buttonPanel, MESSAGES.done(), new Command() {</span>
        @Override
        public void execute() {
<span class="nc" id="L167">          hide();</span>
<span class="nc" id="L168">        }</span>
      });
<span class="nc" id="L170">      add(buttonPanel);</span>

<span class="nc" id="L172">      setModal(true);</span>
<span class="nc" id="L173">      setStylePrimaryName(&quot;ode-BoxResizeControl&quot;);</span>
<span class="nc" id="L174">    }</span>

    /**
     * Creates a button with a click handler which will execute the given command.
     */
    private void addControlButton(VerticalPanel panel, String caption, final Command command) {
<span class="nc" id="L180">      TextButton button = new TextButton(caption);</span>
<span class="nc" id="L181">      button.addClickHandler(new ClickHandler() {</span>
        @Override
        public void onClick(ClickEvent event) {
<span class="nc" id="L184">          command.execute();</span>
<span class="nc" id="L185">        }</span>
      });
<span class="nc" id="L187">      panel.add(button);</span>
<span class="nc" id="L188">      panel.setCellHorizontalAlignment(button, VerticalPanel.ALIGN_CENTER);</span>
<span class="nc" id="L189">    }</span>
  }

  // Height of minimized box
  private static final int MINIMIZED_HEIGHT = 31;

  // Padding between header controls
  private static final int HEADER_CONTROL_PADDING = 2;

  // Constants for box decorations (note that these constants correspond to the box's style
  // definition)
  private static final int BOX_PADDING = 5;
  private static final int BOX_BORDER = 1;

  // UI elements
  private final SimplePanel body;
  private final Label captionLabel;
  private final HandlerPanel header;
  private final DockPanel headerContainer;
  private final ScrollPanel scrollPanel;
  private final PushButton minimizeButton;
  private final PushButton menuButton;

  // Indicates that the box height is changed through resize operations of the layout
  private boolean variableHeightBoxes;

  // Box dimensions
  private int width;
  private int height;

  // Height of non-minimized box
  private int restoreHeight;

  // Whether box should always begin minimized
  private boolean startMinimized;

  // Whether new captions should be highlighted
  private boolean highlightCaption;

  // Whether user has seen/acknowledged the new caption yet
<span class="nc" id="L229">  private boolean captionAlreadySeen = false;</span>

  /**
   * Creates a new box.
   *
   * @param caption  box caption
   * @param height  box initial height in pixel
   * @param minimizable  indicates whether box can be minimized
   * @param removable  indicates whether box can be closed/removed
   * @param startMinimized indicates whether box should always start minimized
   * @param bodyPadding indicates whether box should have padding
   * @param highlightCaption indicates whether caption should be highlighted
   *                         until user has &quot;seen&quot; it (interacts with the box)
   */
  protected Box(String caption, int height, boolean minimizable, boolean removable,
<span class="nc" id="L244">      boolean startMinimized, boolean bodyPadding, boolean highlightCaption) {</span>
<span class="nc" id="L245">    this.height = height;</span>
<span class="nc" id="L246">    this.restoreHeight = height;</span>
<span class="nc" id="L247">    this.startMinimized = startMinimized;</span>
<span class="nc" id="L248">    this.highlightCaption = highlightCaption;</span>

<span class="nc" id="L250">    captionLabel = new Label(caption, false);</span>
<span class="nc" id="L251">    captionAlreadySeen = false;</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">    if (highlightCaption) {</span>
<span class="nc" id="L253">      captionLabel.setStylePrimaryName(&quot;ode-Box-header-caption-highlighted&quot;);</span>
    } else {
<span class="nc" id="L255">      captionLabel.setStylePrimaryName(&quot;ode-Box-header-caption&quot;);</span>
    }
<span class="nc" id="L257">    header = new HandlerPanel();</span>
<span class="nc" id="L258">    header.add(captionLabel);</span>
<span class="nc" id="L259">    header.setWidth(&quot;100%&quot;);</span>

<span class="nc" id="L261">    headerContainer = new DockPanel();</span>
<span class="nc" id="L262">    headerContainer.setStylePrimaryName(&quot;ode-Box-header&quot;);</span>
<span class="nc" id="L263">    headerContainer.setWidth(&quot;100%&quot;);</span>
<span class="nc" id="L264">    headerContainer.add(header, DockPanel.LINE_START);</span>

<span class="nc" id="L266">    Images images = Ode.getImageBundle();</span>

<span class="nc bnc" id="L268" title="All 2 branches missed.">    if (removable) {</span>
<span class="nc" id="L269">      PushButton closeButton = Ode.createPushButton(images.boxClose(), MESSAGES.hdrClose(),</span>
<span class="nc" id="L270">          new ClickHandler() {</span>
            @Override
            public void onClick(ClickEvent event) {
              // TODO(user) - remove the box
<span class="nc" id="L274">              Window.alert(&quot;Not implemented yet!&quot;);</span>
<span class="nc" id="L275">            }</span>
          });
<span class="nc" id="L277">      headerContainer.add(closeButton, DockPanel.LINE_END);</span>
<span class="nc" id="L278">      headerContainer.setCellWidth(closeButton,</span>
<span class="nc" id="L279">          (closeButton.getOffsetWidth() + HEADER_CONTROL_PADDING) + &quot;px&quot;);</span>
    }

<span class="nc bnc" id="L282" title="All 2 branches missed.">    if (!minimizable) {</span>
<span class="nc" id="L283">      minimizeButton = null;</span>
    } else {
<span class="nc" id="L285">      minimizeButton = Ode.createPushButton(images.boxMinimize(), MESSAGES.hdrMinimize(),</span>
<span class="nc" id="L286">          new ClickHandler() {</span>
            @Override
            public void onClick(ClickEvent event) {
<span class="nc bnc" id="L289" title="All 2 branches missed.">              if (isMinimized()) {</span>
<span class="nc" id="L290">                restore();</span>
              } else {
<span class="nc" id="L292">                minimize();</span>
              }
<span class="nc" id="L294">            }</span>
          });
<span class="nc" id="L296">      headerContainer.add(minimizeButton, DockPanel.LINE_END);</span>
<span class="nc" id="L297">      headerContainer.setCellWidth(minimizeButton,</span>
<span class="nc" id="L298">          (minimizeButton.getOffsetWidth() + HEADER_CONTROL_PADDING) + &quot;px&quot;);</span>
    }

<span class="nc bnc" id="L301" title="All 4 branches missed.">    if (minimizable || removable) {</span>
<span class="nc" id="L302">      menuButton = Ode.createPushButton(images.boxMenu(), MESSAGES.hdrSettings(),</span>
<span class="nc" id="L303">          new ClickHandler() {</span>
            @Override
            public void onClick(ClickEvent event) {
<span class="nc" id="L306">              final ContextMenu contextMenu = new ContextMenu();</span>
<span class="nc" id="L307">              contextMenu.addItem(MESSAGES.cmMinimize(), new Command() {</span>
                @Override
                public void execute() {
<span class="nc bnc" id="L310" title="All 2 branches missed.">                  if (! isMinimized()) {</span>
<span class="nc" id="L311">                    minimize();</span>
                  }
<span class="nc" id="L313">                }</span>
              });
<span class="nc" id="L315">              contextMenu.addItem(MESSAGES.cmRestore(), new Command() {</span>
                @Override
                public void execute() {
<span class="nc bnc" id="L318" title="All 2 branches missed.">                  if (isMinimized()) {</span>
<span class="nc" id="L319">                    restore();</span>
                  }
<span class="nc" id="L321">                }</span>
              });
<span class="nc bnc" id="L323" title="All 2 branches missed.">              if (!variableHeightBoxes) {</span>
<span class="nc" id="L324">                contextMenu.addItem(MESSAGES.cmResize(), new Command() {</span>
                  @Override
                  public void execute() {
<span class="nc" id="L327">                    restore();</span>
<span class="nc" id="L328">                    final ResizeControl resizeControl = new ResizeControl();</span>
<span class="nc" id="L329">                    resizeControl.setPopupPositionAndShow(new PopupPanel.PositionCallback() {</span>
                      @Override
                      public void setPosition(int offsetWidth, int offsetHeight) {
                        // SouthEast
<span class="nc" id="L333">                        int left = menuButton.getAbsoluteLeft() + menuButton.getOffsetWidth()</span>
                            - offsetWidth;
<span class="nc" id="L335">                        int top = menuButton.getAbsoluteTop() + menuButton.getOffsetHeight();</span>
<span class="nc" id="L336">                        resizeControl.setPopupPosition(left, top);</span>
<span class="nc" id="L337">                      }</span>
                    });
<span class="nc" id="L339">                  }</span>
                });
              }
<span class="nc" id="L342">              contextMenu.setPopupPositionAndShow(new PopupPanel.PositionCallback() {</span>
                @Override
                public void setPosition(int offsetWidth, int offsetHeight) {
                  // SouthEast
<span class="nc" id="L346">                  int left = menuButton.getAbsoluteLeft() + menuButton.getOffsetWidth()</span>
                      - offsetWidth;
<span class="nc" id="L348">                  int top = menuButton.getAbsoluteTop() + menuButton.getOffsetHeight();</span>
<span class="nc" id="L349">                  contextMenu.setPopupPosition(left, top);</span>
<span class="nc" id="L350">                }</span>
              });
<span class="nc" id="L352">            }</span>
          });
<span class="nc" id="L354">      headerContainer.add(menuButton, DockPanel.LINE_END);</span>
<span class="nc" id="L355">      headerContainer.setCellWidth(menuButton,</span>
<span class="nc" id="L356">          (menuButton.getOffsetWidth() + HEADER_CONTROL_PADDING) + &quot;px&quot;);</span>
    } else {
<span class="nc" id="L358">      menuButton = null;</span>
    }

<span class="nc" id="L361">    body = new SimplePanel();</span>
<span class="nc" id="L362">    body.setSize(&quot;100%&quot;, &quot;100%&quot;);</span>

<span class="nc" id="L364">    scrollPanel = new ScrollPanel();</span>
<span class="nc" id="L365">    scrollPanel.setStylePrimaryName(&quot;ode-Box-body&quot;);</span>
<span class="nc bnc" id="L366" title="All 2 branches missed.">    if (bodyPadding) {</span>
<span class="nc" id="L367">      scrollPanel.addStyleName(&quot;ode-Box-body-padding&quot;);</span>
    }
<span class="nc" id="L369">    scrollPanel.add(body);</span>

<span class="nc" id="L371">    FlowPanel boxContainer = new FlowPanel();</span>
<span class="nc" id="L372">    boxContainer.setStyleName(&quot;ode-Box-content&quot;);</span>
<span class="nc" id="L373">    boxContainer.add(headerContainer);</span>
<span class="nc" id="L374">    boxContainer.add(scrollPanel);</span>

<span class="nc" id="L376">    setStylePrimaryName(&quot;ode-Box&quot;);</span>
<span class="nc" id="L377">    setWidget(boxContainer);</span>
<span class="nc" id="L378">  }</span>

  protected Box(String caption, int height, boolean minimizable, boolean removable,
      boolean startMinimized, boolean highlightCaption) {
<span class="nc" id="L382">    this(caption, height, minimizable, removable, startMinimized, true, highlightCaption);</span>
<span class="nc" id="L383">  }</span>

  protected Box(String caption, int height, boolean minimizable, boolean removable,
      boolean startMinimized) {
<span class="nc" id="L387">    this(caption, height, minimizable, removable, startMinimized, true, false);</span>
<span class="nc" id="L388">  }</span>

  protected Box(String caption, int height, boolean minimizable, boolean removable) {
<span class="nc" id="L391">    this(caption, height, minimizable, removable, false, true, false);</span>
<span class="nc" id="L392">  }</span>

  @Override
  public void clear() {
<span class="nc" id="L396">    body.clear();</span>
<span class="nc" id="L397">  }</span>

  /**
   * Sets the resizing behavior of the box.
   *
   * @param variableHeightBoxes  indicates whether the box height will be
   *                             updated upon layout resize operations
   */
  public void setVariableHeightBoxes(boolean variableHeightBoxes) {
<span class="nc" id="L406">    this.variableHeightBoxes = variableHeightBoxes;</span>
<span class="nc" id="L407">  }</span>

  /**
   * Shows the given widget in the box.
   *
   * @param w  widget to show
   */
  public void setContent(Widget w) {
<span class="nc" id="L415">    body.setWidget(w);</span>
<span class="nc" id="L416">  }</span>

  /**
   * Sets the given caption for the box.
   *
   * @param caption  box caption to show
   */
  public void setCaption(String caption) {
<span class="nc bnc" id="L424" title="All 2 branches missed.">    if (highlightCaption) {</span>
<span class="nc" id="L425">      captionLabel.setStylePrimaryName(&quot;ode-Box-header-caption-highlighted&quot;);</span>
<span class="nc" id="L426">      captionAlreadySeen = false;</span>
    }
<span class="nc" id="L428">    captionLabel.setText(caption);</span>
<span class="nc" id="L429">  }</span>

  /**
   * Returns the box header.
   *
   * @return  box header widget
   */
  Widget getHeader() {
<span class="nc" id="L437">    return header;</span>
  }

  /**
   * Invoked upon resizing of the box by the layout. Box height will remain
   * unmodified.
   *
   * @see Layout#onResize(int, int)
   *
   * @param width  new column width for box in pixel
   */
  protected void onResize(int width) {
<span class="nc" id="L449">    onResize(width, height);</span>
<span class="nc" id="L450">  }</span>

  /**
   * Invoked upon resizing of the box by the layout.
   *
   * @see Layout#onResize(int, int)
   *
   * @param width  new column width for box in pixel
   * @param height  new column height for box in pixel
   */
  protected void onResize(int width, int height) {
<span class="nc" id="L461">    this.width = width;</span>
<span class="nc" id="L462">    this.height = height;</span>

<span class="nc bnc" id="L464" title="All 2 branches missed.">    if (!isMinimized()) {</span>
<span class="nc" id="L465">      restoreHeight = height;</span>
    }

<span class="nc" id="L468">    setSize(this.width + &quot;px&quot;, this.height + &quot;px&quot;);</span>

    // In order to get the correct size for the scroll panel we need to subtract the dimensions
    // of all decorations such as padding, borders, margin etc. It is also important to set the size
    // for the scroll panel in pixels, as this seems to be the only reliably working unit.
    // We subtract padding and border sizes from top and bottom as well as the height of the box
    // header.
<span class="nc" id="L475">    int w = getOffsetWidth() - 2 * (BOX_PADDING + BOX_BORDER);</span>
<span class="nc" id="L476">    int h = getOffsetHeight() - 2 * (BOX_PADDING + BOX_BORDER) - headerContainer.getOffsetHeight();</span>

    // On startup it can happen that we receive a window resize event before the boxes are attached
    // to the DOM. In that case, offset width and height are 0, we can safely abort because there
    // will soon be another resize event after the boxes are attached to the DOM.
<span class="nc bnc" id="L481" title="All 4 branches missed.">    if (w &gt; 0 &amp;&amp; h &gt; 0) {</span>
<span class="nc" id="L482">      scrollPanel.setSize(w + &quot;px&quot;, h + &quot;px&quot;);</span>
    }
<span class="nc" id="L484">  }</span>

  /**
   * Restores the box layout.
   *
   * @param bd  box descriptor with layout settings of box
   */
  public void restoreLayoutSettings(BoxDescriptor bd) {
<span class="nc" id="L492">    restoreHeight = bd.height;</span>
<span class="nc" id="L493">    height = bd.height;</span>

<span class="nc bnc" id="L495" title="All 4 branches missed.">    if (bd.minimized || startMinimized) {</span>
<span class="nc" id="L496">      minimize();</span>
    } else {
<span class="nc" id="L498">      restore();</span>
    }
<span class="nc" id="L500">  }</span>

  /**
   * Returns box layout settings.
   *
   * @return  box layout settings
   */
  public BoxDescriptor getLayoutSettings() {
<span class="nc" id="L508">    return new BoxDescriptor(getClass().getName(), width, restoreHeight, isMinimized());</span>
  }

  /**
   * Indicates whether the box is minimized.
   */
  private boolean isMinimized() {
<span class="nc bnc" id="L515" title="All 2 branches missed.">    return height != restoreHeight;</span>
  }

  /**
   * Minimizes a box.
   */
  private void minimize() {
<span class="nc" id="L522">    scrollPanel.setVisible(false);</span>
<span class="nc" id="L523">    minimizeButton.getUpFace().setImage(new Image(Ode.getImageBundle().boxRestore()));</span>
<span class="nc" id="L524">    minimizeButton.setTitle(MESSAGES.hdrRestore());</span>

<span class="nc bnc" id="L526" title="All 4 branches missed.">    if (highlightCaption &amp;&amp; captionAlreadySeen) {</span>
<span class="nc" id="L527">      captionLabel.setStylePrimaryName(&quot;ode-Box-header-caption&quot;);</span>
    }
<span class="nc" id="L529">    captionAlreadySeen = true;</span>

<span class="nc" id="L531">    restoreHeight = height;</span>
<span class="nc" id="L532">    height = MINIMIZED_HEIGHT;</span>
<span class="nc" id="L533">    onResize(width, height);</span>
<span class="nc" id="L534">  }</span>

  /**
   * Restores a minimized box to its previous height.
   */
  private void restore() {
<span class="nc" id="L540">    minimizeButton.getUpFace().setImage(new Image(Ode.getImageBundle().boxMinimize()));</span>
<span class="nc" id="L541">    minimizeButton.setTitle(MESSAGES.hdrMinimize());</span>
<span class="nc" id="L542">    scrollPanel.setVisible(true);</span>

<span class="nc bnc" id="L544" title="All 4 branches missed.">    if (highlightCaption &amp;&amp; captionAlreadySeen) {</span>
<span class="nc" id="L545">      captionLabel.setStylePrimaryName(&quot;ode-Box-header-caption&quot;);</span>
    }
<span class="nc" id="L547">    captionAlreadySeen = true;</span>

<span class="nc" id="L549">    height = restoreHeight;</span>
<span class="nc" id="L550">    onResize(width, height);</span>
<span class="nc" id="L551">  }</span>

  /**
   * Helper method for adding style elements (in particular the rounded corners).
   */
  private void appendDecorationElement(String styleClass) {
<span class="nc" id="L557">    Element element = DOM.createDiv();</span>
<span class="nc" id="L558">    element.setClassName(styleClass);</span>
<span class="nc" id="L559">    getElement().appendChild(element);</span>
<span class="nc" id="L560">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>