<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MockChartDataModel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.google.appinventor.client.editor.simple.components</a> &gt; <span class="el_source">MockChartDataModel.java</span></div><h1>MockChartDataModel.java</h1><pre class="source lang-java linenums">// -*- mode: java; c-basic-offset: 2; -*-
// Copyright 2019-2022 MIT, All rights reserved
// Released under the Apache License, Version 2.0
// http://www.apache.org/licenses/LICENSE-2.0

package com.google.appinventor.client.editor.simple.components;

import java.util.List;
import org.pepstock.charba.client.data.Data;
import org.pepstock.charba.client.data.Dataset;

/**
 * Chart Data Model base class.
 *
 * &lt;p&gt;The Data Model is responsible for handling data operations
 * of a Chart, and represents the data of a single Data Series.
 * Individual styling and options of a single Data Series is also
 * a responsibility of the Data Model class.
 *
 * @param &lt;D&gt;  Dataset used by the model (Charba Dataset)
 * @param &lt;V&gt;  Chart view type that generated the model (MockChartView (sub)class)
 */
public abstract class MockChartDataModel&lt;D extends Dataset, V extends MockChartView&lt;D, ?, V&gt;&gt; {
  protected D dataSeries;
  protected V view;
  protected Data chartData;

  /**
   * Creates a new Mock Chart Model object instance, linking it with
   * the specified Chart view.
   *
   * @param view  Mock Chart view to link the model to
   */
<span class="nc" id="L34">  protected MockChartDataModel(V view) {</span>
<span class="nc" id="L35">    this.view = view;</span>
<span class="nc" id="L36">    this.chartData = view.getChartWidget().getData();</span>
<span class="nc" id="L37">  }</span>

  public D getDataSeries() {
<span class="nc" id="L40">    return this.dataSeries;</span>
  }

  /**
   * Changes the Color of the Data Series.
   *
   * @param color New Color value in &amp;HAARRGGBB format.
   */
  public abstract void changeColor(String color);

  /**
   * Changes the label of the Data Series.
   *
   * @param text New text value
   */
  public void changeLabel(String text) {
<span class="nc" id="L56">    dataSeries.setLabel(text);</span>
<span class="nc" id="L57">  }</span>

  /**
   * Adds the data series of this object to the Chart.
   */
  protected void addDataSeriesToChart() {
    // When adding the first Data Series, it should be set
    // to the Chart Data object itself rather then appended,
    // to register the first (new) DataSet List to the Chart data.
    // Subsequent adding of Data Series objects can simply be added
    // to the end of the List.
<span class="nc bnc" id="L68" title="All 2 branches missed.">    if (chartData.getDatasets().size() == 0) {</span>
<span class="nc" id="L69">      chartData.setDatasets(dataSeries);</span>
    } else {
<span class="nc" id="L71">      chartData.getDatasets().add(dataSeries);</span>
    }
<span class="nc" id="L73">  }</span>

  /**
   * Removes the Data Series from the Chart.
   */
  public void removeDataSeriesFromChart() {
<span class="nc" id="L79">    chartData.getDatasets().remove(dataSeries);</span>
<span class="nc" id="L80">  }</span>

  /**
   * Converts an ARGB color to RGB hex format.
   *
   * @param color &amp;HAARRGGBB format color string
   * @return #RRGGBB format color string
   */
  protected String getHexColor(String color) {
    // The idea: Remove &amp;H at the beginning, replace with # and reorder ARGB to RGB
<span class="nc" id="L90">    return &quot;#&quot; + color.substring(4);</span>
  }

  /**
   * Sets the elements of the Data Series from a CSV-formatted String.
   *
   * @param elements String in CSV format
   */
  public void setElements(String elements) {
    // Split the entries by the comma
    // TODO: Possibly move this to the server side? (commas not escaped with this approach)
<span class="nc" id="L101">    String[] entries = elements.split(&quot;,&quot;);</span>

    // Clear the current entries
<span class="nc" id="L104">    clearEntries();</span>

    // Get the tuple size of the Data Model
<span class="nc" id="L107">    int tupleSize = getTupleSize();</span>

    // The tuples are grouped together and then added to the
    // Data Model in this loop
<span class="nc bnc" id="L111" title="All 2 branches missed.">    for (int i = 0; i &lt; entries.length; i += tupleSize) {</span>
      /* (i, i + 1, ..., i + tupleSize - 1) forms the tuple
         E.g.: i = 0, tupleSize = 2, (0, 1) indexes represent the tuple
         Therefore if the last index is greater than the length of entries,
         the tuple group is invalid and the method should return. */
<span class="nc bnc" id="L116" title="All 2 branches missed.">      if (i + tupleSize - 1 &gt;= entries.length) {</span>
<span class="nc" id="L117">        break;</span>
      }

      // Create an array having the capacity to hold a tuple
<span class="nc" id="L121">      String[] tuple = new String[tupleSize];</span>

      // Copy the appropriate elements to the tuple
<span class="nc" id="L124">      System.arraycopy(entries, i, tuple, 0, tupleSize);</span>

      // Add the tuple to the Data Model
<span class="nc" id="L127">      addEntryFromTuple(tuple);</span>
    }

    // Perform the defined action after data import
<span class="nc" id="L131">    postDataImportAction();</span>
<span class="nc" id="L132">  }</span>

  /**
   * Sets the default elements for the Data Model.
   * To be called when no data is specified.
   */
  protected abstract void setDefaultElements();

  /**
   * Sets the default styling properties of the Data Series.
   */
  protected void setDefaultStylingProperties() {
    /* Method body empty since no default styling properties
       apply for all data models at once. To be overriden (if needed)
       by subclasses. The method was left empty to avoid too many
       empty overriden methods for the styling properties, and if
       in the future some default styling properties apply to all
       models at once, it would be more convenient to have this method
       non-abstract.
    */
<span class="nc" id="L152">  }</span>

  /**
   * Sets the elements of the Data Series from the specified columns.
   *
   * @param columns List of columns to import from
   */
  public void setElementsFromColumns(List&lt;List&lt;String&gt;&gt; columns) {
    // Clear the current entries
<span class="nc" id="L161">    clearEntries();</span>

    // Initially, the row size of the columns has to be determined
<span class="nc" id="L164">    int rows = 0;</span>

<span class="nc bnc" id="L166" title="All 2 branches missed.">    for (List&lt;String&gt; strings : columns) {</span>
<span class="nc" id="L167">      int columnSize = strings.size();</span>

      // Bigger column found; Update rows entry
<span class="nc bnc" id="L170" title="All 2 branches missed.">      if (columnSize &gt; rows) {</span>
<span class="nc" id="L171">        rows = columnSize;</span>
      }
<span class="nc" id="L173">    }</span>

    // Iterate through all the rows (except the first, which is the columnNames)
<span class="nc bnc" id="L176" title="All 2 branches missed.">    for (int i = 1; i &lt; rows; ++i) {</span>
      // Create an array that can hold all the tuple entries
<span class="nc" id="L178">      String[] tuple = new String[getTupleSize()];</span>

      // Iterate through all the columns.
      // Column size is the same as the tuple size
<span class="nc bnc" id="L182" title="All 2 branches missed.">      for (int j = 0; j &lt; getTupleSize(); ++j) {</span>
<span class="nc" id="L183">        List&lt;String&gt; column = columns.get(j);</span>

<span class="nc bnc" id="L185" title="All 2 branches missed.">        if (column.size() == 0) { // Empty column; Use default value</span>
<span class="nc" id="L186">          tuple[j] = getDefaultTupleEntry(i - 1); // Minus one to compensate for skipped entry</span>
<span class="nc bnc" id="L187" title="All 2 branches missed.">        } else if (column.size() &gt; i) {</span>
          // Column has value; Use the column's value (if the column is large enough)
<span class="nc" id="L189">          tuple[j] = column.get(i);</span>
        } else {
          // Column too small; Use empty String (up for interpretation
          // for addEntryFromTuple)
<span class="nc" id="L193">          tuple[j] = &quot;&quot;;</span>
        }
      }

      // Add the constructed tuple as an entry to the Data Model
<span class="nc" id="L198">      addEntryFromTuple(tuple);</span>
    }

    // Perform the defined action after data import
<span class="nc" id="L202">    postDataImportAction();</span>
<span class="nc" id="L203">  }</span>

  /**
   * Adds an entry to the Data Model from the specified tuple (List of Strings),
   * where each String in the list represents an entry of the tuple.
   *
   * @param tuple List of entries (Strings) forming the tuple
   */
  public abstract void addEntryFromTuple(String... tuple);

  /**
   * Returns the default entry to use for the specified index value.
   * To be used when data is not present, and a default value substitute
   * has to be used.
   *
   * @param index index to create a default entry for
   * @return default entry (String)
   */
  protected abstract String getDefaultTupleEntry(int index);

  /**
   * Clears all the entries in the Data Series.
   */
  public abstract void clearEntries();

  /**
   * Action performed after data importing.
   * To be called after each data importing method.
   *
   * &lt;p&gt;The most common example of such action is setting
   * default elements in case no data is present.
   */
  protected abstract void postDataImportAction();

  /**
   * Returns the size of the tuples that this Data Series
   * accepts.
   *
   * @return tuple size (integer)
   */
  protected abstract int getTupleSize();
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>