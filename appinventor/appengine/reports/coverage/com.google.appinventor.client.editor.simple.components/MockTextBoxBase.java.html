<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MockTextBoxBase.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.google.appinventor.client.editor.simple.components</a> &gt; <span class="el_source">MockTextBoxBase.java</span></div><h1>MockTextBoxBase.java</h1><pre class="source lang-java linenums">// -*- mode: java; c-basic-offset: 2; -*-
// Copyright 2009-2011 Google, All Rights reserved
// Copyright 2011-2012 MIT, All rights reserved
// Released under the Apache License, Version 2.0
// http://www.apache.org/licenses/LICENSE-2.0

package com.google.appinventor.client.editor.simple.components;

import static com.google.appinventor.client.Ode.MESSAGES;
import com.google.appinventor.client.editor.simple.SimpleEditor;
import com.google.appinventor.client.editor.youngandroid.YaFormEditor;
import com.google.appinventor.components.common.ComponentConstants;
import com.google.gwt.resources.client.ImageResource;
import com.google.gwt.user.client.DOM;
import com.google.gwt.user.client.ui.TextBox;
import com.google.gwt.user.client.ui.Widget;


/**
 * Abstract superclass for textbox based mock components.
 *
 * @author sharon@google.com (Sharon Perl)
 * @author lizlooney@google.com (Liz Looney)
 */
abstract class MockTextBoxBase extends MockWrapper implements FormChangeListener{

  // GWT widget used to mock a Simple TextBox
  private final TextBox textBoxWidget;

  /**
   * Creates a new MockTextBox component.
   *
   * @param editor  editor of source file the component belongs to
   */
  MockTextBoxBase(SimpleEditor editor, String type, ImageResource icon) {
<span class="nc" id="L36">    super(editor, type, icon);</span>

    // Initialize mock textbox UI
<span class="nc" id="L39">    textBoxWidget = new TextBox();</span>
<span class="nc" id="L40">    initWrapper(textBoxWidget);</span>
<span class="nc" id="L41">  }</span>

  @Override
  protected void onAttach() {
<span class="nc" id="L45">        super.onAttach();</span>
<span class="nc" id="L46">        ((YaFormEditor) editor).getForm().addFormChangeListener(this);</span>
<span class="nc" id="L47">  }</span>
  @Override
  protected void onDetach() {
<span class="nc" id="L50">        super.onDetach();</span>
<span class="nc" id="L51">        ((YaFormEditor) editor).getForm().removeFormChangeListener(this);</span>
<span class="nc" id="L52">  }</span>
  /**
   * Class that extends TextBox so we can use a protected constructor.
   *
   * &lt;p/&gt;The purpose of this class is to create a clone of the TextBox passed to
   * the constructor. It will be used to determine the preferred size of the
   * TextBox, without having the size constrained by its parent, since the
   * cloned TextBox won't have a parent.
   */
  static class ClonedTextBox extends TextBox {
    ClonedTextBox(TextBox tb) {
      // Get the Element from the TextBox.
      // Call DOM.clone to make a deep clone of that element.
      // Pass that cloned element to the super constructor.
<span class="nc" id="L66">      super(DOM.clone(tb.getElement(), true));</span>
<span class="nc" id="L67">    }</span>
  }

  @Override
  protected Widget createClonedWidget() {
<span class="nc" id="L72">    return new ClonedTextBox(textBoxWidget);</span>
  }

  @Override
  public void onCreateFromPalette() {
    // Do not set text; instead set hint (makes more sense for this component)
    // Change textbox hint to component name
<span class="nc" id="L79">    changeProperty(PROPERTY_NAME_HINT, MESSAGES.hintPropertyValue(getName()));</span>
<span class="nc" id="L80">  }</span>

  @Override
  public int getPreferredWidth() {
<span class="nc" id="L84">    return ComponentConstants.TEXTBOX_PREFERRED_WIDTH;</span>
  }

  /*
   * Sets the textbox's TextAlignment property to a new value.
   */
  private void setTextAlignmentProperty(String text) {
<span class="nc" id="L91">    MockComponentsUtil.setWidgetTextAlign(textBoxWidget, text);</span>
<span class="nc" id="L92">  }</span>

  /*
   * Sets the textbox's BackgroundColor property to a new value.
   */
  private void setBackgroundColorProperty(String text) {
<span class="nc bnc" id="L98" title="All 2 branches missed.">    if (MockComponentsUtil.isDefaultColor(text)) {</span>
<span class="nc" id="L99">      MockForm form = ((YaFormEditor) editor).getForm();</span>
<span class="nc bnc" id="L100" title="All 4 branches missed.">      if (form != null &amp;&amp; form.getPropertyValue(&quot;HighContrast&quot;).equals(&quot;True&quot;)) {</span>
<span class="nc" id="L101">        text = &quot;&amp;HFF000000&quot;;  //black</span>
      } else {
<span class="nc" id="L103">        text = &quot;&amp;HFFFFFFFF&quot;;  // white</span>
      }
    }
<span class="nc" id="L106">    MockComponentsUtil.setWidgetBackgroundColor(textBoxWidget, text);</span>
<span class="nc" id="L107">  }</span>

  /*
   * Sets the textbox's Enabled property to a new value.
   */
  private void setEnabledProperty(String text) {
<span class="nc" id="L113">    MockComponentsUtil.setEnabled(this, text);</span>
<span class="nc" id="L114">  }</span>

  /*
   * Sets the textbox's FontBold property to a new value.
   */
  private void setFontBoldProperty(String text) {
<span class="nc" id="L120">    MockComponentsUtil.setWidgetFontBold(textBoxWidget, text);</span>
<span class="nc" id="L121">    updatePreferredSize();</span>
<span class="nc" id="L122">  }</span>

  /*
   * Sets the textbox's FontItalic property to a new value.
   */
  private void setFontItalicProperty(String text) {
<span class="nc" id="L128">    MockComponentsUtil.setWidgetFontItalic(textBoxWidget, text);</span>
<span class="nc" id="L129">    updatePreferredSize();</span>
<span class="nc" id="L130">  }</span>

  /*
   * Sets the textbox's FontSize property to a new value.
   */
  private void setFontSizeProperty(String text) {
<span class="nc" id="L136">    float convertedText = Float.parseFloat(text);</span>
<span class="nc" id="L137">    MockForm form = ((YaFormEditor) editor).getForm();</span>
<span class="nc bnc" id="L138" title="All 4 branches missed.">    if (convertedText == 14.0 &amp;&amp; form != null</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">        &amp;&amp; form.getPropertyValue(&quot;BigDefaultText&quot;).equals(&quot;True&quot;)) {</span>
<span class="nc" id="L140">      MockComponentsUtil.setWidgetFontSize(textBoxWidget, &quot;24&quot;);</span>
    } else {
<span class="nc" id="L142">      MockComponentsUtil.setWidgetFontSize(textBoxWidget, text);</span>
    }
<span class="nc" id="L144">    updatePreferredSize();</span>
<span class="nc" id="L145">  }</span>

  /*
   * Sets the textbox's FontTypeface property to a new value.
   */
  private void setFontTypefaceProperty(String text) {
<span class="nc" id="L151">    MockComponentsUtil.setWidgetFontTypeface(this.editor, textBoxWidget, text);</span>
<span class="nc" id="L152">    updatePreferredSize();</span>
<span class="nc" id="L153">  }</span>

  /*
   * Sets the textbox's Hint property to a new value.
   */
  private void setHintProperty(String text) {
<span class="nc" id="L159">    textBoxWidget.setTitle(text);</span>
<span class="nc" id="L160">  }</span>

  /*
   * Sets the textbox's Text property to a new value.
   */
  private void setTextProperty(String text) {
<span class="nc" id="L166">    textBoxWidget.setText(text);</span>
<span class="nc" id="L167">    updatePreferredSize();</span>
<span class="nc" id="L168">  }</span>

  /*
   * Sets the textbox's TextColor property to a new value.
   */
  private void setTextColorProperty(String text) {
<span class="nc bnc" id="L174" title="All 2 branches missed.">    if (MockComponentsUtil.isDefaultColor(text)) {</span>
<span class="nc" id="L175">      MockForm form = ((YaFormEditor) editor).getForm();</span>
<span class="nc bnc" id="L176" title="All 4 branches missed.">      if (form != null &amp;&amp; form.getPropertyValue(&quot;HighContrast&quot;).equals(&quot;True&quot;)) {</span>
<span class="nc" id="L177">        text = &quot;&amp;HFFFFFFFF&quot;;  // white</span>
      } else {
<span class="nc" id="L179">        text = &quot;&amp;HFF000000&quot;;  //black</span>

      }

    }

<span class="nc" id="L185">    MockComponentsUtil.setWidgetTextColor(textBoxWidget, text);</span>

<span class="nc" id="L187">  }</span>

  // PropertyChangeListener implementation


  @Override
  public void onPropertyChange(String propertyName, String newValue) {
<span class="nc" id="L194">    super.onPropertyChange(propertyName, newValue);</span>

    // Apply changed properties to the mock component
<span class="nc bnc" id="L197" title="All 2 branches missed.">    if (propertyName.equals(PROPERTY_NAME_TEXTALIGNMENT)) {</span>
<span class="nc" id="L198">      setTextAlignmentProperty(newValue);</span>
<span class="nc bnc" id="L199" title="All 2 branches missed.">    } else if (propertyName.equals(PROPERTY_NAME_BACKGROUNDCOLOR)) {</span>
<span class="nc" id="L200">      setBackgroundColorProperty(newValue);</span>
<span class="nc bnc" id="L201" title="All 2 branches missed.">    } else if (propertyName.equals(PROPERTY_NAME_ENABLED)) {</span>
<span class="nc" id="L202">      setEnabledProperty(newValue);</span>
<span class="nc bnc" id="L203" title="All 2 branches missed.">    } else if (propertyName.equals(PROPERTY_NAME_FONTBOLD)) {</span>
<span class="nc" id="L204">      setFontBoldProperty(newValue);</span>
<span class="nc" id="L205">      refreshForm();</span>
<span class="nc bnc" id="L206" title="All 2 branches missed.">    } else if (propertyName.equals(PROPERTY_NAME_FONTITALIC)) {</span>
<span class="nc" id="L207">      setFontItalicProperty(newValue);</span>
<span class="nc" id="L208">      refreshForm();</span>
<span class="nc bnc" id="L209" title="All 2 branches missed.">    } else if (propertyName.equals(PROPERTY_NAME_FONTSIZE)) {</span>
<span class="nc" id="L210">      setFontSizeProperty(newValue);</span>
<span class="nc" id="L211">      refreshForm();</span>
<span class="nc bnc" id="L212" title="All 2 branches missed.">    } else if (propertyName.equals(PROPERTY_NAME_FONTTYPEFACE)) {</span>
<span class="nc" id="L213">      setFontTypefaceProperty(newValue);</span>
<span class="nc" id="L214">      refreshForm();</span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">    } else if (propertyName.equals(PROPERTY_NAME_HINT)) {</span>
<span class="nc" id="L216">      setHintProperty(newValue);</span>
<span class="nc bnc" id="L217" title="All 2 branches missed.">    } else if (propertyName.equals(PROPERTY_NAME_TEXT)) {</span>
<span class="nc" id="L218">      setTextProperty(newValue);</span>
<span class="nc" id="L219">      refreshForm();</span>
<span class="nc bnc" id="L220" title="All 2 branches missed.">    } else if (propertyName.equals(PROPERTY_NAME_TEXTCOLOR)) {</span>
<span class="nc" id="L221">      setTextColorProperty(newValue);</span>
<span class="nc bnc" id="L222" title="All 2 branches missed.">    } else if (propertyName.equals(PROPERTY_NAME_WIDTH)) {</span>
<span class="nc" id="L223">      MockComponentsUtil.updateTextAppearances(textBoxWidget, newValue);</span>
<span class="nc" id="L224">      refreshForm();</span>
    }
<span class="nc" id="L226">  }</span>

  @Override
  public void onComponentPropertyChanged(MockComponent component, String propertyName, String propertyValue) {
<span class="nc bnc" id="L230" title="All 4 branches missed.">    if (component.getType().equals(MockForm.TYPE) &amp;&amp; propertyName.equals(&quot;HighContrast&quot;)) {</span>
<span class="nc" id="L231">      setBackgroundColorProperty(getPropertyValue(PROPERTY_NAME_BACKGROUNDCOLOR));</span>
<span class="nc" id="L232">      setTextColorProperty(getPropertyValue(PROPERTY_NAME_TEXTCOLOR));</span>
      //setFontSizeProperty(getPropertyValue(PROPERTY_NAME_FONTSIZE));
<span class="nc" id="L234">      updatePreferredSize();</span>
<span class="nc" id="L235">      refreshForm();</span>
    }
<span class="nc bnc" id="L237" title="All 4 branches missed.">    else if (component.getType().equals(MockForm.TYPE) &amp;&amp; propertyName.equals(&quot;BigDefaultText&quot;)) {</span>
<span class="nc" id="L238">      setFontSizeProperty(getPropertyValue(PROPERTY_NAME_FONTSIZE));</span>
<span class="nc" id="L239">      updatePreferredSize();</span>
<span class="nc" id="L240">      refreshForm();</span>
    }
<span class="nc" id="L242">  }</span>

  @Override
  public void onComponentRemoved(MockComponent component, boolean permanentlyDeleted) {

<span class="nc" id="L247">  }</span>

  @Override
  public void onComponentAdded(MockComponent component) {

<span class="nc" id="L252">  }</span>

  @Override
  public void onComponentRenamed(MockComponent component, String oldName) {

<span class="nc" id="L257">  }</span>

  @Override
  public void onComponentSelectionChange(MockComponent component, boolean selected) {

<span class="nc" id="L262">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>