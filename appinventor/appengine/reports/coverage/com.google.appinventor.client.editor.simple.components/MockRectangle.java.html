<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MockRectangle.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.google.appinventor.client.editor.simple.components</a> &gt; <span class="el_source">MockRectangle.java</span></div><h1>MockRectangle.java</h1><pre class="source lang-java linenums">// -*- mode: java; c-basic-offset: 2; -*-
// Copyright 2016-2017 MIT, All rights reserved
// Released under the Apache License, Version 2.0
// http://www.apache.org/licenses/LICENSE-2.0

package com.google.appinventor.client.editor.simple.components;

import com.google.appinventor.client.editor.simple.SimpleEditor;
import com.google.appinventor.client.editor.simple.components.utils.SVGPanel;
import com.google.appinventor.components.common.ComponentConstants;
import com.google.gwt.core.client.JavaScriptObject;
import com.google.gwt.json.client.JSONObject;

public class MockRectangle extends MockPolygonBase {
  public static final String TYPE = &quot;Rectangle&quot;;

  private static final String PROPERTY_NAME_EAST = &quot;EastLongitude&quot;;
  private static final String PROPERTY_NAME_NORTH = &quot;NorthLatitude&quot;;
  private static final String PROPERTY_NAME_SOUTH = &quot;SouthLatitude&quot;;
  private static final String PROPERTY_NAME_WEST = &quot;WestLongitude&quot;;

<span class="nc" id="L22">  private double east = 0;</span>
<span class="nc" id="L23">  private double north = 0;</span>
<span class="nc" id="L24">  private double south = 0;</span>
<span class="nc" id="L25">  private double west = 0;</span>

  public MockRectangle(SimpleEditor editor) {
<span class="nc" id="L28">    super(editor, TYPE, images.rectangle());</span>

<span class="nc" id="L30">    SVGPanel svgpanel = new SVGPanel();</span>
<span class="nc" id="L31">    svgpanel.setPixelSize(ComponentConstants.RECTANGLE_PREFERRED_WIDTH + 2,</span>
        ComponentConstants.RECTANGLE_PREFERRED_HEIGHT + 2);
<span class="nc" id="L33">    svgpanel.setInnerSVG(&quot;&lt;path d=\&quot;M0 0L50 0L50 30L0 30Z\&quot; stroke-width=\&quot;1\&quot; stroke=\&quot;black\&quot; fill=\&quot;red\&quot; /&gt;&quot;);</span>
<span class="nc" id="L34">    panel.setWidget(svgpanel);</span>
<span class="nc" id="L35">    panel.setWidth(Integer.toString(ComponentConstants.RECTANGLE_PREFERRED_WIDTH + 2) + &quot;px&quot;);</span>
<span class="nc" id="L36">    panel.setHeight(Integer.toString(ComponentConstants.RECTANGLE_PREFERRED_HEIGHT + 2) + &quot;px&quot;);</span>

<span class="nc" id="L38">    initRectangle(south, west, north, east);</span>
<span class="nc" id="L39">  }</span>

  static MockRectangle fromGeoJSON(MockFeatureCollection parent, JSONObject properties, JavaScriptObject layer) {
<span class="nc" id="L42">    MockRectangle rectangle = new MockRectangle(parent.editor);</span>
<span class="nc" id="L43">    rectangle.feature = layer;</span>
    // TODO(ewpatton): Process properties
<span class="nc" id="L45">    return rectangle;</span>
  }

  @Override
  public boolean onDrop(MockMap map, int x, int y, int offsetX, int offsetY) {
<span class="nc" id="L50">    MockMap.LatLng sw = map.projectFromXY(x - offsetX, y - offsetY + ComponentConstants.RECTANGLE_PREFERRED_HEIGHT);</span>
<span class="nc" id="L51">    MockMap.LatLng ne = map.projectFromXY(x - offsetX + ComponentConstants.RECTANGLE_PREFERRED_WIDTH, y - offsetY);</span>
<span class="nc" id="L52">    setPoints2(sw.toNative(), ne.toNative());</span>
<span class="nc" id="L53">    changeProperty(PROPERTY_NAME_NORTH, Double.toString(ne.latitude));</span>
<span class="nc" id="L54">    changeProperty(PROPERTY_NAME_WEST, Double.toString(sw.longitude));</span>
<span class="nc" id="L55">    changeProperty(PROPERTY_NAME_SOUTH, Double.toString(sw.latitude));</span>
<span class="nc" id="L56">    changeProperty(PROPERTY_NAME_EAST, Double.toString(ne.longitude));</span>
<span class="nc" id="L57">    return true;</span>
  }

  @Override
  public void onPropertyChange(String propertyName, String newValue) {
<span class="nc" id="L62">    super.onPropertyChange(propertyName, newValue);</span>

<span class="nc bnc" id="L64" title="All 2 branches missed.">    if (propertyName.equals(PROPERTY_NAME_EAST)) {</span>
<span class="nc" id="L65">      setEastLongitudeProperty(newValue);</span>
<span class="nc bnc" id="L66" title="All 2 branches missed.">    } else if(propertyName.equals(PROPERTY_NAME_NORTH)) {</span>
<span class="nc" id="L67">      setNorthLatitudeProperty(newValue);</span>
<span class="nc bnc" id="L68" title="All 2 branches missed.">    } else if(propertyName.equals(PROPERTY_NAME_SOUTH)) {</span>
<span class="nc" id="L69">      setSouthLatitudeProperty(newValue);</span>
<span class="nc bnc" id="L70" title="All 2 branches missed.">    } else if(propertyName.equals(PROPERTY_NAME_WEST)) {</span>
<span class="nc" id="L71">      setWestLongitudeProperty(newValue);</span>
    }
<span class="nc" id="L73">  }</span>

  @Override
  public int getPreferredWidth() {
<span class="nc" id="L77">    return ComponentConstants.RECTANGLE_PREFERRED_WIDTH + 2;</span>
  }

  @Override
  public int getPreferredHeight() {
<span class="nc" id="L82">    return ComponentConstants.RECTANGLE_PREFERRED_HEIGHT + 2;</span>
  }

  @Override
  protected boolean isPropertyVisible(String propertyName) {
<span class="nc bnc" id="L87" title="All 2 branches missed.">    if (propertyName.equals(PROPERTY_NAME_WIDTH) ||</span>
<span class="nc bnc" id="L88" title="All 2 branches missed.">        propertyName.equals(PROPERTY_NAME_HEIGHT)) {</span>
<span class="nc" id="L89">      return false;</span>
    }
<span class="nc" id="L91">    return super.isPropertyVisible(propertyName);</span>
  }

  private void setEastLongitudeProperty(String text) {
    try {
<span class="nc" id="L96">      east = Double.parseDouble(text);</span>
<span class="nc" id="L97">      setBounds(south, west, north, east);</span>
<span class="nc" id="L98">    } catch(NumberFormatException e) {</span>
      // pass
<span class="nc" id="L100">    }</span>
<span class="nc" id="L101">  }</span>

  private void setNorthLatitudeProperty(String text) {
    try {
<span class="nc" id="L105">      north = Double.parseDouble(text);</span>
<span class="nc" id="L106">      setBounds(south, west, north, east);</span>
<span class="nc" id="L107">    } catch(NumberFormatException e) {</span>
      // pass
<span class="nc" id="L109">    }</span>
<span class="nc" id="L110">  }</span>

  private void setSouthLatitudeProperty(String text) {
    try {
<span class="nc" id="L114">      south = Double.parseDouble(text);</span>
<span class="nc" id="L115">      setBounds(south, west, north, east);</span>
<span class="nc" id="L116">    } catch(NumberFormatException e) {</span>
      // pass
<span class="nc" id="L118">    }</span>
<span class="nc" id="L119">  }</span>

  private void setWestLongitudeProperty(String text) {
    try {
<span class="nc" id="L123">      west = Double.parseDouble(text);</span>
<span class="nc" id="L124">      setBounds(south, west, north, east);</span>
<span class="nc" id="L125">    } catch(NumberFormatException e) {</span>
      // pass
<span class="nc" id="L127">    }</span>
<span class="nc" id="L128">  }</span>

  private void updateBounds(double south, double west, double north, double east) {
<span class="nc" id="L131">    changeProperty(PROPERTY_NAME_SOUTH, Double.toString(south));</span>
<span class="nc" id="L132">    changeProperty(PROPERTY_NAME_WEST, Double.toString(west));</span>
<span class="nc" id="L133">    changeProperty(PROPERTY_NAME_NORTH, Double.toString(north));</span>
<span class="nc" id="L134">    changeProperty(PROPERTY_NAME_EAST, Double.toString(east));</span>
<span class="nc" id="L135">    super.onPropertyChange(PROPERTY_NAME_SOUTH, Double.toString(south));</span>
<span class="nc" id="L136">    super.onPropertyChange(PROPERTY_NAME_WEST, Double.toString(west));</span>
<span class="nc" id="L137">    super.onPropertyChange(PROPERTY_NAME_NORTH, Double.toString(north));</span>
<span class="nc" id="L138">    super.onPropertyChange(PROPERTY_NAME_EAST, Double.toString(east));</span>
<span class="nc" id="L139">  }</span>

  // JSNI Methods
  private native void initRectangle(double south, double west, double north, double east)/*-{
    this.@com.google.appinventor.client.editor.simple.components.MockMapFeatureBase::feature =
      top.L.rectangle([[south, west], [north, east]], {
        className: 'leaflet-interactive',
        weight: 1,
        color: '#000',
        fillColor: '#f00',
        fillOpacity: 1,
        draggable: true,
        pointerEvents: 'auto'
      });
  }-*/;

  private native void setPoints2(JavaScriptObject se, JavaScriptObject nw)/*-{
    var feature = this.@com.google.appinventor.client.editor.simple.components.MockMapFeatureBase::feature;
    feature.setBounds(top.L.latLngBounds(se, nw));
  }-*/;

  protected native void addToMap(JavaScriptObject map)/*-{
    var el = this.@com.google.appinventor.client.editor.simple.components.MockMapFeatureBase::getElement()();
    var rect = this.@com.google.appinventor.client.editor.simple.components.MockMapFeatureBase::feature;
    map.addLayer(rect);
    if (!rect.clickHandler) {
      while (el.lastChild) el.removeChild(el.lastChild);  // clear the div
      rect.clickHandler = function (e) {
        this.@com.google.appinventor.client.editor.simple.components.MockMapFeatureBase::select(*)(e);
        if (e.originalEvent) e.originalEvent.stopPropagation();
      };
      rect.dragHandler = function () {
        var bounds = rect.getBounds();
        this.@com.google.appinventor.client.editor.simple.components.MockRectangle::updateBounds(*)(
          bounds.getSouth(), bounds.getWest(), bounds.getNorth(), bounds.getEast()
        );
      };
      rect.on('click dragstart editable:dragstart editable:vertex:dragstart editable:vertex:clicked editable:drawing:click editable:drawing:clicked',
        rect.clickHandler, this);
      rect.on('dragend editable:dragend editable:vertex:dragend editable:vertex:deleted editable:drawing:commit',
        rect.dragHandler, this);
    }
    el = rect.getElement();
    el.style['pointer-events'] = 'auto';
    el.style['cursor'] = 'pointer';
    this.@com.google.appinventor.client.editor.simple.components.MockMapFeatureBase::setNativeTooltip(*)(
      this.@com.google.appinventor.client.editor.simple.components.MockPolygon::getTooltip()()
    );
    var isVisible = this.@com.google.appinventor.client.editor.simple.components.MockMapFeatureBase::getVisibleProperty()();
    if (!isVisible) {
      map.removeLayer(rect);
    }
  }-*/;

  private native void setBounds(double south, double west, double north, double east)/*-{
    var rect = this.@com.google.appinventor.client.editor.simple.components.MockMapFeatureBase::feature,
        map = this.@com.google.appinventor.client.editor.simple.components.MockMapFeatureBase::map,
        mapjso = map ? map.@com.google.appinventor.client.editor.simple.components.MockMap::getMapInstance()() : null;
    if (rect) {
      rect.setBounds(top.L.latLngBounds([south, west], [north, east]));
      rect.redraw();
      if (rect.editor) {
        rect.editor.reset();
      } else if (mapjso) {
        rect.enableEdit(mapjso);
      }
    }
  }-*/;

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>