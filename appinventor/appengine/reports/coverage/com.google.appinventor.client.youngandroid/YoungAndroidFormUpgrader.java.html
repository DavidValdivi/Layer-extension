<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>YoungAndroidFormUpgrader.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.google.appinventor.client.youngandroid</a> &gt; <span class="el_source">YoungAndroidFormUpgrader.java</span></div><h1>YoungAndroidFormUpgrader.java</h1><pre class="source lang-java linenums">// -*- mode: java; c-basic-offset: 2; -*-
// Copyright 2009-2011 Google, All Rights reserved
// Copyright 2011-2019 MIT, All rights reserved
// Released under the Apache License, Version 2.0
// http://www.apache.org/licenses/LICENSE-2.0

package com.google.appinventor.client.youngandroid;

import static com.google.appinventor.client.Ode.MESSAGES;

import java.util.Map;

import com.google.appinventor.client.editor.simple.SimpleComponentDatabase;
import com.google.appinventor.client.editor.simple.components.MockVisibleComponent;
import com.google.appinventor.client.output.OdeLog;
import com.google.appinventor.client.properties.json.ClientJsonString;
import com.google.appinventor.common.utils.StringUtils;
import com.google.appinventor.components.common.ComponentConstants;
import com.google.appinventor.components.common.YaVersion;
import com.google.appinventor.shared.properties.json.JSONArray;
import com.google.appinventor.shared.properties.json.JSONValue;
import com.google.gwt.user.client.ui.Button;
import com.google.gwt.user.client.ui.ClickListener;
import com.google.gwt.user.client.ui.DialogBox;
import com.google.gwt.user.client.ui.HTML;
import com.google.gwt.user.client.ui.VerticalPanel;
import com.google.gwt.user.client.ui.Widget;
import com.google.gwt.user.client.Window;

/**
 * A class that can upgrade a Young Android Form source file.
 *
 * @author lizlooney@google.com (Liz Looney)
 */
public final class YoungAndroidFormUpgrader {
  static class LoadException extends IllegalStateException {
    LoadException(String message) {
<span class="nc" id="L38">      super(message);</span>
<span class="nc" id="L39">    }</span>
  }

<span class="nc" id="L42">  private static final SimpleComponentDatabase COMPONENT_DATABASE =</span>
<span class="nc" id="L43">      SimpleComponentDatabase.getInstance();</span>

  private YoungAndroidFormUpgrader() {
  }

  /**
   * Upgrades the given sourceProperties if necessary.
   *
   * @param sourceProperties the properties from the source file
   * @return true if the sourceProperties was upgraded, false otherwise
   */
  public static boolean upgradeSourceProperties(Map&lt;String, JSONValue&gt; sourceProperties) {
<span class="nc" id="L55">    StringBuilder upgradeDetails = new StringBuilder();</span>
    try {
<span class="nc" id="L57">      int srcYaVersion = getSrcYaVersion(sourceProperties);</span>
<span class="nc bnc" id="L58" title="All 2 branches missed.">      if (needToUpgrade(srcYaVersion)) {</span>
<span class="nc" id="L59">        Map&lt;String, JSONValue&gt; formProperties =</span>
<span class="nc" id="L60">            sourceProperties.get(&quot;Properties&quot;).asObject().getProperties();</span>
<span class="nc" id="L61">        upgradeComponent(srcYaVersion, formProperties, upgradeDetails);</span>
        // The sourceProperties were upgraded. Update the version number.
<span class="nc" id="L63">        setSrcYaVersion(sourceProperties);</span>
<span class="nc bnc" id="L64" title="All 2 branches missed.">        if (upgradeDetails.length() &gt; 0) {</span>
<span class="nc" id="L65">          Window.alert(MESSAGES.projectWasUpgraded(upgradeDetails.toString()));</span>
        }
<span class="nc" id="L67">        return true;</span>
      }
<span class="nc" id="L69">    } catch (LoadException e) {</span>
      // This shouldn't happen. If it does it's our fault, not the user's fault.
<span class="nc" id="L71">      Window.alert(MESSAGES.unexpectedProblem(e.getMessage()));</span>
<span class="nc" id="L72">      OdeLog.xlog(e);</span>
<span class="nc" id="L73">    }</span>
<span class="nc" id="L74">    return false;</span>
  }

  private static int getSrcYaVersion(Map&lt;String, JSONValue&gt; sourceProperties) {
<span class="nc" id="L78">    int srcYaVersion = 0;</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">    if (sourceProperties.containsKey(&quot;YaVersion&quot;)) {</span>
<span class="nc" id="L80">      String version = sourceProperties.get(&quot;YaVersion&quot;).asString().getString();</span>
<span class="nc" id="L81">      srcYaVersion = Integer.parseInt(version);</span>
    }
<span class="nc" id="L83">    return srcYaVersion;</span>
  }

  private static void setSrcYaVersion(Map&lt;String, JSONValue&gt; sourceProperties) {
<span class="nc" id="L87">    sourceProperties.put(&quot;YaVersion&quot;, new ClientJsonString(&quot;&quot; + YaVersion.YOUNG_ANDROID_VERSION));</span>
<span class="nc" id="L88">  }</span>

  private static boolean needToUpgrade(int srcYaVersion) {
    // Compare the source file's YoungAndroid version with the system's YoungAndroid version.
<span class="nc" id="L92">    final int sysYaVersion = YaVersion.YOUNG_ANDROID_VERSION;</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">    if (srcYaVersion &gt; sysYaVersion) {</span>
      // The source file's version is newer than the system's version.
      // This can happen if the user is using (or in the past has used) a non-production version of
      // App Inventor.
      // This can also happen if the user is connected to a new version of App Inventor and then
      // later is connected to an old version of App Inventor.
      // We'll try to load the project but there may be compatibility issues if the project uses
      // future components or other features that the current system doesn't understand.
<span class="nc" id="L101">      Window.alert(MESSAGES.newerVersionProject());</span>
<span class="nc" id="L102">      return false;</span>
    }

<span class="nc bnc" id="L105" title="All 2 branches missed.">    if (srcYaVersion == 0) {</span>
      // The source file doesn't have a YoungAndroid version number.
      // There are two situations that cause this:
      // 1. The project may have been downloaded from alpha (androidblocks.googlelabs.com) and
      // uploaded to beta (appinventor.googlelabs.com), which is illegal.
      // 2. The project may have been created with beta (appinventor.googlelabs.com) before we
      // started putting version numbers into the source file, which is legal, and nothing
      // really changed between version 0 and version 1.
      //
      // For a limited time, we assume #2, show a warning, and proceed.
      // TODO(lizlooney) - after the limited time is up (when we think that all appinventor
      // projects have been upgraded), we may decide to refuse to load the project.
<span class="nc" id="L117">      Window.alert(MESSAGES.veryOldProject());</span>
    }

<span class="nc bnc" id="L120" title="All 2 branches missed.">    return (srcYaVersion &lt; sysYaVersion);</span>
  }

  /*
   * Parses the JSON properties and upgrades the component if necessary.
   * This method is called recursively for nested components.
   */
  private static void upgradeComponent(int srcYaVersion,
      Map&lt;String, JSONValue&gt; componentProperties, StringBuilder upgradeDetails) {

<span class="nc" id="L130">    String componentType = componentProperties.get(&quot;$Type&quot;).asString().getString();</span>

<span class="nc bnc" id="L132" title="All 4 branches missed.">    if (srcYaVersion &lt; 218 &amp;&amp; &quot;GoogleSheets&quot;.equals(componentType)) {</span>
<span class="nc" id="L133">      componentType = &quot;Spreadsheet&quot;;</span>
<span class="nc" id="L134">      componentProperties.put(&quot;$Type&quot;, new ClientJsonString(&quot;Spreadsheet&quot;));</span>
    }

    // Get the source component version from the componentProperties.
<span class="nc" id="L138">    int srcCompVersion = 0;</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">    if (componentProperties.containsKey(&quot;$Version&quot;)) {</span>
<span class="nc" id="L140">      String version = componentProperties.get(&quot;$Version&quot;).asString().getString();</span>
<span class="nc" id="L141">      srcCompVersion = Integer.parseInt(version);</span>
    }

<span class="nc bnc" id="L144" title="All 2 branches missed.">    if (srcYaVersion &lt; 2) {</span>
      // In YOUNG_ANDROID_VERSION 2, the Logger component was removed; Notifier should be used
      // instead.
      // Here we change the Logger component to a Notifier component automatically. Sweet!
      // (We need to do this upgrade here, not in the upgradeComponentProperties method. This is
      // because the code below calls COMPONENT_DATABASE.getComponentVersion() and that will fail
      // if componentType is &quot;Logger&quot; because &quot;Logger&quot; isn't a valid component type anymore.)
<span class="nc bnc" id="L151" title="All 2 branches missed.">      if (componentType.equals(&quot;Logger&quot;)) {</span>
<span class="nc" id="L152">        componentType = &quot;Notifier&quot;;</span>
<span class="nc" id="L153">        srcCompVersion = COMPONENT_DATABASE.getComponentVersion(componentType);</span>
<span class="nc" id="L154">        componentProperties.put(&quot;$Type&quot;, new ClientJsonString(componentType));</span>
<span class="nc" id="L155">        componentProperties.put(&quot;$Version&quot;, new ClientJsonString(&quot;&quot; + srcCompVersion));</span>
<span class="nc" id="L156">        upgradeDetails.append(MESSAGES.upgradeDetailLoggerReplacedWithNotifier(</span>
<span class="nc" id="L157">            componentProperties.get(&quot;$Name&quot;).asString().getString()));</span>
      }
    }

<span class="nc bnc" id="L161" title="All 2 branches missed.">    if (srcYaVersion &lt; 216) {</span>
      // YandexTranslate deprecated in favor of Translator
<span class="nc bnc" id="L163" title="All 2 branches missed.">      if (componentType.equals(&quot;YandexTranslate&quot;)) {</span>
<span class="nc" id="L164">        componentType = &quot;Translator&quot;;</span>
<span class="nc" id="L165">        srcCompVersion = COMPONENT_DATABASE.getComponentVersion(componentType);</span>
<span class="nc" id="L166">        componentProperties.put(&quot;$Type&quot;, new ClientJsonString(componentType));</span>
<span class="nc" id="L167">        componentProperties.put(&quot;$Version&quot;, new ClientJsonString(&quot;&quot; + srcCompVersion));</span>
<span class="nc" id="L168">        upgradeDetails.append(MESSAGES.yandexTranslateReplacedwithTranslator(</span>
<span class="nc" id="L169">            componentProperties.get(&quot;$Name&quot;).asString().getString()));</span>
      }
    }

    // Get the system component version from the component database.
    final int sysCompVersion;
    try {
<span class="nc" id="L176">      sysCompVersion = COMPONENT_DATABASE.getComponentVersion(componentType);</span>
<span class="nc" id="L177">    } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L178">      OdeLog.wlog(&quot;Cound not find component of type = &quot; + componentType</span>
        + &quot; assuming it is an external component.&quot;);
<span class="nc" id="L180">      return;                   // This should be safe because external components don't have</span>
                                // nested children
<span class="nc" id="L182">    }</span>

    // Upgrade if necessary.
<span class="nc" id="L185">    upgradeComponentProperties(componentProperties, componentType, srcCompVersion, sysCompVersion);</span>

<span class="nc bnc" id="L187" title="All 2 branches missed.">    if (srcYaVersion &lt; 26) {</span>
      // Beginning with YOUNG_ANDROID_VERSION 26:
      // - In .scm files, values for asset, BluetoothClient, component, lego_nxt_sensor_port,
      // and string properties no longer contain leading and trailing quotes.
<span class="nc" id="L191">      unquotePropertyValues(componentProperties, componentType);</span>
    }

    // Upgrade nested components
<span class="nc bnc" id="L195" title="All 2 branches missed.">    if (componentProperties.containsKey(&quot;$Components&quot;)) {</span>
<span class="nc" id="L196">      JSONArray componentsArray = componentProperties.get(&quot;$Components&quot;).asArray();</span>
<span class="nc bnc" id="L197" title="All 2 branches missed.">      for (JSONValue nestedComponent : componentsArray.getElements()) {</span>
<span class="nc" id="L198">        upgradeComponent(srcYaVersion, nestedComponent.asObject().getProperties(), upgradeDetails);</span>
<span class="nc" id="L199">      }</span>
    }
<span class="nc" id="L201">  }</span>

  private static void upgradeComponentProperties(Map&lt;String, JSONValue&gt; componentProperties,
      String componentType, int srcCompVersion, final int sysCompVersion) {
    // Compare the source file's component version with the system's component version.
<span class="nc bnc" id="L206" title="All 2 branches missed.">    if (srcCompVersion == 0) {</span>
      // The source file doesn't have a version number for this component.
      // There are two situations that cause this:
      // 1. The project may have been downloaded from alpha (androidblocks.googlelabs.com) and
      // uploaded to beta (appinventor.googlelabs.com), which is illegal.
      // 2. The project may have been created with beta (appinventor.googlelabs.com) before we
      // started putting version numbers into the source file, which is legal, and nothing
      // really changed between version 0 and version 1.
      //
      // For a limited time, we assume #2 and pretend that the source file said version 1.
      // TODO(lizlooney) - after the limited time is up (when we think that all appinventor
      // projects have been upgraded), we may decide to refuse to load the project.
<span class="nc" id="L218">      srcCompVersion = 1;</span>
    }

<span class="nc bnc" id="L221" title="All 2 branches missed.">    if (srcCompVersion &gt; sysCompVersion) {</span>
      // This shouldn't happen because we should have already detected that the project is a newer
      // version than the system and returned false in needToUpgrade.
      // NOTE(lizlooney,user) - we need to make sure that this situation does not happen by
      // incrementing YaVersion.YOUNG_ANDROID_VERSION each time a component's version number is
      // incremented.
<span class="nc" id="L227">      throw new LoadException(</span>
<span class="nc" id="L228">          MESSAGES.newerVersionComponentException(componentType, srcCompVersion, sysCompVersion));</span>
    }

<span class="nc bnc" id="L231" title="All 2 branches missed.">    if (srcCompVersion &lt; sysCompVersion) {</span>
      // NOTE(lizlooney,user) - when a component changes, increment the component's version
      // number in com.google.appinventor.components.common.YaVersion and add code here to upgrade
      // properties as necessary.
<span class="nc bnc" id="L235" title="All 2 branches missed.">      if (componentType.equals(&quot;AccelerometerSensor&quot;)){</span>
<span class="nc" id="L236">        srcCompVersion = upgradeAccelerometerSensorProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L238" title="All 2 branches missed.">      } else if (componentType.equals(&quot;ActivityStarter&quot;)) {</span>
<span class="nc" id="L239">        srcCompVersion = upgradeActivityStarterProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L241" title="All 2 branches missed.">      } else if (componentType.equals(&quot;Ball&quot;)) {</span>
<span class="nc" id="L242">        srcCompVersion = upgradeBallProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L244" title="All 2 branches missed.">      } else if (componentType.equals(&quot;BarcodeScanner&quot;)) {</span>
<span class="nc" id="L245">        srcCompVersion = upgradeBarcodeScannerProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L247" title="All 2 branches missed.">      } else if (componentType.equals(&quot;BluetoothClient&quot;)) {</span>
<span class="nc" id="L248">        srcCompVersion = upgradeBluetoothClientProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L250" title="All 2 branches missed.">      } else if (componentType.equals(&quot;BluetoothServer&quot;)) {</span>
<span class="nc" id="L251">        srcCompVersion = upgradeBluetoothServerProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L253" title="All 2 branches missed.">      } else if (componentType.equals(&quot;Slider&quot;)) {</span>
<span class="nc" id="L254">        srcCompVersion = upgradeSliderProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L256" title="All 2 branches missed.">      } else if (componentType.equals(&quot;TextToSpeech&quot;)) {</span>
<span class="nc" id="L257">        srcCompVersion = upgradeTextToSpeechProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L259" title="All 2 branches missed.">      } else if (componentType.equals(&quot;Button&quot;)) {</span>
<span class="nc" id="L260">        srcCompVersion = upgradeButtonProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L262" title="All 2 branches missed.">      } else if (componentType.equals(&quot;Camera&quot;)) {</span>
<span class="nc" id="L263">        srcCompVersion = upgradeCameraProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L265" title="All 2 branches missed.">      } else if (componentType.equals(&quot;Canvas&quot;)) {</span>
<span class="nc" id="L266">        srcCompVersion = upgradeCanvasProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L268" title="All 2 branches missed.">      } else if (componentType.equals(&quot;Chart&quot;)) {</span>
<span class="nc" id="L269">        srcCompVersion = upgradeChartProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L271" title="All 2 branches missed.">      } else if (componentType.equals(&quot;CheckBox&quot;)) {</span>
<span class="nc" id="L272">        srcCompVersion = upgradeCheckBoxProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L274" title="All 2 branches missed.">      } else if (componentType.equals(&quot;Clock&quot;)) {</span>
<span class="nc" id="L275">        srcCompVersion = upgradeClockProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L277" title="All 2 branches missed.">      } else if (componentType.equals(&quot;ContactPicker&quot;)) {</span>
<span class="nc" id="L278">        srcCompVersion = upgradeContactPickerProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L280" title="All 2 branches missed.">      } else if (componentType.equals(&quot;DatePicker&quot;)) {</span>
<span class="nc" id="L281">        srcCompVersion = upgradeDatePickerProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L283" title="All 2 branches missed.">      } else if (componentType.equals(&quot;EmailPicker&quot;)) {</span>
<span class="nc" id="L284">        srcCompVersion = upgradeEmailPickerProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L286" title="All 2 branches missed.">      } else if (componentType.equals(&quot;File&quot;)) {</span>
<span class="nc" id="L287">        srcCompVersion = upgradeFileProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L289" title="All 2 branches missed.">      } else if (componentType.equals(&quot;Form&quot;)) {</span>
<span class="nc" id="L290">        srcCompVersion = upgradeFormProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L292" title="All 2 branches missed.">      } else if (componentType.equals(&quot;FusiontablesControl&quot;)) {</span>
<span class="nc" id="L293">        srcCompVersion = upgradeFusiontablesControlProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L295" title="All 2 branches missed.">      } else if (componentType.equals(&quot;HorizontalArrangement&quot;)) {</span>
<span class="nc" id="L296">        srcCompVersion = upgradeHorizontalArrangementProperties(componentProperties,</span>
            srcCompVersion);

<span class="nc bnc" id="L299" title="All 2 branches missed.">      } else if (componentType.equals(&quot;HorizontalScrollArrangement&quot;)) {</span>
<span class="nc" id="L300">        srcCompVersion = upgradeHorizontalScrollArrangementProperties(componentProperties,</span>
            srcCompVersion);

<span class="nc bnc" id="L303" title="All 2 branches missed.">      } else if (componentType.equals(&quot;Image&quot;)) {</span>
<span class="nc" id="L304">        srcCompVersion = upgradeImageProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L306" title="All 2 branches missed.">      } else if (componentType.equals(&quot;ImagePicker&quot;)) {</span>
<span class="nc" id="L307">        srcCompVersion = upgradeImagePickerProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L309" title="All 2 branches missed.">      } else if (componentType.equals(&quot;ImageSprite&quot;)) {</span>
<span class="nc" id="L310">        srcCompVersion = upgradeImageSpriteProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L312" title="All 2 branches missed.">      } else if (componentType.equals(&quot;Label&quot;)) {</span>
<span class="nc" id="L313">        srcCompVersion = upgradeLabelProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L315" title="All 2 branches missed.">      } else if (componentType.equals(&quot;ListPicker&quot;)) {</span>
<span class="nc" id="L316">        srcCompVersion = upgradeListPickerProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L318" title="All 2 branches missed.">      } else if (componentType.equals(&quot;ListView&quot;)) {</span>
<span class="nc" id="L319">        srcCompVersion = upgradeListViewProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L321" title="All 2 branches missed.">      } else if (componentType.equals(&quot;LocationSensor&quot;)) {</span>
<span class="nc" id="L322">        srcCompVersion = upgradeLocationSensorProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L324" title="All 2 branches missed.">      } else if (componentType.equals(&quot;OrientationSensor&quot;)) {</span>
<span class="nc" id="L325">        srcCompVersion = upgradeOrientationSensorProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L327" title="All 2 branches missed.">      } else if (componentType.equals(&quot;PasswordTextBox&quot;)) {</span>
<span class="nc" id="L328">        srcCompVersion = upgradePasswordTextBoxProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L330" title="All 2 branches missed.">      } else if (componentType.equals(&quot;PhoneCall&quot;)) {</span>
<span class="nc" id="L331">        srcCompVersion = upgradePhoneCallProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L333" title="All 2 branches missed.">      } else if (componentType.equals(&quot;PhoneNumberPicker&quot;)) {</span>
<span class="nc" id="L334">        srcCompVersion = upgradePhoneNumberPickerProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L336" title="All 2 branches missed.">      } else if (componentType.equals(&quot;Player&quot;)) {</span>
<span class="nc" id="L337">        srcCompVersion = upgradePlayerProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L339" title="All 2 branches missed.">      } else if (componentType.equals(&quot;Sound&quot;)) {</span>
<span class="nc" id="L340">        srcCompVersion = upgradeSoundProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L342" title="All 2 branches missed.">      } else if (componentType.equals(&quot;SoundRecorder&quot;)) {</span>
<span class="nc" id="L343">        srcCompVersion = upgradeSoundRecorderProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L345" title="All 2 branches missed.">      } else if (componentType.equals(&quot;SpeechRecognizer&quot;)) {</span>
<span class="nc" id="L346">        srcCompVersion = upgradeSpeechRecognizerProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L348" title="All 2 branches missed.">      } else if (componentType.equals(&quot;Spreadsheet&quot;)) {</span>
<span class="nc" id="L349">        srcCompVersion = upgradeSpreadsheetProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L351" title="All 2 branches missed.">      } else if (componentType.equals(&quot;TimePicker&quot;)) {</span>
<span class="nc" id="L352">        srcCompVersion = upgradeTimePickerProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L354" title="All 2 branches missed.">      } else if (componentType.equals(&quot;TinyDB&quot;)) {</span>
<span class="nc" id="L355">        srcCompVersion = upgradeTinyDBProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L357" title="All 2 branches missed.">      } else if (componentType.equals(&quot;TinyWebDB&quot;)) {</span>
<span class="nc" id="L358">        srcCompVersion = upgradeTinyWebDBProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L360" title="All 2 branches missed.">      } else if (componentType.equals(&quot;VerticalArrangement&quot;)) {</span>
<span class="nc" id="L361">        srcCompVersion = upgradeVerticalArrangementProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L363" title="All 2 branches missed.">      } else if (componentType.equals(&quot;VerticalScrollArrangement&quot;)) {</span>
<span class="nc" id="L364">        srcCompVersion = upgradeVerticalScrollArrangementProperties(componentProperties,</span>
            srcCompVersion);

<span class="nc bnc" id="L367" title="All 2 branches missed.">      } else if (componentType.equals(&quot;VideoPlayer&quot;)) {</span>
<span class="nc" id="L368">        srcCompVersion = upgradeVideoPlayerProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L370" title="All 2 branches missed.">      } else if (componentType.equals(&quot;TextBox&quot;)) {</span>
<span class="nc" id="L371">        srcCompVersion = upgradeTextBoxProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L373" title="All 2 branches missed.">      } else if (componentType.equals(&quot;Texting&quot;)) {</span>
<span class="nc" id="L374">        srcCompVersion = upgradeTextingProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L376" title="All 2 branches missed.">      }  else if (componentType.equals(&quot;Notifier&quot;)) {</span>
<span class="nc" id="L377">        srcCompVersion = upgradeNotifierProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L379" title="All 2 branches missed.">      } else if (componentType.equals(&quot;Twitter&quot;)) {</span>
<span class="nc" id="L380">        srcCompVersion = upgradeTwitterProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L382" title="All 2 branches missed.">      } else if (componentType.equals(&quot;Web&quot;)) {</span>
<span class="nc" id="L383">        srcCompVersion = upgradeWebProperties(componentProperties, srcCompVersion);</span>

<span class="nc bnc" id="L385" title="All 2 branches missed.">      } else if (componentType.equals(&quot;WebViewer&quot;)) {</span>
<span class="nc" id="L386">        srcCompVersion = upgradeWebViewerProperties(componentProperties, srcCompVersion);</span>
<span class="nc bnc" id="L387" title="All 2 branches missed.">      } else if (componentType.equals(&quot;FirebaseDB&quot;)) {</span>
<span class="nc" id="L388">        srcCompVersion = upgradeFirebaseDBProperties(componentProperties, srcCompVersion);</span>
<span class="nc bnc" id="L389" title="All 2 branches missed.">      } else if (componentType.equals(&quot;Pedometer&quot;)) {</span>
<span class="nc" id="L390">        srcCompVersion = upgradePedometerProperties(componentProperties, srcCompVersion);</span>
<span class="nc bnc" id="L391" title="All 2 branches missed.">      } else if (componentType.equals(&quot;Map&quot;)) {</span>
<span class="nc" id="L392">        srcCompVersion = upgradeMapProperties(componentProperties, srcCompVersion);</span>
<span class="nc bnc" id="L393" title="All 2 branches missed.">      } else if (componentType.equals(&quot;Circle&quot;)) {</span>
<span class="nc" id="L394">        srcCompVersion = upgradeCircleProperties(componentProperties, srcCompVersion);</span>
<span class="nc bnc" id="L395" title="All 2 branches missed.">      } else if (componentType.equals(&quot;LineString&quot;)) {</span>
<span class="nc" id="L396">        srcCompVersion = upgradeLineStringProperties(componentProperties, srcCompVersion);</span>
<span class="nc bnc" id="L397" title="All 2 branches missed.">      } else if (componentType.equals(&quot;Marker&quot;)) {</span>
<span class="nc" id="L398">        srcCompVersion = upgradeMarkerProperties(componentProperties, srcCompVersion);</span>
<span class="nc bnc" id="L399" title="All 2 branches missed.">      } else if (componentType.equals(&quot;Polygon&quot;)) {</span>
<span class="nc" id="L400">        srcCompVersion = upgradePolygonProperties(componentProperties, srcCompVersion);</span>
<span class="nc bnc" id="L401" title="All 2 branches missed.">      } else if (componentType.equals(&quot;Rectangle&quot;)) {</span>
<span class="nc" id="L402">        srcCompVersion = upgradeRectangleProperties(componentProperties, srcCompVersion);</span>
<span class="nc bnc" id="L403" title="All 2 branches missed.">      } else if (componentType.equals(&quot;FeatureCollection&quot;)) {</span>
<span class="nc" id="L404">        srcCompVersion = upgradeFeatureCollection(componentProperties, srcCompVersion);</span>
<span class="nc bnc" id="L405" title="All 2 branches missed.">      } else if (componentType.equals(&quot;Navigation&quot;)) {</span>
<span class="nc" id="L406">        srcCompVersion = upgradeNavigationProperties(componentProperties, srcCompVersion);</span>
<span class="nc bnc" id="L407" title="All 2 branches missed.">      } else if (componentType.equals(&quot;YandexTranslate&quot;)) {</span>
<span class="nc" id="L408">        srcCompVersion = upgradeYandexTranslateProperties(componentProperties, srcCompVersion);</span>
<span class="nc bnc" id="L409" title="All 2 branches missed.">      } else if (componentType.equals(&quot;CloudDB&quot;)) {</span>
<span class="nc" id="L410">        srcCompVersion = upgradeCloudDBProperties(componentProperties, srcCompVersion);</span>
<span class="nc bnc" id="L411" title="All 2 branches missed.">      } else if (componentType.equals(&quot;Ev3ColorSensor&quot;)) {</span>
<span class="nc" id="L412">        srcCompVersion = upgradeEv3ColorSensorProperties(componentProperties, srcCompVersion);</span>
<span class="nc bnc" id="L413" title="All 2 branches missed.">      } else if (componentType.equals(&quot;Ev3GyroSensor&quot;)) {</span>
<span class="nc" id="L414">        srcCompVersion = upgradeEv3GyroSensorProperties(componentProperties, srcCompVersion);</span>
<span class="nc bnc" id="L415" title="All 2 branches missed.">      } else if (componentType.equals(&quot;Ev3UltrasonicSensor&quot;)) {</span>
<span class="nc" id="L416">        srcCompVersion = upgradeEv3UltrasonicSensorProperties(componentProperties, srcCompVersion);</span>
<span class="nc bnc" id="L417" title="All 2 branches missed.">      } else if (componentType.equals(&quot;NxtDirectCommands&quot;)) {</span>
<span class="nc" id="L418">        srcCompVersion = upgradeNxtDirectCommandsProperties(componentProperties, srcCompVersion);</span>
      }

<span class="nc bnc" id="L421" title="All 2 branches missed.">      if (srcCompVersion &lt; sysCompVersion) {</span>
        // If we got here, a component needed to be upgraded, but nothing handled it.
        // NOTE(lizlooney,user) - we need to make sure that this situation does not happen by
        // adding the appropriate code above to handle all component upgrades.
<span class="nc" id="L425">        throw new LoadException(</span>
<span class="nc" id="L426">            MESSAGES.noUpgradeStrategyException(componentType, srcCompVersion, sysCompVersion));</span>
      }

      // The component was upgraded. Update the $Version property.
<span class="nc" id="L430">      componentProperties.put(&quot;$Version&quot;, new ClientJsonString(&quot;&quot; + srcCompVersion));</span>

    }
<span class="nc" id="L433">  }</span>

  private static void unquotePropertyValues(Map&lt;String, JSONValue&gt; componentProperties,
      String componentType) {
    // From the component database, get the map of property names and types for the component type.
<span class="nc" id="L438">    Map&lt;String, String&gt; propertyTypesByName =</span>
<span class="nc" id="L439">        COMPONENT_DATABASE.getPropertyTypesByName(componentType);</span>

    // Iterate through the component properties.
<span class="nc bnc" id="L442" title="All 2 branches missed.">    for (String propertyName : componentProperties.keySet()) {</span>
      // Get the property type.
<span class="nc" id="L444">      String propertyType = propertyTypesByName.get(propertyName);</span>
      // In theory the check for propertyType == null shouldn't be necessary
      // but I have sometimes had a problem with it being null when running
      // with GWT debugging. Maybe it changes the timing somehow. Anyway,
      // this test for null should not hurt anything. -Sharon
<span class="nc bnc" id="L449" title="All 2 branches missed.">      if (propertyType == null) {</span>
<span class="nc" id="L450">        OdeLog.wlog(&quot;Couldn't find propertyType for property &quot; + propertyName +</span>
            &quot; in component type &quot; + componentType);
<span class="nc" id="L452">        continue;</span>
      }
      // If the property type is one that was previously quoted, unquote the value.
<span class="nc bnc" id="L455" title="All 2 branches missed.">      if (propertyType.equals(&quot;asset&quot;) ||</span>
<span class="nc bnc" id="L456" title="All 2 branches missed.">          propertyType.equals(&quot;BluetoothClient&quot;) ||</span>
<span class="nc bnc" id="L457" title="All 2 branches missed.">          propertyType.equals(&quot;component&quot;) ||</span>
<span class="nc bnc" id="L458" title="All 2 branches missed.">          propertyType.equals(&quot;lego_nxt_sensor_port&quot;) ||</span>
<span class="nc bnc" id="L459" title="All 2 branches missed.">          propertyType.equals(&quot;string&quot;)) {</span>
        // Unquote the property value.
<span class="nc" id="L461">        JSONValue propertyValue = componentProperties.get(propertyName);</span>
<span class="nc" id="L462">        String propertyValueString = propertyValue.asString().getString();</span>
<span class="nc" id="L463">        propertyValueString = StringUtils.unquote(propertyValueString);</span>
<span class="nc" id="L464">        componentProperties.put(propertyName, new ClientJsonString(propertyValueString));</span>
      }
<span class="nc" id="L466">    }</span>
<span class="nc" id="L467">  }</span>

  private static int upgradeAccelerometerSensorProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L471" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The AccelerometerSensor.MinimumInterval property was added.
      // No properties need to be modified to upgrade to version 2.
<span class="nc" id="L474">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L476" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // The AccelerometerSensor.Sensitivity property was added.
      // No properties need to be modified to upgrade to version 3.
<span class="nc" id="L479">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L481" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // The LegacyMode property was added
      // No properties need to be modified to upgrade to version 4.
<span class="nc" id="L484">      srcCompVersion = 4;</span>
    }
<span class="nc bnc" id="L486" title="All 2 branches missed.">    if (srcCompVersion &lt; 5) {</span>
      // Adds Sensitivity dropdown block.
<span class="nc" id="L488">      srcCompVersion = 5;</span>
    }
<span class="nc" id="L490">    return srcCompVersion;</span>
  }

  private static int upgradeActivityStarterProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L495" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The ActivityStarter.DataType, ActivityStarter.ResultType, and ActivityStarter.ResultUri
      // properties were added.
      // The ActivityStarter.ResolveActivity method was added.
      // The ActivityStarter.ActivityError event was added.
      // No properties need to be modified to upgrade to version 2.
<span class="nc" id="L501">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L503" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // The ActivityStarter.ActivityError event was marked userVisible false and is no longer
      // used.
      // No properties need to be modified to upgrade to version 3.
<span class="nc" id="L507">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L509" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // The ActivityStarter.StartActivity method was modified to provide the parent Form's
      // screen animation type.
      // No properties need to be modified to upgrade to version 4.
<span class="nc" id="L513">      srcCompVersion = 4;</span>
    }
<span class="nc bnc" id="L515" title="All 2 branches missed.">    if (srcCompVersion &lt; 5) {</span>
      // The ActivityStarter.ActivityCanceled event was added.
      // No properties need to be modified to upgrade to version 5.
<span class="nc" id="L518">      srcCompVersion = 5;</span>
    }
<span class="nc bnc" id="L520" title="All 2 branches missed.">    if (srcCompVersion &lt; 6) {</span>
      // Extras property was added to accept a list of key-value pairs to put to the intent
<span class="nc" id="L522">      String defaultValue = &quot;&quot;;</span>
<span class="nc" id="L523">      boolean sendWarning = false;</span>

<span class="nc bnc" id="L525" title="All 2 branches missed.">      if (componentProperties.containsKey(&quot;ExtraKey&quot;)) {</span>
<span class="nc" id="L526">        String extraKeyValue = componentProperties.get(&quot;ExtraKey&quot;).asString().getString();</span>
<span class="nc bnc" id="L527" title="All 2 branches missed.">        if (!extraKeyValue.equals(defaultValue)) {</span>
<span class="nc" id="L528">          sendWarning = true;</span>
        }
      }

<span class="nc bnc" id="L532" title="All 2 branches missed.">      if (componentProperties.containsKey(&quot;ExtraValue&quot;)) {</span>
<span class="nc" id="L533">        String extraValueValue = componentProperties.get(&quot;ExtraValue&quot;).asString().getString();</span>
<span class="nc bnc" id="L534" title="All 2 branches missed.">        if (!extraValueValue.equals(defaultValue)) {</span>
<span class="nc" id="L535">          sendWarning = true;</span>
        }
      }

<span class="nc bnc" id="L539" title="All 2 branches missed.">      if (sendWarning) {</span>
<span class="nc" id="L540">        Window.alert(MESSAGES.extraKeyValueWarning());</span>
      }

<span class="nc" id="L543">      srcCompVersion = 6;</span>
    }
<span class="nc" id="L545">    return srcCompVersion;</span>
  }

  private static int upgradeBallProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L550" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The Heading property was changed from int to double.
<span class="nc" id="L552">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L554" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // The Z property was added.
<span class="nc" id="L556">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L558" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // The TouchUp, TouchDown, and Flung events were added. (for all sprites)
      // No properties need to be modified to upgrade to version 4.
<span class="nc" id="L561">      srcCompVersion = 4;</span>
      }
<span class="nc bnc" id="L563" title="All 2 branches missed.">    if (srcCompVersion &lt; 5) {</span>
      // The callback parameters speed and heading were added to Flung.
<span class="nc" id="L565">      srcCompVersion = 5;</span>
    }
<span class="nc bnc" id="L567" title="All 2 branches missed.">    if (srcCompVersion &lt; 6) {</span>
      // The OriginAtCenter property was added.
<span class="nc" id="L569">      srcCompVersion = 6;</span>
    }
<span class="nc bnc" id="L571" title="All 2 branches missed.">    if (srcCompVersion &lt; 7) {</span>
      // The MoveToPoint method was added.
<span class="nc" id="L573">      srcCompVersion = 7;</span>
    }
<span class="nc bnc" id="L575" title="All 2 branches missed.">    if (srcCompVersion &lt; 8) {</span>
      // Direction dropdown blocks were added.
<span class="nc" id="L577">      srcCompVersion = 8;</span>
    }
<span class="nc" id="L579">    return srcCompVersion;</span>
  }
  private static int upgradeBarcodeScannerProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L583" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The UseExternalScanner property was added.
<span class="nc" id="L585">      srcCompVersion = 2;</span>
    }
<span class="nc" id="L587">    return srcCompVersion;</span>
  }

  private static int upgradeBluetoothClientProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L592" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The BluetoothClient.Enabled property was added.
      // No properties need to be modified to upgrade to version 2.
<span class="nc" id="L595">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L597" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // The BluetoothClient.BluetoothError event was marked userVisible false and is no longer
      // used.
      // No properties need to be modified to upgrade to version 3.
<span class="nc" id="L601">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L603" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // The BluetoothClient.DelimiterByte property was added.
      // No properties need to be modified to upgrade to version 4.
<span class="nc" id="L606">      srcCompVersion = 4;</span>
    }
<span class="nc bnc" id="L608" title="All 2 branches missed.">    if (srcCompVersion &lt; 5) {</span>
      // The BluetoothClient.Secure property was added.
      // No properties need to be modified to upgrade to version 5.
<span class="nc" id="L611">      srcCompVersion = 5;</span>
    }
<span class="nc bnc" id="L613" title="All 2 branches missed.">    if (srcCompVersion &lt; 6) {</span>
      // The BluetoothClient.DisconnectOnError property was added.
      // No properties need to be modified to upgrade to version 6.
<span class="nc" id="L616">      srcCompVersion = 6;</span>
    }
<span class="nc bnc" id="L618" title="All 2 branches missed.">    if (srcCompVersion &lt; 7) {</span>
      // The PollingRate property was added.
      // No properties need to be modified to upgrade to version 7.
<span class="nc" id="L621">      srcCompVersion = 7;</span>
    }
<span class="nc bnc" id="L623" title="All 2 branches missed.">    if (srcCompVersion &lt; 8) {</span>
      // The NoLocationNeeded property was added.
      // No properties need to be modified to upgrade to version 8.
<span class="nc" id="L626">      srcCompVersion = 8;</span>
    }
<span class="nc" id="L628">    return srcCompVersion;</span>
  }

  private static int upgradeBluetoothServerProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L633" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The BluetoothServer.Enabled property was added.
      // No properties need to be modified to upgrade to version 2.
<span class="nc" id="L636">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L638" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // The BluetoothServer.BluetoothError event was marked userVisible false and is no longer
      // used.
      // No properties need to be modified to upgrade to version 3.
<span class="nc" id="L642">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L644" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // The BluetoothServer.DelimiterByte property was added.
      // No properties need to be modified to upgrade to version 4.
<span class="nc" id="L647">      srcCompVersion = 4;</span>
    }
<span class="nc bnc" id="L649" title="All 2 branches missed.">    if (srcCompVersion &lt; 5) {</span>
      // The BluetoothServer.Secure property was added.
      // No properties need to be modified to upgrade to version 5.
<span class="nc" id="L652">      srcCompVersion = 5;</span>
    }
<span class="nc" id="L654">    return srcCompVersion;</span>
  }
  private static int upgradeSliderProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L658" title="All 2 branches missed.">    if (srcCompVersion &lt; 1) {</span>
      // Initial version. Placeholder for future upgrades
<span class="nc" id="L660">      srcCompVersion = 1;</span>
    }
<span class="nc bnc" id="L662" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // Added the property to allow for the removal of the Thumb Slider
<span class="nc" id="L664">      srcCompVersion = 2;</span>
    }
<span class="nc" id="L666">    return srcCompVersion;</span>
  }

  private static int upgradeTextToSpeechProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L671" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // Added speech pitch and rate
<span class="nc" id="L673">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L675" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // The AvailableLanguages property was added
      // The AvailableCountires property was added
      // No properties need to be modified to upgrade to version 3.
<span class="nc" id="L679">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L681" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // the Country designer property was changed to use a ChoicePropertyEditor
      // the Language designer property was changed to use a ChoicePropertyEditor
<span class="nc" id="L684">      srcCompVersion = 4;</span>
    }
<span class="nc bnc" id="L686" title="All 2 branches missed.">    if (srcCompVersion &lt; 5) {</span>
      // default value was added to the Country designer property
      // default value was added to the Language designer property
<span class="nc" id="L689">      srcCompVersion = 5;</span>
    }
<span class="nc" id="L691">    return srcCompVersion;</span>
  }

  private static int upgradeButtonProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L696" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The Alignment property was renamed to TextAlignment.
<span class="nc" id="L698">      handlePropertyRename(componentProperties, &quot;Alignment&quot;, &quot;TextAlignment&quot;);</span>
      // Properties related to this component have now been upgraded to version 2.
<span class="nc" id="L700">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L702" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // The LongClick event was added.
      // No properties need to be modified to upgrade to version 3.
<span class="nc" id="L705">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L707" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // The Shape property was added.
      // No properties need to be modified to upgrade to version 4.
<span class="nc" id="L710">      srcCompVersion = 4;</span>
    }
<span class="nc bnc" id="L712" title="All 2 branches missed.">    if (srcCompVersion &lt; 5) {</span>
      // The ShowFeedback property was added.
      // No properties need to be modified to upgrade to version 5.
<span class="nc" id="L715">      srcCompVersion = 5;</span>
    }
<span class="nc bnc" id="L717" title="All 2 branches missed.">    if (srcCompVersion &lt; 6) {</span>
      // - Added TouchUp and TouchDown events
      // - FontSize, FontBold, FontItalic properties made visible in block editor
      // No properties need to be modified to upgrade to version 6.
<span class="nc" id="L721">      srcCompVersion = 6;</span>
    }
<span class="nc bnc" id="L723" title="All 2 branches missed.">    if (srcCompVersion &lt; 7) {</span>
      // Assets helper block was added.
<span class="nc" id="L725">      srcCompVersion = 7;</span>
    }
<span class="nc" id="L727">    return srcCompVersion;</span>
  }

  private static int upgradeCameraProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L732" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The UseFront property was added.
      // No properties need to be modified to upgrade to version 2.
<span class="nc" id="L735">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L737" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // The UseFront property was removed, it isn't supported in
      // newer versions of Android
<span class="nc bnc" id="L740" title="All 2 branches missed.">      if (componentProperties.containsKey(&quot;UseFront&quot;)) {</span>
<span class="nc" id="L741">        componentProperties.remove(&quot;UseFront&quot;);</span>
<span class="nc" id="L742">        upgradeWarnDialog(MESSAGES.useFrontDeprecated());</span>
      }
<span class="nc" id="L744">      srcCompVersion = 3;</span>
    }
<span class="nc" id="L746">    return srcCompVersion;</span>
  }

  private static int upgradeCanvasProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L751" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The LineWidth property was added.
      // No properties need to be modified to upgrade to version 2.
<span class="nc" id="L754">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L756" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // The FontSize and TextAlignment properties and
      // the DrawText and DrawTextAtAngle methods were added.
      // No properties need to be modified to upgrade to version 3.
<span class="nc" id="L760">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L762" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // No properties need to be modified to upgrade to version 4.
      // The Save and SaveAs methods were added.
<span class="nc" id="L765">      srcCompVersion = 4;</span>
    }
<span class="nc bnc" id="L767" title="All 2 branches missed.">    if (srcCompVersion &lt; 5) {</span>
      // No properties need to be modified to upgrade to version 5.
      // The methods GetBackgroundPixelColor, GetPixelColor, and
      // SetBackgroundPixelColor were added.
<span class="nc" id="L771">      srcCompVersion = 5;</span>
    }
<span class="nc bnc" id="L773" title="All 2 branches missed.">    if (srcCompVersion &lt; 6) {</span>
      // No properties need to be modified to upgrade to version 6.
      // The events TouchDown, TouchUp, and Flung were added.
<span class="nc" id="L776">      srcCompVersion = 6;</span>
    }
<span class="nc bnc" id="L778" title="All 2 branches missed.">    if (srcCompVersion &lt; 7) {</span>
      // The callback parameters speed and heading were added to Flung.
<span class="nc" id="L780">      srcCompVersion = 7;</span>
    }
<span class="nc bnc" id="L782" title="All 2 branches missed.">    if (srcCompVersion &lt; 8) {</span>
      // DrawCircle parameter names changed to centerx,centery, radius
      // Touched parameter touchedSprite name changed to touchedAnySprite
      // Dragged parameter draggedSprite name changed to draggedAnySprite
<span class="nc" id="L786">      srcCompVersion = 8;</span>
    }
<span class="nc bnc" id="L788" title="All 2 branches missed.">    if (srcCompVersion &lt; 9) {</span>
      // DrawCircle takes a new isFilled as fourth parameter.
<span class="nc" id="L790">      srcCompVersion = 9;</span>
    }
<span class="nc bnc" id="L792" title="All 2 branches missed.">    if (srcCompVersion &lt; 10) {</span>
      // TextAlignment default was changed to Component.ALIGNMENT_CENTER.
      // Previously the default was ALIGNMENT_NORMAL (left).
<span class="nc" id="L795">      int oldDefault = 0; // ALIGNMENT_NORMAL (left)</span>
<span class="nc" id="L796">      JSONValue def = new ClientJsonString(Integer.toString(oldDefault));</span>
<span class="nc" id="L797">      componentProperties.put(&quot;TextAlignment&quot;, def);</span>
<span class="nc" id="L798">      srcCompVersion = 10;</span>
    }
<span class="nc bnc" id="L800" title="All 2 branches missed.">    if (srcCompVersion &lt; 11) {</span>
      // No properties need to be modified to upgrade to version 11.
      // DrawShape &amp; DrawArc was added.
<span class="nc" id="L803">      srcCompVersion = 11;</span>
    }
<span class="nc bnc" id="L805" title="All 2 branches missed.">    if (srcCompVersion &lt; 12) {</span>
      // The ExtendMovesOutsideCanvas property was added in version 12.
<span class="nc" id="L807">      srcCompVersion = 12;</span>
    }
<span class="nc bnc" id="L809" title="All 2 branches missed.">    if (srcCompVersion &lt; 13) {</span>
      // The BackgroundImageinBase64 property was added in version 13.
<span class="nc" id="L811">      srcCompVersion = 13;</span>
    }
<span class="nc bnc" id="L813" title="All 2 branches missed.">    if (srcCompVersion &lt; 14) {</span>
      // The TAP_THRESHOLD value was changed to be user settable in version 14.
      // TAP_THRESHOLD variable is now changed to tapThreshold
      // TapThreshold was added
<span class="nc" id="L817">      srcCompVersion = 14;</span>
    }
<span class="nc bnc" id="L819" title="All 2 branches missed.">    if (srcCompVersion &lt; 15) {</span>
      // Assets helper block was added.
<span class="nc" id="L821">      srcCompVersion = 15;</span>
    }
<span class="nc" id="L823">    return srcCompVersion;</span>
  }

  private static int upgradeChartProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L828" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The XFromZero and YFromZero properties were added.
<span class="nc" id="L830">      srcCompVersion = 2;</span>
    }
<span class="nc" id="L832">    return srcCompVersion;</span>
  }

  private static int upgradeCheckBoxProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L837" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The Value property was renamed to Checked.
<span class="nc" id="L839">      handlePropertyRename(componentProperties, &quot;Value&quot;, &quot;Checked&quot;);</span>
      // Properties related to this component have now been upgraded to version 2.
<span class="nc" id="L841">      srcCompVersion = 2;</span>
    }
<span class="nc" id="L843">    return srcCompVersion;</span>
  }

  private static int upgradeClockProperties(Map&lt;String, JSONValue&gt; componentProperties,
    int srcCompVersion) {
<span class="nc bnc" id="L848" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // (2) The FormatDate and FormatDateTime methods were modified to take another parameter of pattern.
      // No properties need to be modified to upgrade to version 2.
      // (3) Duration Support was added
      // No properties need to be added to upgrade to version 3.
      // (4) Added MakeDate, MakeTime, MakeInstantFromParts methods
      // No properties need to be added to upgrade to version 4.
<span class="nc" id="L855">      srcCompVersion = 4;</span>
    }
<span class="nc" id="L857">    return srcCompVersion;</span>
  }

  private static int upgradeContactPickerProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L862" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The Alignment property was renamed to TextAlignment.
<span class="nc" id="L864">      handlePropertyRename(componentProperties, &quot;Alignment&quot;, &quot;TextAlignment&quot;);</span>
      // Properties related to this component have now been upgraded to version 2.
<span class="nc" id="L866">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L868" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // The Open method was added.  No changes are needed.
<span class="nc" id="L870">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L872" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // The Shape property was added.
      // No properties need to be modified to upgrade to version 4.
<span class="nc" id="L875">      srcCompVersion = 4;</span>
    }
<span class="nc bnc" id="L877" title="All 2 branches missed.">    if (srcCompVersion &lt; 5) {</span>
      // The PhoneNumber, PhoneNumberList, and EmailAddressList properties were added.
      // For Eclair and up, we now use ContactsContract instead of the deprecated Contacts.
<span class="nc" id="L880">      srcCompVersion = 5;</span>
    }
<span class="nc bnc" id="L882" title="All 2 branches missed.">    if (srcCompVersion &lt; 6) {</span>
      // The ContactUri property was added.
      // No properties need to be modified to upgrade to version 6.
<span class="nc" id="L885">      srcCompVersion = 6;</span>
    }
<span class="nc" id="L887">    return srcCompVersion;</span>
  }

  private static int upgradeDatePickerProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L892" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The SetDateToDisplay and LaunchPicker methods were added.
      // No properties need to be modified to upgrade to version 2.
<span class="nc" id="L895">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L897" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // SetDateToDisplayFromInstant, and Instant property are added.
      // No properties need to be modified to upgrade to version 3.
<span class="nc" id="L900">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L902" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // Assets helper block was added.
<span class="nc" id="L904">      srcCompVersion = 4;</span>
    }
<span class="nc" id="L906">    return srcCompVersion;</span>
  }

  private static int upgradeEmailPickerProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L911" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The Alignment property was renamed to TextAlignment.
<span class="nc" id="L913">      handlePropertyRename(componentProperties, &quot;Alignment&quot;, &quot;TextAlignment&quot;);</span>
      // Properties related to this component have now been upgraded to version 2.
<span class="nc" id="L915">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L917" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // RequestFocus function was added (via TextBoxBase)
<span class="nc" id="L919">      srcCompVersion = 3;</span>
    }
<span class="nc" id="L921">    return srcCompVersion;</span>
  }

  private static int upgradeFileProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L926" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // File.AfterFileSaved event was added.
      // No properties need to be modified to upgrade to version 2.
<span class="nc" id="L929">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L931" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // File.LegacyMode property was added.
      // No properties need to be modified to upgrade to version 3.
<span class="nc" id="L934">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L936" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // AccessMode was added.
      // LegacyMode was removed.
      // If LegacyMode was set, AccessMode should be set to &quot;2&quot;, which is Legacy.
<span class="nc bnc" id="L940" title="All 2 branches missed.">      if (componentProperties.containsKey(&quot;LegacyMode&quot;)) {</span>
<span class="nc" id="L941">        componentProperties.remove(&quot;LegacyMode&quot;);</span>
        // LegacyMode maps to AccessMode 2 (Legacy)
<span class="nc" id="L943">        componentProperties.put(&quot;DefaultScope&quot;, new ClientJsonString(&quot;Legacy&quot;));</span>
      }
<span class="nc" id="L945">      srcCompVersion = 4;</span>
    }
<span class="nc" id="L947">    return srcCompVersion;</span>
  }

  private static int upgradeFormProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L952" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The Screen.Scrollable property was added.
      // If the form contains a direct child component whose height is set to fill parent,
      // we set the Scrollable property value to false.
<span class="nc bnc" id="L956" title="All 2 branches missed.">      if (componentProperties.containsKey(&quot;$Components&quot;)) {</span>
<span class="nc" id="L957">        JSONArray componentsArray = componentProperties.get(&quot;$Components&quot;).asArray();</span>
<span class="nc bnc" id="L958" title="All 2 branches missed.">        for (JSONValue nestedComponent : componentsArray.getElements()) {</span>
<span class="nc" id="L959">          Map&lt;String, JSONValue&gt; nestedComponentProperties =</span>
<span class="nc" id="L960">              nestedComponent.asObject().getProperties();</span>
<span class="nc bnc" id="L961" title="All 2 branches missed.">          if (nestedComponentProperties.containsKey(&quot;Height&quot;)) {</span>
<span class="nc" id="L962">            JSONValue heightValue = nestedComponentProperties.get(&quot;Height&quot;);</span>
<span class="nc" id="L963">            String heightString = heightValue.asString().getString();</span>
            try {
<span class="nc" id="L965">              int height = Integer.parseInt(heightString);</span>
<span class="nc bnc" id="L966" title="All 2 branches missed.">              if (height == MockVisibleComponent.LENGTH_FILL_PARENT) {</span>
                // Set the Form's Scrollable property to false.
<span class="nc" id="L968">                componentProperties.put(&quot;Scrollable&quot;, new ClientJsonString(&quot;False&quot;));</span>
<span class="nc" id="L969">                break;</span>
              }
<span class="nc" id="L971">            } catch (NumberFormatException e) {</span>
              // Ignore this. If we throw an exception here, the project is unrecoverable.
<span class="nc" id="L973">            }</span>
          }
<span class="nc" id="L975">        }</span>
      }
      // Properties related to this component have now been upgraded to version 2.
<span class="nc" id="L978">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L980" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // The Screen.Icon property was added.
      // No properties need to be modified to upgrade to version 3.
<span class="nc" id="L983">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L985" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // The Screen.ErrorOccurred event was added.
      // No properties need to be modified to upgrade to version 4.
<span class="nc" id="L988">      srcCompVersion = 4;</span>
    }
<span class="nc bnc" id="L990" title="All 2 branches missed.">    if (srcCompVersion &lt; 5) {</span>
      // The Screen.ScreenOrientation property and Screen.ScreenOrientationChanged event were
      // added.
      // No properties need to be modified to upgrade to version 5.
<span class="nc" id="L994">      srcCompVersion = 5;</span>
    }
<span class="nc bnc" id="L996" title="All 2 branches missed.">    if (srcCompVersion &lt; 6) {</span>
      // The SwitchForm and SwitchFormWithArgs methods were removed and the OtherScreenClosed event
      // was added.
<span class="nc" id="L999">      srcCompVersion = 6;</span>
    }
<span class="nc bnc" id="L1001" title="All 2 branches missed.">    if (srcCompVersion &lt; 7) {</span>
      // The VersionCode and VersionName properties were added. No properties need to be modified
      // to update to version 7.
<span class="nc" id="L1004">      srcCompVersion = 7;</span>
    }

<span class="nc bnc" id="L1007" title="All 2 branches missed.">    if (srcCompVersion &lt; 8) {</span>
      // The AlignHorizontal and AlignVertical properties were added. No blocks need to be modified
      // to upgrade to version 8.
<span class="nc" id="L1010">      srcCompVersion = 8;</span>
    }
<span class="nc bnc" id="L1012" title="All 2 branches missed.">    if (srcCompVersion &lt; 9) {</span>
      // The OpenScreenAnimation and CloseScreenAnimation properties were added. No blocks need
      // to be modified to upgrade to version 9.
<span class="nc" id="L1015">      srcCompVersion = 9;</span>
    }
<span class="nc bnc" id="L1017" title="All 2 branches missed.">    if (srcCompVersion &lt; 10) {</span>
      // The BackPressed event was added. No blocks need to be modified to upgrade to version 10.
<span class="nc" id="L1019">      srcCompVersion = 10;</span>
    }
<span class="nc bnc" id="L1021" title="All 2 branches missed.">    if (srcCompVersion &lt; 11) {</span>
      // OpenScreenAnimation and CloseScreenAnimation are now properties.
<span class="nc" id="L1023">      srcCompVersion = 11;</span>
    }
<span class="nc bnc" id="L1025" title="All 2 branches missed.">    if (srcCompVersion &lt; 12) {</span>
      // The AboutScreen property was added.
<span class="nc" id="L1027">      srcCompVersion = 12;</span>
    }
<span class="nc bnc" id="L1029" title="All 2 branches missed.">    if (srcCompVersion &lt; 13) {</span>
      // The Scrollable property was set to False by default.
<span class="nc bnc" id="L1031" title="All 2 branches missed.">      if (componentProperties.containsKey(&quot;Scrollable&quot;)){</span>
<span class="nc" id="L1032">        String value = ((ClientJsonString)componentProperties.get(&quot;Scrollable&quot;)).getString();</span>
<span class="nc bnc" id="L1033" title="All 2 branches missed.">        if (value.equals(&quot;False&quot;)){</span>
<span class="nc" id="L1034">          componentProperties.remove(&quot;Scrollable&quot;);</span>
        }
<span class="nc" id="L1036">      }</span>
      else {
<span class="nc" id="L1038">        componentProperties.put(&quot;Scrollable&quot;, new ClientJsonString(&quot;True&quot;));</span>
      }
<span class="nc" id="L1040">      srcCompVersion = 13;</span>
    }

<span class="nc bnc" id="L1043" title="All 2 branches missed.">    if (srcCompVersion &lt; 15) {</span>
      // The AppName property was added.
      // The Compatibility Mode property was added. No properties need to be modified to update to
      // version 7.
<span class="nc" id="L1047">      srcCompVersion = 15;</span>
    }
<span class="nc bnc" id="L1049" title="All 2 branches missed.">    if (srcCompVersion &lt; 16) {</span>
      // The ShowStatusBar property was added.
      // The TitleVisible property was added.
<span class="nc" id="L1052">      srcCompVersion = 16;</span>
    }
<span class="nc bnc" id="L1054" title="All 2 branches missed.">    if (srcCompVersion &lt; 17) {</span>
      // The CompatibilityMode property was added
      // When upgrading projects, turn on Compatbility Mode
      // NOTE: This change never saw production, but was on various
      // Test Instances
<span class="nc" id="L1059">      componentProperties.put(&quot;CompatibilityMode&quot;, new ClientJsonString(&quot;True&quot;));</span>
<span class="nc" id="L1060">      srcCompVersion = 17;</span>
    }

<span class="nc bnc" id="L1063" title="All 2 branches missed.">    if (srcCompVersion &lt; 18) {</span>
      // Compatilibity Mode property turned into the Sizing property
<span class="nc bnc" id="L1065" title="All 2 branches missed.">      if (componentProperties.containsKey(&quot;CompatibilityMode&quot;)) {</span>
<span class="nc" id="L1066">        componentProperties.remove(&quot;CompatibilityMode&quot;);</span>
      } else {
<span class="nc" id="L1068">        componentProperties.put(&quot;Sizing&quot;, new ClientJsonString(&quot;Responsive&quot;));</span>
      }
<span class="nc" id="L1070">      srcCompVersion = 18;</span>
    }

<span class="nc bnc" id="L1073" title="All 2 branches missed.">    if (srcCompVersion &lt; 19) {</span>
      // Added HideKeyboard
<span class="nc" id="L1075">      srcCompVersion = 19;</span>
    }

<span class="nc bnc" id="L1078" title="All 2 branches missed.">    if (srcCompVersion &lt; 20) {</span>
      // The ShowistsAsJson Property was added.
<span class="nc" id="L1080">      srcCompVersion = 20;</span>
    }

<span class="nc bnc" id="L1083" title="All 2 branches missed.">    if (srcCompVersion &lt; 21) {</span>
      // The AccentColor property was added.
      // The ActionBar property was added.
      // The PrimaryColor property was added.
      // The PrimaryColorDark property was added.
      // The Theme property was added.
<span class="nc" id="L1089">      srcCompVersion = 21;</span>
    }

<span class="nc bnc" id="L1092" title="All 2 branches missed.">    if (srcCompVersion &lt; 22) {</span>
      // The Theme property was updated with the Classic option.
<span class="nc" id="L1094">      srcCompVersion = 22;</span>
    }

<span class="nc bnc" id="L1097" title="All 2 branches missed.">    if (srcCompVersion &lt; 23) {</span>
      // The ActionBar property was deprecated. It should always be true in new themes, and false
      // in classic themes.
<span class="nc bnc" id="L1100" title="All 4 branches missed.">      if (componentProperties.containsKey(&quot;Theme&quot;) &amp;&amp; !&quot;Classic&quot;.equals(componentProperties.get(&quot;Theme&quot;).asString().toString())) {</span>
<span class="nc" id="L1101">        componentProperties.put(&quot;ActionBar&quot;, new ClientJsonString(&quot;True&quot;));</span>
<span class="nc bnc" id="L1102" title="All 2 branches missed.">      } else if (componentProperties.containsKey(&quot;ActionBar&quot;)) {  // Theme is Classic</span>
<span class="nc" id="L1103">        componentProperties.remove(&quot;ActionBar&quot;);  // Resets ActionBar to default (False)</span>
      }
<span class="nc" id="L1105">      srcCompVersion = 23;</span>
    }

<span class="nc bnc" id="L1108" title="All 2 branches missed.">    if (srcCompVersion &lt; 24) {</span>
      // The AskForPermissions method was added.
      // The PermissionDenied event was added.
      // The PermissionGranted event was added.
<span class="nc" id="L1112">      srcCompVersion = 24;</span>
    }

<span class="nc bnc" id="L1115" title="All 2 branches missed.">    if (srcCompVersion &lt; 25) {</span>
      // Sizing default value changed from Fixed to Responsive
<span class="nc bnc" id="L1117" title="All 2 branches missed.">      if (componentProperties.containsKey(&quot;Sizing&quot;)) {</span>
<span class="nc" id="L1118">        String value = ((ClientJsonString)componentProperties.get(&quot;Sizing&quot;)).getString();</span>
<span class="nc bnc" id="L1119" title="All 2 branches missed.">        if (value.equals(&quot;Responsive&quot;)) {</span>
<span class="nc" id="L1120">          componentProperties.remove(&quot;Sizing&quot;);</span>
        }
<span class="nc" id="L1122">      } else {</span>
<span class="nc" id="L1123">        componentProperties.put(&quot;Sizing&quot;, new ClientJsonString(&quot;Fixed&quot;));</span>
      }
<span class="nc" id="L1125">      srcCompVersion = 25;</span>
    }

<span class="nc bnc" id="L1128" title="All 2 branches missed.">    if (srcCompVersion &lt; 26) {</span>
      // ShowListsAsJson changed from False to True
<span class="nc bnc" id="L1130" title="All 2 branches missed.">      if (componentProperties.containsKey(&quot;ShowListsAsJson&quot;)) {</span>
<span class="nc" id="L1131">        final String value = componentProperties.get(&quot;ShowListsAsJson&quot;).asString().getString();</span>
<span class="nc bnc" id="L1132" title="All 2 branches missed.">        if (value.equals(&quot;True&quot;)) {</span>
<span class="nc" id="L1133">          componentProperties.remove(&quot;ShowListsAsJson&quot;);</span>
        }
<span class="nc" id="L1135">      } else {</span>
<span class="nc" id="L1136">        componentProperties.put(&quot;ShowListsAsJson&quot;, new ClientJsonString(&quot;False&quot;));</span>
      }
<span class="nc" id="L1138">      srcCompVersion = 26;</span>
    }

<span class="nc bnc" id="L1141" title="All 2 branches missed.">    if (srcCompVersion &lt; 27) {</span>
      // Platform and PlatformVersion blocks were added.
<span class="nc" id="L1143">      srcCompVersion = 27;</span>
    }

<span class="nc bnc" id="L1146" title="All 2 branches missed.">    if (srcCompVersion &lt; 28) {</span>
      // HighContrast and BigDefaultText properties were added.
<span class="nc" id="L1148">      srcCompVersion = 28;</span>
    }
<span class="nc bnc" id="L1150" title="All 2 branches missed.">    if (srcCompVersion &lt; 29) {</span>
      // ScreenAnimation dropdown blocks were added.
      // HorizontalAlignment and VerticalAlignment dropdown blocks were added.
      // Adds dropdown block for ScreenOrientation.
      // Assets helper block was added.
      // Adds Permission dropdown block.
<span class="nc" id="L1156">      srcCompVersion = 29;</span>
    }
<span class="nc bnc" id="L1158" title="All 2 branches missed.">    if (srcCompVersion &lt; 30) {</span>
      // The DefaultFileScope property was added.
<span class="nc" id="L1160">      srcCompVersion = 30;</span>
    }

<span class="nc" id="L1163">    return srcCompVersion;</span>
  }

  private static int upgradeFusiontablesControlProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1168" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // No properties need to be modified to upgrade to version 2.
      // The ApiKey property and the SendQuery and ForgetLogin methods were added.
<span class="nc" id="L1171">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L1173" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // No properties need to be modified to upgrade to version 3.
      // GetRows, InsertRows and GetRowsWithConditions methods were added.
      // KeyFile, UseServiceAuthentication and ServiceAccountEmail properties
      // were added.
<span class="nc" id="L1178">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L1180" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // The LoadingDialogMessage property was added
      // The ShowLoadingDialog property was added
<span class="nc" id="L1183">      srcCompVersion = 4;</span>
    }
<span class="nc" id="L1185">    return srcCompVersion;</span>
  }

  private static int upgradeHorizontalArrangementProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1190" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The AlignHorizontal and AlignVertical properties were added. No blocks need to be modified
      // to upgrqde to version 2.
<span class="nc" id="L1193">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L1195" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // - Added background color &amp; image
<span class="nc" id="L1197">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L1199" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // Add HorizontalAlignment and VerticalAlignment dropdown blocks.
      // Assets helper block was added.
<span class="nc" id="L1202">      srcCompVersion = 4;</span>
    }
<span class="nc" id="L1204">    return srcCompVersion;</span>
  }

  private static int upgradeHorizontalScrollArrangementProperties(
      Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1210" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // Add HorizontalAlignment and VerticalAlignment dropdown blocks.
      // Assets helper block was added.
<span class="nc" id="L1213">      srcCompVersion = 2;</span>
    }
<span class="nc" id="L1215">    return srcCompVersion;</span>
  }

  private static int upgradeImageProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1220" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The RotationAngle property was added.
      // No properties need to be modified to upgrade to version 2.
<span class="nc" id="L1223">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L1225" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // ScalePictureToFit was replaced by Scaling property
      // Note: We will do this upgrade in a future release (jis: 2/12/2016)
      // if (componentProperties.containsKey(&quot;ScalePictureToFit&quot;)) {
      //   JSONValue propValue = componentProperties.remove(&quot;ScalePictureToFit&quot;);
      //   if (propValue.asString().getString().equals(&quot;True&quot;)) {
      //     // 1 corresponds to Scale to fit
      //     componentProperties.put(&quot;Scaling&quot;, new ClientJsonString(&quot;1&quot;));
      //   }
      // }
<span class="nc" id="L1235">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L1237" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
     // The Click event was added.
     // The Clickable property was added.
<span class="nc" id="L1240">     srcCompVersion = 4;</span>
    }
<span class="nc bnc" id="L1242" title="All 2 branches missed.">    if (srcCompVersion &lt; 5) {</span>
      // The AlternateText property was added.
<span class="nc" id="L1244">      srcCompVersion = 5;</span>
    }
<span class="nc bnc" id="L1246" title="All 2 branches missed.">    if (srcCompVersion &lt; 6) {</span>
      // Assets helper block was added.
<span class="nc" id="L1248">      srcCompVersion = 6;</span>
    }
<span class="nc" id="L1250">    return srcCompVersion;</span>
  }

  private static int upgradeImagePickerProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1255" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The Alignment property was renamed to TextAlignment.
<span class="nc" id="L1257">      handlePropertyRename(componentProperties, &quot;Alignment&quot;, &quot;TextAlignment&quot;);</span>
      // Properties related to this component have now been upgraded to version 2.
<span class="nc" id="L1259">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L1261" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // The Open method was added.  No changes are needed.
<span class="nc" id="L1263">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L1265" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // The Shape property was added.
      // No properties need to be modified to upgrade to version 4.
<span class="nc" id="L1268">      srcCompVersion = 4;</span>
    }
<span class="nc bnc" id="L1270" title="All 2 branches missed.">    if (srcCompVersion &lt; 5) {</span>
      // The ImagePath property was renamed to Selection.
<span class="nc" id="L1272">      handlePropertyRename(componentProperties, &quot;ImagePath&quot;, &quot;Selection&quot;);</span>
      // Properties related to this component have now been upgraded to version 2.
<span class="nc" id="L1274">      srcCompVersion = 5;</span>
    }
<span class="nc" id="L1276">    return srcCompVersion;</span>
  }

  private static int upgradeImageSpriteProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1281" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The SpriteComponent.Rotates property was added
      // No properties need to be modified to upgrade to version 2.
<span class="nc" id="L1284">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L1286" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // The Heading property was changed from int to Double
<span class="nc" id="L1288">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L1290" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // The Z property was added
<span class="nc" id="L1292">      srcCompVersion = 4;</span>
    }
<span class="nc bnc" id="L1294" title="All 2 branches missed.">    if (srcCompVersion &lt; 5) {</span>
      // The TouchUp, TouchDown, and Flung events were added. (for all sprites)
      // No properties need to be modified to upgrade to version 5.
<span class="nc" id="L1297">      srcCompVersion = 5;</span>
    }
<span class="nc bnc" id="L1299" title="All 2 branches missed.">    if (srcCompVersion &lt; 6) {</span>
      // The callback parameters speed and heading were added to Flung.
<span class="nc" id="L1301">      srcCompVersion = 6;</span>
    }
<span class="nc bnc" id="L1303" title="All 2 branches missed.">    if (srcCompVersion &lt; 7) {</span>
      // The MoveToPoint method was added.
<span class="nc" id="L1305">      srcCompVersion = 7;</span>
    }
<span class="nc bnc" id="L1307" title="All 2 branches missed.">    if (srcCompVersion &lt; 8) {</span>
      // Direction dropdown blocks were added.
      // Assets helper block was added.
<span class="nc" id="L1310">      srcCompVersion = 8;</span>
    }
<span class="nc" id="L1312">    return srcCompVersion;</span>
  }

  private static int upgradeLabelProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1317" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The Alignment property was renamed to TextAlignment.
<span class="nc" id="L1319">      handlePropertyRename(componentProperties, &quot;Alignment&quot;, &quot;TextAlignment&quot;);</span>
      // Properties related to this component have now been upgraded to version 2.
<span class="nc" id="L1321">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L1323" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // The LabelFormat method was added.  No changes are needed. (3)
      // The HasMargins property was added. (4)
<span class="nc" id="L1326">      componentProperties.put(&quot;HasMargins&quot;, new ClientJsonString(&quot;False&quot;));</span>
<span class="nc" id="L1327">      srcCompVersion = 4;</span>
    }
<span class="nc bnc" id="L1329" title="All 2 branches missed.">    if (srcCompVersion &lt; 5) {</span>
<span class="nc" id="L1330">      srcCompVersion = 5;</span>
    }
<span class="nc" id="L1332">    return srcCompVersion;</span>
  }

  private static int upgradeListPickerProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1337" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The Alignment property was renamed to TextAlignment.
<span class="nc" id="L1339">      handlePropertyRename(componentProperties, &quot;Alignment&quot;, &quot;TextAlignment&quot;);</span>
      // Properties related to this component have now been upgraded to version 2.
<span class="nc" id="L1341">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L1343" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // The SelectionIndex property was added.  No changes are needed.
<span class="nc" id="L1345">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L1347" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // The Open method was added.  No changes are needed.
<span class="nc" id="L1349">      srcCompVersion = 4;</span>
    }
<span class="nc bnc" id="L1351" title="All 2 branches missed.">    if (srcCompVersion &lt; 5) {</span>
      // The Shape property was added.
      // No properties need to be modified to upgrade to version 5.
<span class="nc" id="L1354">      srcCompVersion = 5;</span>
    }
<span class="nc bnc" id="L1356" title="All 2 branches missed.">    if (srcCompVersion &lt; 6) {</span>
      // The getIntent method was modified to add the parent Form's screen
      // animation type. No properties need to be modified to upgrade to
      // version 6.
<span class="nc" id="L1360">      srcCompVersion = 6;</span>
    }
<span class="nc bnc" id="L1362" title="All 2 branches missed.">    if (srcCompVersion &lt; 7) {</span>
      //  Added ShowFilterBar property
<span class="nc" id="L1364">      srcCompVersion = 7;</span>
    }
<span class="nc bnc" id="L1366" title="All 2 branches missed.">    if (srcCompVersion &lt; 8) {</span>
      //  Added title property
<span class="nc" id="L1368">      srcCompVersion = 8;</span>
    }
<span class="nc bnc" id="L1370" title="All 2 branches missed.">    if (srcCompVersion &lt; 9) {</span>
      // Added ItemTextColor, ItemBackgroundColor
<span class="nc" id="L1372">      srcCompVersion = 9;</span>
    }
<span class="nc" id="L1374">    return srcCompVersion;</span>
  }

  private static int upgradeListViewProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1379" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // Added the Elements property
<span class="nc" id="L1381">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L1383" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // Added the BackgroundColor property
      // Added the TextColor property
<span class="nc" id="L1386">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L1388" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // Added the TextSize property
<span class="nc" id="L1390">      srcCompVersion = 4;</span>
    }
<span class="nc bnc" id="L1392" title="All 2 branches missed.">    if (srcCompVersion &lt; 5) {</span>
      // Added the SelectionColor property
<span class="nc" id="L1394">      srcCompVersion = 5;</span>
    }
<span class="nc bnc" id="L1396" title="All 2 branches missed.">    if (srcCompVersion &lt; 6) {</span>
      // Added ...
<span class="nc" id="L1398">      srcCompVersion = 6;</span>
    }
<span class="nc" id="L1400">    return srcCompVersion;</span>
  }

  private static int upgradeLocationSensorProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1405" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // Version 2:
      // The TimeInterval and DistanceInterval properties were added.
      // No properties need to be modified to upgrade to Version 2.
      // Version 3:
      // The speed parameter was added to the LocationChanged event
<span class="nc" id="L1411">      srcCompVersion = 3;</span>
    }
<span class="nc" id="L1413">    return srcCompVersion;</span>
  }

  private static int upgradeOrientationSensorProperties(
      Map&lt;String, JSONValue&gt; componentProperties, int srcCompVersion) {
<span class="nc bnc" id="L1418" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The Yaw property was renamed to Azimuth.
<span class="nc" id="L1420">      handlePropertyRename(componentProperties, &quot;Yaw&quot;, &quot;Azimuth&quot;);</span>
      // Properties related to this component have now been upgraded to version 2.
<span class="nc" id="L1422">      srcCompVersion = 2;</span>
    }
<span class="nc" id="L1424">    return srcCompVersion;</span>
  }

  private static int upgradePasswordTextBoxProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1429" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The Alignment property was renamed to TextAlignment.
<span class="nc" id="L1431">      handlePropertyRename(componentProperties, &quot;Alignment&quot;, &quot;TextAlignment&quot;);</span>
      // Properties related to this component have now been upgraded to version 2.
<span class="nc" id="L1433">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L1435" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // Added RequestFocus Function (via TextBoxBase)
<span class="nc" id="L1437">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L1439" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // Added PasswordVisible Property
<span class="nc" id="L1441">      srcCompVersion = 4;</span>
    }
<span class="nc bnc" id="L1443" title="All 2 branches missed.">    if (srcCompVersion &lt; 5) {</span>
      // Added NumbersOnly property
<span class="nc" id="L1445">      srcCompVersion = 5;</span>
    }
<span class="nc" id="L1447">    return srcCompVersion;</span>
  }

  private static int upgradePhoneCallProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1452" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The PhoneCallStarted event was added.
      // The PhoneCallEnded event was added.
      // The IncomingCallAnswered event was added.
      // No properties need to be modified to upgrade to version 2.
<span class="nc" id="L1457">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L1459" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
<span class="nc" id="L1460">      srcCompVersion = 3;</span>
    }
<span class="nc" id="L1462">    return srcCompVersion;</span>
  }

  private static int upgradePhoneNumberPickerProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1467" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The Alignment property was renamed to TextAlignment.
<span class="nc" id="L1469">      handlePropertyRename(componentProperties, &quot;Alignment&quot;, &quot;TextAlignment&quot;);</span>
      // Properties related to this component have now been upgraded to version 2.
<span class="nc" id="L1471">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L1473" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // The Open method was added.  No changes are needed.
<span class="nc" id="L1475">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L1477" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // The Shape property was added.
      // No properties need to be modified to upgrade to version 4.
<span class="nc" id="L1480">      srcCompVersion = 4;</span>
    }
<span class="nc" id="L1482">    return srcCompVersion;</span>
  }

  private static int upgradePlayerProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1487" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The Player.PlayerError event was added.
      // No properties need to be modified to upgrade to version 2.
<span class="nc" id="L1490">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L1492" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // The Player.PlayerError event was marked userVisible false and is no longer used.
      // No properties need to be modified to upgrade to version 3.
<span class="nc" id="L1495">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L1497" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // The Looping and Volume properties were added.
      // The Completed Event was added.
      // The IsPlaying method was added.
      // No properties need to be modified to upgrade to version 4.
<span class="nc" id="L1502">      srcCompVersion = 4;</span>
    }
<span class="nc bnc" id="L1504" title="All 2 branches missed.">    if (srcCompVersion &lt; 5) {</span>
      // The IsPlaying method was renamed to Loop.
<span class="nc" id="L1506">      handlePropertyRename(componentProperties, &quot;IsLooping&quot;, &quot;Loop&quot;);</span>
      // Properties related to this component have now been upgraded to version  5.
<span class="nc" id="L1508">      srcCompVersion = 5;</span>
    }
<span class="nc bnc" id="L1510" title="All 2 branches missed.">    if (srcCompVersion &lt; 6) {</span>
        // The PlayInForeground method was added.
        // The OtherPlayerStarted event was added.
        // Properties related to this component have now been upgraded to version  6.
<span class="nc" id="L1514">        srcCompVersion = 6;</span>
      }
<span class="nc" id="L1516">    return srcCompVersion;</span>
  }

  private static int upgradeSoundProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1521" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The Sound.SoundError event was added.
      // No properties need to be modified to upgrade to version 2.
<span class="nc" id="L1524">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L1526" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // The Sound.SoundError event was marked userVisible false and is no longer used.
      // No properties need to be modified to upgrade to version 3.
<span class="nc" id="L1529">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L1531" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // Assets helper block was added.
<span class="nc" id="L1533">      srcCompVersion = 4;</span>
    }
<span class="nc" id="L1535">    return srcCompVersion;</span>
  }

  private static int upgradeSoundRecorderProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1540" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The SoundRecorder.RecordFile property was added.
      // No properties need to be modified to upgrade to version 2.
<span class="nc" id="L1543">      srcCompVersion = 2;</span>
    }
<span class="nc" id="L1545">    return srcCompVersion;</span>
  }

  private static int upgradeSpeechRecognizerProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1550" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The SpeechRecognizer.UseLegacy property was added.
      // The Stop method was added.
      // No properties need to be modified to upgrade to version 2.
<span class="nc" id="L1554">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L1556" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // The Language property was added.
      // No properties need to be modified to upgrade to version 3.
<span class="nc" id="L1559">      srcCompVersion = 3;</span>
    }
<span class="nc" id="L1561">    return srcCompVersion;</span>
  }

  private static int upgradeSpreadsheetProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1566" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // Various methods were renamed in the blocks editor.
<span class="nc" id="L1568">      srcCompVersion = 2;</span>
    }
<span class="nc" id="L1570">    return srcCompVersion;</span>
  }

  private static int upgradeTimePickerProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1575" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The SetTimeToDisplay and LaunchPicker methods were added.
      // No properties need to be modified to upgrade to version 2.
<span class="nc" id="L1578">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L1580" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // SetTimeToDisplayFromInstant, and Instant property are added.
      // No properties need to be modified to upgrade to version 3.
<span class="nc" id="L1583">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L1585" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // Assets helper block was added.
<span class="nc" id="L1587">      srcCompVersion = 4;</span>
    }
<span class="nc" id="L1589">    return srcCompVersion;</span>
  }

  private static int upgradeTinyDBProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1594" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // Added Property: Namespace
<span class="nc" id="L1596">      srcCompVersion = 2;</span>
    }
<span class="nc" id="L1598">    return srcCompVersion;</span>
  }

  private static int upgradeTinyWebDBProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1603" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The TinyWebDB.ShowAlert method was removed. Notifier.ShowAlert should be used instead.
      // No properties need to be modified to upgrade to version 2.
<span class="nc" id="L1606">      srcCompVersion = 2;</span>
    }
<span class="nc" id="L1608">    return srcCompVersion;</span>
  }

  private static int upgradeVerticalArrangementProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1613" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The AlignHorizontal and AlignVertical properties were added. No blocks need to be modified
      // to upgrqde to version 2.
<span class="nc" id="L1616">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L1618" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // - Added background color &amp; image
<span class="nc" id="L1620">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L1622" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // Add HorizontalAlignment and VerticalAlignment dropdown blocks.
      // Assets helper block was added.
<span class="nc" id="L1625">      srcCompVersion = 4;</span>
    }
<span class="nc" id="L1627">    return srcCompVersion;</span>
  }

  private static int upgradeVerticalScrollArrangementProperties(
      Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1633" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // Add HorizontalAlignment and VerticalAlignment dropdown blocks.
      // Assets helper block was added.
<span class="nc" id="L1636">      srcCompVersion = 2;</span>
    }
<span class="nc" id="L1638">    return srcCompVersion;</span>
  }

  private static int upgradeNotifierProperties(Map&lt;String, JSONValue&gt; componentProperties,
                                                  int srcCompVersion) {
<span class="nc bnc" id="L1643" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // A new boolean socket was added to allow canceling out of ShowChooseDialog
      // and ShowTextDialog
<span class="nc" id="L1646">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L1648" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // The BackgroundColor, NotifierLength, and TextColor options were added.
      // No properties need to be modified to upgrade to version 3.
<span class="nc" id="L1651">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L1653" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // A new type of dialog was created, a ProgressDialog, and a method to
      // dismiss the dialog was also added.
<span class="nc" id="L1656">      srcCompVersion = 4;</span>
    }
<span class="nc bnc" id="L1658" title="All 2 branches missed.">    if (srcCompVersion &lt; 5) {</span>
      // Added TextInputCanceled &amp; ChoosingCanceled event
<span class="nc" id="L1660">      srcCompVersion = 5;</span>
    }
<span class="nc bnc" id="L1662" title="All 2 branches missed.">    if (srcCompVersion &lt; 6) {</span>
      // Added PasswordDialog
<span class="nc" id="L1664">      srcCompVersion = 6;</span>
    }
<span class="nc" id="L1666">    return srcCompVersion;</span>
  }

  private static int upgradeVideoPlayerProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1671" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The VideoPlayer.VideoPlayerError event was added.
      // No properties need to be modified to upgrade to version 2.
<span class="nc" id="L1674">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L1676" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // The VideoPlayer.VideoPlayerError event was marked userVisible false and is no longer used.
      // No properties need to be modified to upgrade to version 3.
<span class="nc" id="L1679">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L1681" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // The VideoPlayer.height and VideoPlayer.width getter and setters were marked as
      // visible to the user.
      // The FullScreen property was created.
      // No properties need to be modified to upgrade to version 4.
<span class="nc" id="L1686">      srcCompVersion = 4;</span>
    }
<span class="nc bnc" id="L1688" title="All 2 branches missed.">    if (srcCompVersion &lt; 5) {</span>
      // The Volume property (setter only) was created.
      // No properties need to be modified to upgrade to version 5.
<span class="nc" id="L1691">      srcCompVersion = 5;</span>
    }
<span class="nc bnc" id="L1693" title="All 2 branches missed.">    if (srcCompVersion &lt; 6) {</span>
      // The Stop method was created.
      // No properties need to be modified to upgrade to version 6.
<span class="nc" id="L1696">      srcCompVersion = 6;</span>
    }
<span class="nc bnc" id="L1698" title="All 2 branches missed.">    if (srcCompVersion &lt; 7) {</span>
      // Assets helper block was added.
<span class="nc" id="L1700">      srcCompVersion = 7;</span>
    }
<span class="nc" id="L1702">    return srcCompVersion;</span>
  }

  private static int upgradeTwitterProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1707" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The designer properties ConsumerKey and ConsumerSecret were added
      // No properties need to be modified to upgrade to version 2.
<span class="nc" id="L1710">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L1712" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // The designer property TwitPic_API_Key was added
      // No properties need to be modified to upgrade to version 3.
<span class="nc" id="L1715">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L1717" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // The designer property TwitPic_API_Key and functions are hidden and deprecated.
      // No properties need to be modified to upgrade to version 4.
<span class="nc" id="L1720">      srcCompVersion = 4;</span>
    }
<span class="nc" id="L1722">    return srcCompVersion;</span>
  }

  private static int upgradeTextingProperties(Map&lt;String, JSONValue&gt; componentProperties,
                                              int srcCompVersion) {
<span class="nc bnc" id="L1727" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The designer property GoogleVoiceEnabled was added
      // No properties need to be modified to upgrade to version 2.
<span class="nc" id="L1730">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L1732" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
<span class="nc bnc" id="L1733" title="All 2 branches missed.">      if (componentProperties.containsKey(&quot;ReceivingEnabled&quot;)) {</span>
<span class="nc" id="L1734">        JSONValue receivingEnabled = componentProperties.get(&quot;ReceivingEnabled&quot;);</span>
<span class="nc" id="L1735">        String receivingString = receivingEnabled.asString().getString();</span>
<span class="nc bnc" id="L1736" title="All 2 branches missed.">        if (receivingString.equals(&quot;true&quot;)) {</span>
<span class="nc" id="L1737">          componentProperties.put(&quot;ReceivingEnabled&quot;, new ClientJsonString(&quot;2&quot;));</span>
        } else {
<span class="nc" id="L1739">          componentProperties.put(&quot;ReceivingEnabled&quot;, new ClientJsonString(&quot;1&quot;));</span>
        }
      }
<span class="nc" id="L1742">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L1744" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
<span class="nc" id="L1745">      srcCompVersion = 4;</span>
    }
<span class="nc bnc" id="L1747" title="All 2 branches missed.">    if (srcCompVersion &lt; 5) {</span>
      // Adds ReceivingState dropdown block.
<span class="nc" id="L1749">      srcCompVersion = 5;</span>
    }

<span class="nc" id="L1752">    return srcCompVersion;</span>
  }

  private static int upgradeTextBoxProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1757" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The property (and designer property) TextBox.NumbersOnly was added
      // No properties need to be modified to upgrade to version 2.
<span class="nc" id="L1760">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L1762" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // The Alignment property was renamed to TextAlignment.
<span class="nc" id="L1764">      handlePropertyRename(componentProperties, &quot;Alignment&quot;, &quot;TextAlignment&quot;);</span>
      // Properties related to this component have now been upgraded to version 3.
<span class="nc" id="L1766">      srcCompVersion = 3;</span>
    }

<span class="nc bnc" id="L1769" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // The MultiLine property was added.
      // The default for Multiline from now on is false, but up until now,
      // all text boxes have been multiline.
      // We need to set the MultiLine to true when we upgrade old projects.
<span class="nc" id="L1774">      componentProperties.put(&quot;MultiLine&quot;, new ClientJsonString(&quot;True&quot;));</span>
      // Properties related to this component have now been upgraded to version 4.
<span class="nc" id="L1776">      srcCompVersion = 4;</span>
    }
<span class="nc bnc" id="L1778" title="All 2 branches missed.">    if (srcCompVersion &lt; 5) {</span>
      // RequestFocus method was added
<span class="nc" id="L1780">      srcCompVersion = 5;</span>
    }
<span class="nc bnc" id="L1782" title="All 2 branches missed.">    if (srcCompVersion &lt; 6) {</span>
      // ReadOnly property was added
<span class="nc" id="L1784">      srcCompVersion = 6;</span>
    }
<span class="nc" id="L1786">    return srcCompVersion;</span>
  }

  private static int upgradeWebProperties(Map&lt;String, JSONValue&gt; componentProperties,
                                          int srcCompVersion) {
<span class="nc bnc" id="L1791" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The RequestHeaders and AllowCookies properties were added.
      // The BuildPostData and ClearCookies methods were added.
      // The existing PostText method was renamed to PostTextWithEncoding, and a new PostText
      // method was added.
      // No properties need to be modified to upgrade to version 2.
<span class="nc" id="L1797">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L1799" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // The methods PutText, PutTextWithEncoding, PutFile and Delete were added.
      // The method BuildPostData was renamed to BuildRequestData.
      // No properties need to be modified to upgrade to version 3.
<span class="nc" id="L1803">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L1805" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // The XMLTextDecode method was added.
      // No properties need to be modified to upgrade to version 4.
<span class="nc" id="L1808">      srcCompVersion = 4;</span>
    }
<span class="nc bnc" id="L1810" title="All 2 branches missed.">    if (srcCompVersion &lt; 5) {</span>
      // The UriDecode method was added.
      // No properties need to be modified to upgrade to version 5.
<span class="nc" id="L1813">      srcCompVersion = 5;</span>
    }
<span class="nc bnc" id="L1815" title="All 2 branches missed.">    if (srcCompVersion &lt; 6) {</span>
      // The Timeout property and TimedOut event were added.
      // No properties need to be modified to upgrade to version 6.
      // Timeout defaults to 0, so prior components will maintain the same web request
      // timeout behavior.
<span class="nc" id="L1820">      srcCompVersion = 6;</span>
    }
<span class="nc bnc" id="L1822" title="All 2 branches missed.">    if (srcCompVersion &lt; 7)  {</span>
      // The JsonTextDecodeWithDictionaries was added to parse JSON using dictionaries.
      // The XMLTextDecodeAsDictionary was added to provide a more robust representation
      // of XML using dictionaries.
<span class="nc" id="L1826">      srcCompVersion = 7;</span>
    }
<span class="nc bnc" id="L1828" title="All 2 branches missed.">    if (srcCompVersion &lt; 8) {</span>
      // The methods PatchText, PatchTextWithEncoding, and PatchFile were added.
      // No properties need to be modified to upgrade to version 8.
<span class="nc" id="L1831">      srcCompVersion = 8;</span>
    }
<span class="nc" id="L1833">    return srcCompVersion;</span>
  }

  private static int upgradeWebViewerProperties(Map&lt;String, JSONValue&gt; componentProperties,
                                                int srcCompVersion) {
<span class="nc bnc" id="L1838" title="All 2 branches missed.">    if (srcCompVersion &lt; 10) {</span>
      // The CanGoForward and CanGoBack methods were added.
      // No properties need to be modified to upgrade to version 2.
      // UsesLocation property added.
      // No properties need to be modified to upgrade to version 3.
      // WebViewString added
      // No properties need to be modified to upgrade to version 4.
      // IgnoreSslError property added (version 5)
      // ClearCaches method was added (version 6)
      // WebViewStringChange event was added (version 7)
      // PageLoaded event was added (version 8)
      // BeforePageLoad event and Stop, Reload, and ClearCookies methods added (version 9)
      // ErrorOccurred event and RunJavaScript method added (version 10)
<span class="nc" id="L1851">      srcCompVersion = 10;</span>
    }
<span class="nc" id="L1853">    return srcCompVersion;</span>
  }

  private static int upgradeFirebaseDBProperties(Map&lt;String, JSONValue&gt; componentProperties,
    int srcCompVersion) {
<span class="nc bnc" id="L1858" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // Version 2
      // Added AppendValue, RemoveFirst and FirstRemoved
      // Version 3
      // Added RemoveValue, GetTagList and Persist
<span class="nc" id="L1863">      srcCompVersion = 3;</span>
    }
<span class="nc" id="L1865">    return srcCompVersion;</span>
  }

  private static int upgradePedometerProperties(Map&lt;String, JSONValue&gt; componentProperties,
    int srcCompVersion) {
<span class="nc bnc" id="L1870" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // The step sensing algorithm was updated to be more accurate.
      // The GPS related functionality was removed.
<span class="nc" id="L1873">      srcCompVersion = 2;</span>
    }
<span class="nc bnc" id="L1875" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // The Resume and Pause methods were removed.
<span class="nc" id="L1877">      srcCompVersion = 3;</span>
    }
<span class="nc" id="L1879">    return srcCompVersion;</span>
  }

  private static int upgradeMapProperties(Map&lt;String, JSONValue&gt; componentProperties,
    int srcCompVersion) {
<span class="nc bnc" id="L1884" title="All 2 branches missed.">    if (srcCompVersion &lt; 5) {</span>
      // Version 2
      // The Markers property (blocks-only) was renamed to Features
      // Version 3
      // Block event handlers were renamed
      // Version 4
      // The Rotation property was added with default 0.0 (due north)
      // Verison 5
      // The ScaleUnits and ShowScale properties were added
<span class="nc" id="L1893">      srcCompVersion = 5;</span>
    }
<span class="nc bnc" id="L1895" title="All 2 branches missed.">    if (srcCompVersion &lt; 6) {</span>
      // Adds ScaleUnits and MapType dropdowns.
<span class="nc" id="L1897">      srcCompVersion = 6;</span>
    }
<span class="nc" id="L1899">    return srcCompVersion;</span>
  }

  private static int upgradeNavigationProperties(
      Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1905" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // - Adds TransportMethod dropdown.
<span class="nc" id="L1907">      srcCompVersion = 2;</span>
    }
<span class="nc" id="L1909">    return srcCompVersion;</span>
  }
  
  private static int upgradeCircleProperties(Map&lt;String, JSONValue&gt; componentProperties,
    int srcCompVersion) {
<span class="nc bnc" id="L1914" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // Verison 2
      // The FillOpacity and StrokeOpacity properties were added
<span class="nc" id="L1917">      srcCompVersion = 2;</span>
    }
<span class="nc" id="L1919">    return srcCompVersion;</span>
  }

  private static int upgradeLineStringProperties(Map&lt;String, JSONValue&gt; componentProperties,
    int srcCompVersion) {
<span class="nc bnc" id="L1924" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // Verison 2
      // The StrokeOpacity property was added
<span class="nc" id="L1927">      srcCompVersion = 2;</span>
    }
<span class="nc" id="L1929">    return srcCompVersion;</span>
  }

  private static int upgradeMarkerProperties(Map&lt;String, JSONValue&gt; componentProperties,
    int srcCompVersion) {
<span class="nc bnc" id="L1934" title="All 2 branches missed.">    if (srcCompVersion &lt; 3) {</span>
      // The ShowShadow property was removed.
<span class="nc bnc" id="L1936" title="All 2 branches missed.">      if (componentProperties.containsKey(&quot;ShowShadow&quot;)) {</span>
<span class="nc" id="L1937">        componentProperties.remove(&quot;ShowShadow&quot;);</span>
      }
      // Verison 3
      // The FillOpacity and StrokeOpacity properties were added
<span class="nc" id="L1941">      srcCompVersion = 3;</span>
    }
<span class="nc bnc" id="L1943" title="All 2 branches missed.">    if (srcCompVersion &lt; 4) {</span>
      // Add AlignHorizontal and AlignVertical dropdown blocks.
      // Assets helper block was added.
<span class="nc" id="L1946">      srcCompVersion = 4;</span>
    }
<span class="nc" id="L1948">    return srcCompVersion;</span>
  }

  private static int upgradePolygonProperties(Map&lt;String, JSONValue&gt; componentProperties,
    int srcCompVersion) {
<span class="nc bnc" id="L1953" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // Verison 2
      // The FillOpacity and StrokeOpacity properties were added
<span class="nc" id="L1956">      srcCompVersion = 2;</span>
    }
<span class="nc" id="L1958">    return srcCompVersion;</span>
  }

  private static int upgradeRectangleProperties(Map&lt;String, JSONValue&gt; componentProperties,
    int srcCompVersion) {
<span class="nc bnc" id="L1963" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // Verison 2
      // The FillOpacity and StrokeOpacity properties were added
<span class="nc" id="L1966">      srcCompVersion = 2;</span>
    }
<span class="nc" id="L1968">    return srcCompVersion;</span>
  }

  private static int upgradeFeatureCollection(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1973" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // Version 2
      // The GotGeoJSON and GeoJSONError events were renamed in the blocks editor.
<span class="nc" id="L1976">      srcCompVersion = 2;</span>
    }
<span class="nc" id="L1978">    return srcCompVersion;</span>
  }

  private static int upgradeYandexTranslateProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1983" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // Version 2
      // The ApiKey property was added
<span class="nc" id="L1986">      srcCompVersion = 2;</span>
    }
<span class="nc" id="L1988">    return srcCompVersion;</span>
  }

  private static int upgradeCloudDBProperties(Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L1993" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // Version 2
      // UpdateDone event and ProvideUpdateDone property were added
<span class="nc" id="L1996">      srcCompVersion = 2;</span>
    }
<span class="nc" id="L1998">    return srcCompVersion;</span>
  }

  private static int upgradeEv3ColorSensorProperties(
      Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L2004" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // Remove SetAmbientMode, SetColorMode, and SetReflectedMode. Use Mode setter instead.
      // Add ColorSensorMode dropdown.
<span class="nc" id="L2007">      srcCompVersion = 2;</span>
    }
<span class="nc" id="L2009">    return srcCompVersion;</span>
  }

  private static int upgradeEv3GyroSensorProperties(
      Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L2015" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // Remove SetAngleMode and SetRateMode. Use Mode setter instead.
      // Add GyroSensorMode dropdown block.
<span class="nc" id="L2018">      srcCompVersion = 2;</span>
    }
<span class="nc" id="L2020">    return srcCompVersion;</span>
  }

  private static int upgradeEv3UltrasonicSensorProperties(
      Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L2026" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // Remove SetCmUnit and SetInchUnit. Use Unit setter instead.
      // Add UnltrasonicSensorMode dropdown block.
<span class="nc" id="L2029">      srcCompVersion = 2;</span>
    }
<span class="nc" id="L2031">    return srcCompVersion;</span>
  }

  private static int upgradeNxtDirectCommandsProperties(
      Map&lt;String, JSONValue&gt; componentProperties,
      int srcCompVersion) {
<span class="nc bnc" id="L2037" title="All 2 branches missed.">    if (srcCompVersion &lt; 2) {</span>
      // Adds dropdown blocks.
<span class="nc" id="L2039">      srcCompVersion = 2;</span>
    }
<span class="nc" id="L2041">    return srcCompVersion;</span>
  }

  private static void handlePropertyRename(Map&lt;String, JSONValue&gt; componentProperties,
      String oldPropName, String newPropName) {
<span class="nc bnc" id="L2046" title="All 2 branches missed.">    if (componentProperties.containsKey(oldPropName)) {</span>
<span class="nc" id="L2047">      componentProperties.put(newPropName, componentProperties.remove(oldPropName));</span>
    }
<span class="nc" id="L2049">  }</span>

  private static void handleSupplyValueForPreviouslyDefaultedProperty(
      Map&lt;String, JSONValue&gt; componentProperties,
      String PropName, JSONValue valueToSupply) {
    // if the property wasn't previously there as a key, the previous value was
    // the default value
<span class="nc bnc" id="L2056" title="All 2 branches missed.">    if (!(componentProperties.containsKey(PropName))) {</span>
<span class="nc" id="L2057">      componentProperties.put(PropName, valueToSupply);</span>
    }
<span class="nc" id="L2059">  }</span>

  private static void upgradeWarnDialog(String aMessage) {
<span class="nc" id="L2062">    final DialogBox dialogBox = new DialogBox(false, true);</span>
<span class="nc" id="L2063">    dialogBox.setStylePrimaryName(&quot;ode-DialogBox&quot;);</span>
<span class="nc" id="L2064">    dialogBox.setText(MESSAGES.warningDialogTitle());</span>
<span class="nc" id="L2065">    dialogBox.setGlassEnabled(true);</span>
<span class="nc" id="L2066">    dialogBox.setAnimationEnabled(true);</span>
<span class="nc" id="L2067">    final HTML message = new HTML(aMessage);</span>
<span class="nc" id="L2068">    message.setStyleName(&quot;DialogBox-message&quot;);</span>
<span class="nc" id="L2069">    VerticalPanel vPanel = new VerticalPanel();</span>
<span class="nc" id="L2070">    Button okButton = new Button(&quot;OK&quot;);</span>
<span class="nc" id="L2071">    okButton.addClickListener(new ClickListener() {</span>
        @Override
        public void onClick(Widget sender) {
<span class="nc" id="L2074">          dialogBox.hide();</span>
<span class="nc" id="L2075">        }</span>
      });
<span class="nc" id="L2077">    vPanel.add(message);</span>
<span class="nc" id="L2078">    vPanel.add(okButton);</span>
<span class="nc" id="L2079">    dialogBox.setWidget(vPanel);</span>
<span class="nc" id="L2080">    dialogBox.center();</span>
<span class="nc" id="L2081">    dialogBox.show();</span>
<span class="nc" id="L2082">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>