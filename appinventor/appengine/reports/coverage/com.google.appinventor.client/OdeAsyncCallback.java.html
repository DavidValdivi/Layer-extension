<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>OdeAsyncCallback.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.google.appinventor.client</a> &gt; <span class="el_source">OdeAsyncCallback.java</span></div><h1>OdeAsyncCallback.java</h1><pre class="source lang-java linenums">// -*- mode: java; c-basic-offset: 2; -*-
// Copyright 2009-2011 Google, All Rights reserved
// Copyright 2011-2012 MIT, All rights reserved
// Released under the Apache License, Version 2.0
// http://www.apache.org/licenses/LICENSE-2.0

package com.google.appinventor.client;

import com.google.appinventor.client.output.OdeLog;

import com.google.appinventor.shared.rpc.BlocksTruncatedException;
import com.google.appinventor.shared.rpc.InvalidSessionException;
import com.google.appinventor.shared.rpc.project.ChecksumedFileException;

import com.google.gwt.http.client.Response;

import com.google.gwt.user.client.rpc.AsyncCallback;
import com.google.gwt.user.client.rpc.IncompatibleRemoteServiceException;
import com.google.gwt.user.client.rpc.StatusCodeException;

/**
 * Provides common functionality for asynchronous callbacks from the ODE
 * client.  Specifically, on failure, this does one of two things:
 * &lt;ol&gt;
 * &lt;li&gt; If a failure message was provided during construction,
 *      it is displayed using {@link ErrorReporter#reportError(String)}.
 * &lt;li&gt; Otherwise, if the no-args constructor was used, the message in
 *      the exception passed to {@link #onFailure(Throwable)} is
 *      displayed using {@link ErrorReporter#reportError(String)}.
 * &lt;/ol&gt;
 *
 * @param &lt;T&gt; type of object returned by successful RPC call
 */
public abstract class OdeAsyncCallback&lt;T&gt; implements AsyncCallback&lt;T&gt; {

  private String failureMessage;

  /**
   * Constructor for when caller wants subclass to display the message in
   * the {@link Throwable} passed to {@link #onFailure(Throwable)}, rather
   * than a static message provided at construction time
   */
<span class="nc" id="L43">  public OdeAsyncCallback() {</span>
<span class="nc" id="L44">  }</span>

  /**
   * Constructor allowing subclass to specify a message that should be
   * displayed by {@link #onFailure(Throwable)}
   *
   * @param defaultFailureMessage message to display on failure
   */
<span class="nc" id="L52">  public OdeAsyncCallback(String defaultFailureMessage) {</span>
<span class="nc" id="L53">    failureMessage = defaultFailureMessage;</span>
<span class="nc" id="L54">  }</span>

  @Override
  public void onFailure(Throwable caught) {
<span class="nc bnc" id="L58" title="All 2 branches missed.">    if (caught instanceof IncompatibleRemoteServiceException) {</span>
<span class="nc" id="L59">      ErrorReporter.reportError(&quot;App Inventor has just been upgraded, you will need to press the reload button in your browser window&quot;);</span>
<span class="nc" id="L60">      return;</span>
    }
<span class="nc bnc" id="L62" title="All 2 branches missed.">    if (caught instanceof InvalidSessionException) {</span>
<span class="nc" id="L63">      Ode.getInstance().invalidSessionDialog();</span>
<span class="nc" id="L64">      return;</span>
    }
<span class="nc bnc" id="L66" title="All 2 branches missed.">    if (caught instanceof ChecksumedFileException) {</span>
<span class="nc" id="L67">      Ode.getInstance().corruptionDialog();</span>
<span class="nc" id="L68">      return;</span>
    }
<span class="nc bnc" id="L70" title="All 2 branches missed.">    if (caught instanceof BlocksTruncatedException) {</span>
<span class="nc" id="L71">      OdeLog.log(&quot;Caught BlocksTruncatedException&quot;);</span>
<span class="nc" id="L72">      ErrorReporter.reportError(&quot;Caught BlocksTruncatedException&quot;);</span>
<span class="nc" id="L73">      return;</span>
    }
    // SC_PRECONDITION_FAILED if our session has expired or login cookie
    // has become invalid
<span class="nc bnc" id="L77" title="All 2 branches missed.">    if ((caught instanceof StatusCodeException) &amp;&amp;</span>
<span class="nc bnc" id="L78" title="All 2 branches missed.">      ((StatusCodeException)caught).getStatusCode() == Response.SC_PRECONDITION_FAILED) {</span>
<span class="nc" id="L79">      Ode.getInstance().sessionDead();</span>
<span class="nc" id="L80">      return;</span>
    }
<span class="nc bnc" id="L82" title="All 2 branches missed.">    String errorMessage =</span>
<span class="nc" id="L83">        (failureMessage == null) ? caught.getMessage() : failureMessage;</span>
<span class="nc" id="L84">    ErrorReporter.reportError(errorMessage);</span>
<span class="nc" id="L85">    OdeLog.elog(&quot;Got exception: &quot; + caught.getMessage());</span>
<span class="nc" id="L86">    Throwable cause = caught.getCause();</span>
<span class="nc bnc" id="L87" title="All 2 branches missed.">    if (cause != null) {</span>
<span class="nc" id="L88">      OdeLog.elog(&quot;Caused by: &quot; + cause.getMessage());</span>
    }
<span class="nc" id="L90">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>