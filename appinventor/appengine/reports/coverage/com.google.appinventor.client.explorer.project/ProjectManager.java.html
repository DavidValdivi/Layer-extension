<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ProjectManager.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.google.appinventor.client.explorer.project</a> &gt; <span class="el_source">ProjectManager.java</span></div><h1>ProjectManager.java</h1><pre class="source lang-java linenums">// -*- mode: java; c-basic-offset: 2; -*-
// Copyright 2009-2011 Google, All Rights reserved
// Copyright 2011-2012 MIT, All rights reserved
// Released under the Apache License, Version 2.0
// http://www.apache.org/licenses/LICENSE-2.0

package com.google.appinventor.client.explorer.project;

import com.google.appinventor.client.Ode;
import static com.google.appinventor.client.Ode.MESSAGES;
import com.google.appinventor.client.OdeAsyncCallback;
import com.google.appinventor.shared.rpc.project.ProjectNode;
import com.google.appinventor.shared.rpc.project.UserProject;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

/**
 * This class manages projects.
 *
 * @author lizlooney@google.com (Liz Looney)
 */
public final class ProjectManager {
  // Map to find the project from a project ID.
  private final Map&lt;Long, Project&gt; projectsMap;

  // List of listeners for any project manager events.
  private final List&lt;ProjectManagerEventListener&gt; projectManagerEventListeners;

  /**
   * Flag indicating whether the project infos have all loaded.
   */
<span class="nc" id="L35">  private volatile boolean projectsLoaded = false;</span>

  /**
   * Creates a new projects manager.
   */
<span class="nc" id="L40">  public ProjectManager() {</span>
<span class="nc" id="L41">    projectsMap = new HashMap&lt;Long, Project&gt;();</span>
<span class="nc" id="L42">    projectManagerEventListeners = new ArrayList&lt;ProjectManagerEventListener&gt;();</span>
<span class="nc" id="L43">    Ode.getInstance().getProjectService().getProjectInfos(</span>
      new OdeAsyncCallback&lt;List&lt;UserProject&gt;&gt;(
<span class="nc" id="L45">        MESSAGES.projectInformationRetrievalError()) {</span>
        @Override
        public void onSuccess(List&lt;UserProject&gt; projectInfos) {
<span class="nc bnc" id="L48" title="All 2 branches missed.">          for (UserProject projectInfo : projectInfos) {</span>
<span class="nc" id="L49">            addProject(projectInfo);</span>
<span class="nc" id="L50">          }</span>
<span class="nc" id="L51">          fireProjectsLoaded();</span>
<span class="nc" id="L52">        }</span>
      });
<span class="nc" id="L54">  }</span>

  /**
   * Returns a list of the projects with the given project name prefix.
   *
   * @param prefix  project name prefix
   * @return  a list of projects
   */
  public List&lt;Project&gt; getProjects(String prefix) {
<span class="nc" id="L63">    List&lt;Project&gt; projects = new ArrayList&lt;Project&gt;();</span>

<span class="nc bnc" id="L65" title="All 2 branches missed.">    for (Project project : projectsMap.values()) {</span>
<span class="nc bnc" id="L66" title="All 2 branches missed.">      if (project.getProjectName().startsWith(prefix)) {</span>
<span class="nc" id="L67">        projects.add(project);</span>
      }
<span class="nc" id="L69">    }</span>

<span class="nc" id="L71">    return projects;</span>
  }

  /**
   * Returns the project that belongs to a project node.
   *
   * @param node the project node for which we want to retrieve the project
   * @return the project of the node
   */
  public Project getProject(ProjectNode node) {
<span class="nc" id="L81">    return projectsMap.get(node.getProjectId());</span>
  }

  /**
   * Returns the project for the given project name.
   *
   * &lt;p&gt;Note that in case of multiple projects with the same name, only the
   * first matching project will be returned.
   *
   * @param name  project name
   * @return  the corresponding project or {@code null}
   */
  public Project getProject(String name) {
<span class="nc bnc" id="L94" title="All 2 branches missed.">    for (Project project : projectsMap.values()) {</span>
<span class="nc bnc" id="L95" title="All 2 branches missed.">      if (project.getProjectName().equals(name)) {</span>
<span class="nc" id="L96">        return project;</span>
      }
<span class="nc" id="L98">    }</span>

<span class="nc" id="L100">    return null;</span>
  }

  /**
   * Returns the project for the given project ID.
   *
   * @param projectId project ID
   * @return the corresponding project or {@code null}
   */
  public Project getProject(long projectId) {
<span class="nc" id="L110">    return projectsMap.get(projectId);</span>
  }

  /**
   * Adds a new project to this project manager.
   *
   * @param projectInfo information about the project
   * @return new project
   */
  public Project addProject(UserProject projectInfo) {
<span class="nc" id="L120">    Project project = new Project(projectInfo);</span>
<span class="nc" id="L121">    projectsMap.put(projectInfo.getProjectId(), project);</span>
<span class="nc" id="L122">    fireProjectAdded(project);</span>
<span class="nc" id="L123">    return project;</span>
  }

  /**
   * Removes the project from trash permanently.
   *
   * @param projectId project ID
   */

  public void removeDeletedProject(long projectId) {
<span class="nc" id="L133">    Project project = projectsMap.remove(projectId);</span>
<span class="nc" id="L134">    fireProjectDeleted(project);</span>
<span class="nc" id="L135">  }</span>

  /**
   * Restores the project from trash back to my projects.
   *
   * @param projectId project ID
   */

  public void restoreTrashProject(long projectId) {
<span class="nc" id="L144">    Project project = projectsMap.get(projectId);</span>
<span class="nc" id="L145">    fireTrashProjectRestored(project);</span>
<span class="nc" id="L146">  }</span>

  public void trashProject(long projectId) {
<span class="nc" id="L149">    Project project = projectsMap.get(projectId);</span>
<span class="nc" id="L150">    fireProjectTrashed(project);</span>
<span class="nc" id="L151">  }</span>

  /**
   * Adds a {@link ProjectManagerEventListener} to the listener list.
   *
   * @param listener  the {@code ProjectManagerEventListener} to be added
   */
  public void addProjectManagerEventListener(ProjectManagerEventListener listener) {
<span class="nc" id="L159">    projectManagerEventListeners.add(listener);</span>
<span class="nc bnc" id="L160" title="All 2 branches missed.">    if (projectsLoaded) {</span>
      // inform the listener that projects have already been loaded
<span class="nc" id="L162">      listener.onProjectsLoaded();</span>
    }
<span class="nc" id="L164">  }</span>

  /**
   * Removes a {@link ProjectManagerEventListener} from the listener list.
   *
   * @param listener  the {@code ProjectManagerEventListener} to be removed
   */
  public void removeProjectManagerEventListener(ProjectManagerEventListener listener) {
<span class="nc" id="L172">    projectManagerEventListeners.remove(listener);</span>
<span class="nc" id="L173">  }</span>

  private List&lt;ProjectManagerEventListener&gt; copyProjectManagerEventListeners() {
<span class="nc" id="L176">    return new ArrayList&lt;ProjectManagerEventListener&gt;(projectManagerEventListeners);</span>
  }

  /*
   * Triggers a 'project added' event to be sent to the listener on the listener list.
   */
  private void fireProjectAdded(Project project) {
<span class="nc bnc" id="L183" title="All 2 branches missed.">    for (ProjectManagerEventListener listener : copyProjectManagerEventListeners()) {</span>
<span class="nc" id="L184">      listener.onProjectAdded(project);</span>
<span class="nc" id="L185">    }</span>
<span class="nc" id="L186">  }</span>

  /*
   * Triggers a 'project removed' event to be sent to the listener on the listener list.
   */
  private void fireTrashProjectRestored(Project project) {
<span class="nc bnc" id="L192" title="All 2 branches missed.">    for (ProjectManagerEventListener listener : copyProjectManagerEventListeners()) {</span>
<span class="nc" id="L193">      listener.onTrashProjectRestored(project);</span>
<span class="nc" id="L194">    }</span>
<span class="nc" id="L195">  }</span>

  private void fireProjectTrashed(Project project) {
<span class="nc bnc" id="L198" title="All 2 branches missed.">    for (ProjectManagerEventListener listener : copyProjectManagerEventListeners()) {</span>
<span class="nc" id="L199">      listener.onProjectTrashed(project);</span>
<span class="nc" id="L200">    }</span>
<span class="nc" id="L201">  }</span>

  private void fireProjectDeleted(Project project) {
<span class="nc bnc" id="L204" title="All 2 branches missed.">    for (ProjectManagerEventListener listener : copyProjectManagerEventListeners()) {</span>
<span class="nc" id="L205">      listener.onProjectDeleted(project);</span>
<span class="nc" id="L206">    }</span>
<span class="nc" id="L207">  }</span>

  /*
   * Triggers a 'projects loaded' event to be sent to the listener on the listener list.
   */
  private void fireProjectsLoaded() {
<span class="nc" id="L213">    projectsLoaded = true;</span>
<span class="nc bnc" id="L214" title="All 2 branches missed.">    for (ProjectManagerEventListener listener : copyProjectManagerEventListeners()) {</span>
<span class="nc" id="L215">      listener.onProjectsLoaded();</span>
<span class="nc" id="L216">    }</span>
<span class="nc" id="L217">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>