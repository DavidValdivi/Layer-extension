<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UploadResponse.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.google.appinventor.shared.rpc</a> &gt; <span class="el_source">UploadResponse.java</span></div><h1>UploadResponse.java</h1><pre class="source lang-java linenums">// -*- mode: java; c-basic-offset: 2; -*-
// Copyright 2009-2011 Google, All Rights reserved
// Copyright 2011-2012 MIT, All rights reserved
// Released under the Apache License, Version 2.0
// http://www.apache.org/licenses/LICENSE-2.0

package com.google.appinventor.shared.rpc;

/**
 * Class representing the response from an upload request.
 *
 * @author lizlooney@google.com (Liz Looney)
 * @author kerr@google.com (Debby Wallach)
 */
public class UploadResponse {

<span class="fc" id="L17">  public enum Status {</span>
<span class="fc" id="L18">    SUCCESS,</span>
<span class="fc" id="L19">    NOT_PROJECT_ARCHIVE,</span>
<span class="fc" id="L20">    FILE_TOO_LARGE,</span>
<span class="fc" id="L21">    NOT_INVITE_CSV,</span>
<span class="fc" id="L22">    NOT_AN_INVITER,</span>
<span class="fc" id="L23">    IO_EXCEPTION;</span>
  }

  private final Status status;
  private int count;
  private String info;
<span class="pc" id="L29">  private long modificationDate = 0;</span>

  private static final String DELIM = &quot;#DELIM#&quot;;

  // Because Chrome extensions can insert extra html tags into the response from the
  // UploadServlet, we need begin and end delimiters to bracket the UploadResponse.
  // Note - Internet Explorer sometimes changes &lt;pre&gt; to &lt;PRE&gt; and &lt;/pre&gt; to &lt;/PRE&gt;. It sometimes
  // changes &lt;PRE&gt; to &lt;pre&gt; and &lt;/PRE&gt; to &lt;/pre&gt;, which I find hysterical!
  // To work around this crazy browser behavior, we don't put &lt;pre&gt; and &lt;/pre&gt; tags in these
  // constants, which are used for parsing in extractUploadResponse(). However, the &lt;pre&gt; and
  // &lt;/pre&gt; tags are still used in formatAsHtml().
  private static final String BEGIN = &quot;[UPLOAD RESPONSE BEGIN]&quot;;
  private static final String END = &quot;[UPLOAD RESPONSE END]&quot;;

  public UploadResponse(Status status) {
<span class="fc" id="L44">    this(status, 0, &quot;&quot;);</span>
<span class="fc" id="L45">  }</span>

<span class="fc" id="L47">  public UploadResponse(Status status, int count, String info) {</span>
<span class="fc" id="L48">    this.status = status;</span>
<span class="fc" id="L49">    this.count = count;</span>
<span class="fc" id="L50">    this.info = info;</span>
<span class="fc" id="L51">  }</span>

<span class="nc" id="L53">  public UploadResponse(Status status, long modificationDate) {</span>
<span class="nc" id="L54">    this.status = status;</span>
<span class="nc" id="L55">    this.count = 0;</span>
<span class="nc" id="L56">    this.info = &quot;&quot;;</span>
<span class="nc" id="L57">    this.modificationDate = modificationDate;</span>
<span class="nc" id="L58">  }</span>

  public Status getStatus() {
<span class="fc" id="L61">    return status;</span>
  }

  public int getCount() {
<span class="fc" id="L65">    return count;</span>
  }

  public String getInfo() {
<span class="fc" id="L69">    return info;</span>
  }

  public long getModificationDate() {
<span class="fc" id="L73">    return modificationDate;</span>
  }

  @Override
  public String toString() {
    // If another field is inserted here, don't forget to update valueOf below.
<span class="nc" id="L79">    return status.toString() + DELIM +</span>
        count + DELIM +
        modificationDate + DELIM +
        // Since info is a string and can contain more delimiters, it must be last.
        // If you need to add more parts, please add them before info.
        info;
  }

  public static UploadResponse valueOf(String text) {
    // There are 4 parts: status, count, modificationDate, and info, separated by delimiter.
    // Since info is a string and can contain more delimiters, it must be last.
<span class="fc" id="L90">    int maxParts = 4; // If you modify this value, please update the comment above.</span>
    // We pass maxParts to split so that the last element in the parts array will contain the rest
    // of the text.
<span class="fc" id="L93">    String[] parts = text.split(DELIM, maxParts);</span>
<span class="fc" id="L94">    UploadResponse uploadResponse = new UploadResponse(Status.valueOf(parts[0]));</span>
<span class="pc bpc" id="L95" title="1 of 2 branches missed.">    if (parts.length &gt; 1) {</span>
<span class="fc" id="L96">      uploadResponse.count = Integer.parseInt(parts[1]);</span>
    }
<span class="pc bpc" id="L98" title="1 of 2 branches missed.">    if (parts.length &gt; 2) {</span>
<span class="fc" id="L99">      uploadResponse.modificationDate = Long.parseLong(parts[2]);</span>
    }

    // Remember, since the info may contain more delimiters, it must be last.
    // If you need to add more parts, please add them before info.

<span class="fc" id="L105">    int infoIndex = maxParts - 1; // info must be last!</span>
<span class="pc bpc" id="L106" title="1 of 2 branches missed.">    if (parts.length &gt; infoIndex) {</span>
<span class="fc" id="L107">      uploadResponse.info = parts[infoIndex];</span>
    }
<span class="fc" id="L109">    return uploadResponse;</span>
  }

  /**
   * Formats this UploadResponse so it can be written to the UploadServlet
   * response.
   */
  public String formatAsHtml() {
<span class="nc" id="L117">    return &quot;&lt;pre&gt;&quot; + BEGIN + toString() + END + &quot;&lt;/pre&gt;&quot;;</span>
  }

  /**
   * Extracts the UploadResponse from the results of a FormSubmitCompleteEvent.
   *
   * @param results the results of a FormSubmitCompleteEvent
   * @return an UploadResponse, or null if the results could not be parsed
   */
  public static UploadResponse extractUploadResponse(String results) {
<span class="fc" id="L127">    int beginIndex = results.indexOf(BEGIN);</span>
<span class="pc bpc" id="L128" title="1 of 2 branches missed.">    if (beginIndex == -1) {</span>
<span class="nc" id="L129">      return null;</span>
    }
<span class="fc" id="L131">    beginIndex += BEGIN.length();</span>
<span class="fc" id="L132">    int endIndex = results.indexOf(END, beginIndex);</span>
<span class="pc bpc" id="L133" title="1 of 2 branches missed.">    if (endIndex == -1) {</span>
<span class="nc" id="L134">      return null;</span>
    }
<span class="fc" id="L136">    String s = results.substring(beginIndex, endIndex);</span>
    try {
<span class="fc" id="L138">      return valueOf(s);</span>
<span class="nc" id="L139">    } catch (RuntimeException e) {</span>
<span class="nc" id="L140">      return null;</span>
    }
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>