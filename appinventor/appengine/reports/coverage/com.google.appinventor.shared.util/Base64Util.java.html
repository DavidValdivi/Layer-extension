<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Base64Util.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.google.appinventor.shared.util</a> &gt; <span class="el_source">Base64Util.java</span></div><h1>Base64Util.java</h1><pre class="source lang-java linenums">// -*- mode: java; c-basic-offset: 2; -*-
package com.google.appinventor.shared.util;

//Copyright 2003-2010 Christian d'Heureuse, Inventec Informatik AG, Zurich, Switzerland
//www.source-code.biz, www.inventec.ch/chdh
//
//This module is multi-licensed and may be used under the terms
//of any of the following licenses:
//
//EPL, Eclipse Public License, V1.0 or later, http://www.eclipse.org/legal
//LGPL, GNU Lesser General Public License, V2.1 or later, http://www.gnu.org/licenses/lgpl.html
//GPL, GNU General Public License, V2 or later, http://www.gnu.org/licenses/gpl.html
//AL, Apache License, V2.0 or later, http://www.apache.org/licenses
//BSD, BSD License, http://www.opensource.org/licenses/bsd-license.php
//MIT, MIT License, http://www.opensource.org/licenses/MIT
//
//Please contact the author if you need another license.
//This module is provided &quot;as is&quot;, without warranties of any kind.

/**
 * A Base64 encoder/decoder.
 *
 * &lt;p&gt;
 * This class is used to encode and decode data in Base64 format as described in RFC 1521.
 *
 * &lt;p&gt;
 * Project home page: &lt;a href=&quot;http://www.source-code.biz/base64coder/java/&quot;&gt;www.source-code.biz/base64coder/java&lt;/a&gt;&lt;br&gt;
 * Author: Christian d'Heureuse, Inventec Informatik AG, Zurich, Switzerland&lt;br&gt;
 * Multi-licensed: EPL / LGPL / GPL / AL / BSD / MIT.
 */
public class Base64Util {

  //The line separator string of the operating system.
  // Must provide this statically so we can use this module in GWT where there is no System object
  // and we are used in an RPC where we want the same delimiter independent of the client
  // architecture.
  private static final String systemLineSeparator = &quot;\n&quot;;
  // private static final String systemLineSeparator = System.getProperty(&quot;line.separator&quot;);

  //Mapping table from 6-bit nibbles to Base64 characters.
<span class="nc" id="L41">  private static final char[] map1 = new char[64];</span>
  static {
<span class="nc" id="L43">    int i=0;</span>
<span class="nc bnc" id="L44" title="All 2 branches missed.">    for (char c='A'; c&lt;='Z'; c++) map1[i++] = c;</span>
<span class="nc bnc" id="L45" title="All 2 branches missed.">    for (char c='a'; c&lt;='z'; c++) map1[i++] = c;</span>
<span class="nc bnc" id="L46" title="All 2 branches missed.">    for (char c='0'; c&lt;='9'; c++) map1[i++] = c;</span>
<span class="nc" id="L47">    map1[i++] = '+'; map1[i++] = '/'; }</span>

  //Mapping table from Base64 characters to 6-bit nibbles.
<span class="nc" id="L50">  private static final byte[] map2 = new byte[128];</span>
  static {
<span class="nc bnc" id="L52" title="All 2 branches missed.">    for (int i=0; i&lt;map2.length; i++) map2[i] = -1;</span>
<span class="nc bnc" id="L53" title="All 2 branches missed.">    for (int i=0; i&lt;64; i++) map2[map1[i]] = (byte)i; }</span>

  /**
   * Encodes a string into Base64 format.
   * No blanks or line breaks are inserted.
   * @param s  A String to be encoded.
   * @return   A String containing the Base64 encoded data.
   */
  public static String encodeString (String s) {
<span class="nc" id="L62">    return new String(encode(s.getBytes())); }</span>

  /**
   * Encodes a byte array into Base 64 format and breaks the output into lines of 76 characters.
   * This method is compatible with &lt;code&gt;sun.misc.BASE64Encoder.encodeBuffer(byte[])&lt;/code&gt;.
   * @param in  An array containing the data bytes to be encoded.
   * @return    A String containing the Base64 encoded data, broken into lines.
   */
  public static String encodeLines (byte[] in) {
<span class="nc" id="L71">    return encodeLines(in, 0, in.length, 76, systemLineSeparator); }</span>

  /**
   * Encodes a byte array into Base 64 format and breaks the output into lines.
   * @param in            An array containing the data bytes to be encoded.
   * @param iOff          Offset of the first byte in &lt;code&gt;in&lt;/code&gt; to be processed.
   * @param iLen          Number of bytes to be processed in &lt;code&gt;in&lt;/code&gt;, starting at &lt;code&gt;iOff&lt;/code&gt;.
   * @param lineLen       Line length for the output data. Should be a multiple of 4.
   * @param lineSeparator The line separator to be used to separate the output lines.
   * @return              A String containing the Base64 encoded data, broken into lines.
   */
  public static String encodeLines (byte[] in, int iOff, int iLen, int lineLen, String lineSeparator) {
<span class="nc" id="L83">    int blockLen = (lineLen*3) / 4;</span>
<span class="nc bnc" id="L84" title="All 2 branches missed.">    if (blockLen &lt;= 0) throw new IllegalArgumentException();</span>
<span class="nc" id="L85">    int lines = (iLen+blockLen-1) / blockLen;</span>
<span class="nc" id="L86">    int bufLen = ((iLen+2)/3)*4 + lines*lineSeparator.length();</span>
<span class="nc" id="L87">    StringBuilder buf = new StringBuilder(bufLen);</span>
<span class="nc" id="L88">    int ip = 0;</span>
<span class="nc bnc" id="L89" title="All 2 branches missed.">    while (ip &lt; iLen) {</span>
<span class="nc" id="L90">      int l = Math.min(iLen-ip, blockLen);</span>
<span class="nc" id="L91">      buf.append (encode(in, iOff+ip, l));</span>
<span class="nc" id="L92">      buf.append (lineSeparator);</span>
<span class="nc" id="L93">      ip += l; }</span>
<span class="nc" id="L94">    return buf.toString(); }</span>

  /**
   * Encodes a byte array into Base64 format.
   * No blanks or line breaks are inserted in the output.
   * @param in  An array containing the data bytes to be encoded.
   * @return    A character array containing the Base64 encoded data.
   */
  public static char[] encode (byte[] in) {
<span class="nc" id="L103">    return encode(in, 0, in.length); }</span>

  /**
   * Encodes a byte array into Base64 format.
   * No blanks or line breaks are inserted in the output.
   * @param in    An array containing the data bytes to be encoded.
   * @param iLen  Number of bytes to process in &lt;code&gt;in&lt;/code&gt;.
   * @return      A character array containing the Base64 encoded data.
   */
  public static char[] encode (byte[] in, int iLen) {
<span class="nc" id="L113">    return encode(in, 0, iLen); }</span>

  /**
   * Encodes a byte array into Base64 format.
   * No blanks or line breaks are inserted in the output.
   * @param in    An array containing the data bytes to be encoded.
   * @param iOff  Offset of the first byte in &lt;code&gt;in&lt;/code&gt; to be processed.
   * @param iLen  Number of bytes to process in &lt;code&gt;in&lt;/code&gt;, starting at &lt;code&gt;iOff&lt;/code&gt;.
   * @return      A character array containing the Base64 encoded data.
   */
  public static char[] encode (byte[] in, int iOff, int iLen) {
<span class="nc" id="L124">    int oDataLen = (iLen*4+2)/3;       // output length without padding</span>
<span class="nc" id="L125">    int oLen = ((iLen+2)/3)*4;         // output length including padding</span>
<span class="nc" id="L126">    char[] out = new char[oLen];</span>
<span class="nc" id="L127">    int ip = iOff;</span>
<span class="nc" id="L128">    int iEnd = iOff + iLen;</span>
<span class="nc" id="L129">    int op = 0;</span>
<span class="nc bnc" id="L130" title="All 2 branches missed.">    while (ip &lt; iEnd) {</span>
<span class="nc" id="L131">      int i0 = in[ip++] &amp; 0xff;</span>
<span class="nc bnc" id="L132" title="All 2 branches missed.">      int i1 = ip &lt; iEnd ? in[ip++] &amp; 0xff : 0;</span>
<span class="nc bnc" id="L133" title="All 2 branches missed.">      int i2 = ip &lt; iEnd ? in[ip++] &amp; 0xff : 0;</span>
<span class="nc" id="L134">      int o0 = i0 &gt;&gt;&gt; 2;</span>
<span class="nc" id="L135">      int o1 = ((i0 &amp;   3) &lt;&lt; 4) | (i1 &gt;&gt;&gt; 4);</span>
<span class="nc" id="L136">      int o2 = ((i1 &amp; 0xf) &lt;&lt; 2) | (i2 &gt;&gt;&gt; 6);</span>
<span class="nc" id="L137">      int o3 = i2 &amp; 0x3F;</span>
<span class="nc" id="L138">      out[op++] = map1[o0];</span>
<span class="nc" id="L139">      out[op++] = map1[o1];</span>
<span class="nc bnc" id="L140" title="All 2 branches missed.">      out[op] = op &lt; oDataLen ? map1[o2] : '='; op++;</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">      out[op] = op &lt; oDataLen ? map1[o3] : '='; op++; }</span>
<span class="nc" id="L142">    return out; }</span>

  /**
   * Decodes a string from Base64 format.
   * No blanks or line breaks are allowed within the Base64 encoded input data.
   * @param s  A Base64 String to be decoded.
   * @return   A String containing the decoded data.
   * @throws   IllegalArgumentException If the input is not valid Base64 encoded data.
   */
  public static String decodeString (String s) {
<span class="nc" id="L152">    return new String(decode(s)); }</span>

  /**
   * Decodes a byte array from Base64 format and ignores line separators, tabs and blanks.
   * CR, LF, Tab and Space characters are ignored in the input data.
   * This method is compatible with &lt;code&gt;sun.misc.BASE64Decoder.decodeBuffer(String)&lt;/code&gt;.
   * @param s  A Base64 String to be decoded.
   * @return   An array containing the decoded data bytes.
   * @throws   IllegalArgumentException If the input is not valid Base64 encoded data.
   */
  public static byte[] decodeLines (String s) {
<span class="nc" id="L163">    char[] buf = new char[s.length()];</span>
<span class="nc" id="L164">    int p = 0;</span>
<span class="nc bnc" id="L165" title="All 2 branches missed.">    for (int ip = 0; ip &lt; s.length(); ip++) {</span>
<span class="nc" id="L166">      char c = s.charAt(ip);</span>
<span class="nc bnc" id="L167" title="All 8 branches missed.">      if (c != ' ' &amp;&amp; c != '\r' &amp;&amp; c != '\n' &amp;&amp; c != '\t')</span>
<span class="nc" id="L168">        buf[p++] = c; }</span>
<span class="nc" id="L169">    return decode(buf, 0, p); }</span>

  /**
   * Decodes a byte array from Base64 format.
   * No blanks or line breaks are allowed within the Base64 encoded input data.
   * @param s  A Base64 String to be decoded.
   * @return   An array containing the decoded data bytes.
   * @throws   IllegalArgumentException If the input is not valid Base64 encoded data.
   */
  public static byte[] decode (String s) {
<span class="nc" id="L179">    return decode(s.toCharArray()); }</span>

  /**
   * Decodes a byte array from Base64 format.
   * No blanks or line breaks are allowed within the Base64 encoded input data.
   * @param in  A character array containing the Base64 encoded data.
   * @return    An array containing the decoded data bytes.
   * @throws    IllegalArgumentException If the input is not valid Base64 encoded data.
   */
  public static byte[] decode (char[] in) {
<span class="nc" id="L189">    return decode(in, 0, in.length); }</span>

  /**
   * Decodes a byte array from Base64 format.
   * No blanks or line breaks are allowed within the Base64 encoded input data.
   * @param in    A character array containing the Base64 encoded data.
   * @param iOff  Offset of the first character in &lt;code&gt;in&lt;/code&gt; to be processed.
   * @param iLen  Number of characters to process in &lt;code&gt;in&lt;/code&gt;, starting at &lt;code&gt;iOff&lt;/code&gt;.
   * @return      An array containing the decoded data bytes.
   * @throws      IllegalArgumentException If the input is not valid Base64 encoded data.
   */
  public static byte[] decode (char[] in, int iOff, int iLen) {
<span class="nc bnc" id="L201" title="All 2 branches missed.">    if (iLen%4 != 0) throw new IllegalArgumentException (&quot;Length of Base64 encoded input string is not a multiple of 4.&quot;);</span>
<span class="nc bnc" id="L202" title="All 4 branches missed.">    while (iLen &gt; 0 &amp;&amp; in[iOff+iLen-1] == '=') iLen--;</span>
<span class="nc" id="L203">    int oLen = (iLen*3) / 4;</span>
<span class="nc" id="L204">    byte[] out = new byte[oLen];</span>
<span class="nc" id="L205">    int ip = iOff;</span>
<span class="nc" id="L206">    int iEnd = iOff + iLen;</span>
<span class="nc" id="L207">    int op = 0;</span>
<span class="nc bnc" id="L208" title="All 2 branches missed.">    while (ip &lt; iEnd) {</span>
<span class="nc" id="L209">      int i0 = in[ip++];</span>
<span class="nc" id="L210">      int i1 = in[ip++];</span>
<span class="nc bnc" id="L211" title="All 2 branches missed.">      int i2 = ip &lt; iEnd ? in[ip++] : 'A';</span>
<span class="nc bnc" id="L212" title="All 2 branches missed.">      int i3 = ip &lt; iEnd ? in[ip++] : 'A';</span>
<span class="nc bnc" id="L213" title="All 8 branches missed.">      if (i0 &gt; 127 || i1 &gt; 127 || i2 &gt; 127 || i3 &gt; 127)</span>
<span class="nc" id="L214">        throw new IllegalArgumentException (&quot;Illegal character in Base64 encoded data.&quot;);</span>
<span class="nc" id="L215">      int b0 = map2[i0];</span>
<span class="nc" id="L216">      int b1 = map2[i1];</span>
<span class="nc" id="L217">      int b2 = map2[i2];</span>
<span class="nc" id="L218">      int b3 = map2[i3];</span>
<span class="nc bnc" id="L219" title="All 8 branches missed.">      if (b0 &lt; 0 || b1 &lt; 0 || b2 &lt; 0 || b3 &lt; 0)</span>
<span class="nc" id="L220">        throw new IllegalArgumentException (&quot;Illegal character in Base64 encoded data.&quot;);</span>
<span class="nc" id="L221">      int o0 = ( b0       &lt;&lt;2) | (b1&gt;&gt;&gt;4);</span>
<span class="nc" id="L222">      int o1 = ((b1 &amp; 0xf)&lt;&lt;4) | (b2&gt;&gt;&gt;2);</span>
<span class="nc" id="L223">      int o2 = ((b2 &amp;   3)&lt;&lt;6) |  b3;</span>
<span class="nc" id="L224">      out[op++] = (byte)o0;</span>
<span class="nc bnc" id="L225" title="All 2 branches missed.">      if (op&lt;oLen) out[op++] = (byte)o1;</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">      if (op&lt;oLen) out[op++] = (byte)o2; }</span>
<span class="nc" id="L227">    return out; }</span>

  //Dummy constructor.
  private Base64Util() {}

} // end class Base64Coder
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>