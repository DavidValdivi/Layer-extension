<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>YoungAndroidSourceAnalyzer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.google.appinventor.shared.youngandroid</a> &gt; <span class="el_source">YoungAndroidSourceAnalyzer.java</span></div><h1>YoungAndroidSourceAnalyzer.java</h1><pre class="source lang-java linenums">// -*- mode: java; c-basic-offset: 2; -*-
// Copyright 2009-2011 Google, All Rights reserved
// Copyright 2011-2019 MIT, All rights reserved
// Released under the Apache License, Version 2.0
// http://www.apache.org/licenses/LICENSE-2.0

package com.google.appinventor.shared.youngandroid;

import com.google.appinventor.shared.properties.json.JSONObject;
import com.google.appinventor.shared.properties.json.JSONParser;

/**
 * Methods for analyzing the contents of a Young Android Form file.
 *
 * @author lizlooney@google.com (Liz Looney)
 */
public class YoungAndroidSourceAnalyzer {

  public static final String ASSETS_FOLDER = &quot;assets&quot;;

  // TODO(user) Source these from a common constants library.
  public static final String SRC_FOLDER = &quot;src&quot;;

  /**
   * The filename extension for the file which contains the component
   * properties information generated by the ODE client.
   */
  public static final String FORM_PROPERTIES_EXTENSION = &quot;.scm&quot;;

  /**
   * The filename extension for the file which contains block metadata to be
   * consumed by codeblocks.
   */
  public static final String CODEBLOCKS_SOURCE_EXTENSION = &quot;.blk&quot;;

  /**
   * The filename extension for the file which contains block data to be
   * consumed by blockly (the in-browser blocks editor).
   */
  public static final String BLOCKLY_SOURCE_EXTENSION = &quot;.bky&quot;;
  
  /**
   * The filename extension for the generated Yail file. Even though it is generated by the system
   * and can be reconstructed from the .scm and .bky files it is stored as a source file.
   */
  public static final String YAIL_FILE_EXTENSION = &quot;.yail&quot;;

  private static final String FORM_PROPERTIES_PREFIX = &quot;#|\n&quot;;
  private static final String FORM_PROPERTIES_SUFFIX = &quot;\n|#&quot;;

  private YoungAndroidSourceAnalyzer() {
  }

  /**
   * Parses a complete source file and return the properties as a JSONObject.
   *
   * @param source a complete source file
   * @param jsonParser a JSON parser
   * @return the properties as a JSONObject
   */
  public static JSONObject parseSourceFile(String source, JSONParser jsonParser) {
<span class="fc" id="L62">    source = source.replaceAll(&quot;\r\n&quot;, &quot;\n&quot;);</span>
    // First, locate the beginning of the $JSON section.
    // Older files have a $Properties before the $JSON section and we need to make sure we skip
    // that.
<span class="fc" id="L66">    String jsonSectionPrefix = FORM_PROPERTIES_PREFIX + &quot;$JSON\n&quot;;</span>
<span class="fc" id="L67">    int beginningOfJsonSection = source.lastIndexOf(jsonSectionPrefix);</span>
<span class="pc bpc" id="L68" title="1 of 2 branches missed.">    if (beginningOfJsonSection == -1) {</span>
<span class="nc" id="L69">      throw new IllegalArgumentException(</span>
          &quot;Unable to parse file - cannot locate beginning of $JSON section&quot;);
    }
<span class="fc" id="L72">    beginningOfJsonSection += jsonSectionPrefix.length();</span>

    // Then, locate the end of the $JSON section;
<span class="fc" id="L75">    String jsonSectionSuffix = FORM_PROPERTIES_SUFFIX;</span>
<span class="fc" id="L76">    int endOfJsonSection = source.lastIndexOf(jsonSectionSuffix);</span>
<span class="pc bpc" id="L77" title="1 of 2 branches missed.">    if (endOfJsonSection == -1) {</span>
<span class="nc" id="L78">      throw new IllegalArgumentException(</span>
          &quot;Unable to parse file - cannot locate end of $JSON section&quot;);
    }

<span class="fc" id="L82">    String jsonPropertiesString = source.substring(beginningOfJsonSection,</span>
        endOfJsonSection);
<span class="fc" id="L84">    return jsonParser.parse(jsonPropertiesString).asObject();</span>
  }

  /**
   * Generates a complete source file from the given properties
   *
   * @param propertiesObject the properties as a JSONObject
   * @return the complete source file
   */
  public static String generateSourceFile(JSONObject propertiesObject) {
<span class="fc" id="L94">    String jsonPropertiesSection = &quot;$JSON\n&quot; + propertiesObject.toJson();</span>
<span class="fc" id="L95">    return FORM_PROPERTIES_PREFIX + jsonPropertiesSection + FORM_PROPERTIES_SUFFIX;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>