<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UrlImportWizard.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.google.appinventor.client.wizards</a> &gt; <span class="el_source">UrlImportWizard.java</span></div><h1>UrlImportWizard.java</h1><pre class="source lang-java linenums">// -*- mode: java; c-basic-offset: 2; -*-
// Copyright 2016-2017 MIT, All rights reserved
// Released under the Apache License, Version 2.0
// http://www.apache.org/licenses/LICENSE-2.0

package com.google.appinventor.client.wizards;

import static com.google.appinventor.client.Ode.MESSAGES;

import java.util.HashSet;
import java.util.Set;

import com.google.appinventor.client.Ode;
import com.google.appinventor.client.OdeAsyncCallback;
import com.google.appinventor.client.explorer.project.Project;
import com.google.appinventor.shared.rpc.project.FolderNode;
import com.google.appinventor.shared.rpc.project.ProjectNode;
import com.google.appinventor.shared.rpc.project.TextFile;
import com.google.appinventor.shared.rpc.project.youngandroid.YoungAndroidAssetNode;
import com.google.appinventor.shared.util.Base64Util;
import com.google.gwt.user.client.Command;
import com.google.gwt.user.client.Window;
import com.google.gwt.user.client.ui.Grid;
import com.google.gwt.user.client.ui.Label;
import com.google.gwt.user.client.ui.TextBox;
import com.google.gwt.user.client.ui.VerticalPanel;

public class UrlImportWizard extends Wizard {
<span class="nc" id="L29">  private final Set&lt;OnImportListener&gt; listeners = new HashSet&lt;OnImportListener&gt;();</span>

  public interface OnImportListener {
    void onSuccess(byte[] content);
  }

  public UrlImportWizard(final FolderNode assetsFolder, OnImportListener listener) {
<span class="nc" id="L36">    super(MESSAGES.urlImportWizardCaption(), true, false);</span>

<span class="nc" id="L38">    listeners.add(listener);</span>

<span class="nc" id="L40">    final Grid urlGrid = createUrlGrid();</span>
<span class="nc" id="L41">    VerticalPanel panel = new VerticalPanel();</span>
<span class="nc" id="L42">    panel.add(urlGrid);</span>

<span class="nc" id="L44">    addPage(panel);</span>

<span class="nc" id="L46">    getConfirmButton().setText(&quot;Import&quot;);</span>

<span class="nc" id="L48">    setPagePanelHeight(150);</span>
<span class="nc" id="L49">    setPixelSize(200, 150);</span>
<span class="nc" id="L50">    setStylePrimaryName(&quot;ode-DialogBox&quot;);</span>

<span class="nc" id="L52">    initFinishCommand(new Command() {</span>
      @Override
      public void execute() {
<span class="nc" id="L55">        Ode ode = Ode.getInstance();</span>
<span class="nc" id="L56">        final long projectId = ode.getCurrentYoungAndroidProjectId();</span>
<span class="nc" id="L57">        final Project project = ode.getProjectManager().getProject(projectId);</span>

<span class="nc" id="L59">        TextBox urlTextBox = (TextBox) urlGrid.getWidget(1, 0);</span>
<span class="nc" id="L60">        String url = urlTextBox.getText();</span>
<span class="nc bnc" id="L61" title="All 2 branches missed.">        if (url.trim().isEmpty()) {</span>
<span class="nc" id="L62">          Window.alert(MESSAGES.noUrlError());</span>
<span class="nc" id="L63">          return;</span>
        }

<span class="nc" id="L66">        ode.getProjectService().importMedia(ode.getSessionId(), projectId, url, true, new OdeAsyncCallback&lt;TextFile&gt;() {</span>
          @Override
          public void onSuccess(TextFile file) {
<span class="nc" id="L69">            ProjectNode node = new YoungAndroidAssetNode(assetsFolder.getFileId(), file.getFileName().replaceFirst(&quot;assets/&quot;, &quot;&quot;));</span>
<span class="nc" id="L70">            project.addNode(assetsFolder, node);</span>
<span class="nc" id="L71">            byte[] content = Base64Util.decodeLines(file.getContent());</span>
<span class="nc bnc" id="L72" title="All 2 branches missed.">            for (OnImportListener l : listeners) {</span>
<span class="nc" id="L73">              l.onSuccess(content);</span>
<span class="nc" id="L74">            }</span>
<span class="nc" id="L75">            listeners.clear();</span>
<span class="nc" id="L76">          }</span>
        });
<span class="nc" id="L78">      }</span>
    });
<span class="nc" id="L80">  }</span>

  public void addImportListener(OnImportListener listener) {
<span class="nc" id="L83">    listeners.add(listener);</span>
<span class="nc" id="L84">  }</span>

  private static Grid createUrlGrid() {
<span class="nc" id="L87">    TextBox urlTextBox = new TextBox();</span>
<span class="nc" id="L88">    urlTextBox.setWidth(&quot;100%&quot;);</span>
<span class="nc" id="L89">    Grid grid = new Grid(2, 1);</span>
<span class="nc" id="L90">    grid.setWidget(0, 0, new Label(&quot;Url:&quot;));</span>
<span class="nc" id="L91">    grid.setWidget(1, 0, urlTextBox);</span>
<span class="nc" id="L92">    return grid;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>