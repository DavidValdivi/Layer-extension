<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SimplePaletteItem.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Coverage Report</a> &gt; <a href="index.source.html" class="el_package">com.google.appinventor.client.editor.simple.palette</a> &gt; <span class="el_source">SimplePaletteItem.java</span></div><h1>SimplePaletteItem.java</h1><pre class="source lang-java linenums">// -*- mode: java; c-basic-offset: 2; -*-
// Copyright 2009-2011 Google, All Rights reserved
// Copyright 2011-2012 MIT, All rights reserved
// Released under the Apache License, Version 2.0
// http://www.apache.org/licenses/LICENSE-2.0

package com.google.appinventor.client.editor.simple.palette;

import com.google.appinventor.client.ComponentsTranslation;
import com.google.appinventor.client.editor.simple.components.MockComponent;
import com.google.appinventor.client.editor.simple.components.MockComponentsUtil;
import com.google.appinventor.client.widgets.dnd.DragSourcePanel;
import com.google.appinventor.client.widgets.dnd.DragSourceSupport;
import com.google.appinventor.client.widgets.dnd.DropTarget;
import com.google.gwt.event.dom.client.MouseDownEvent;
import com.google.gwt.event.dom.client.MouseDownHandler;
import com.google.gwt.event.dom.client.TouchStartEvent;
import com.google.gwt.event.dom.client.TouchStartHandler;
import com.google.gwt.user.client.ui.HorizontalPanel;
import com.google.gwt.user.client.ui.Image;
import com.google.gwt.user.client.ui.Label;
import com.google.gwt.user.client.ui.Widget;

/**
 * This class represents a component on the component palette panel.
 *
 */
public class SimplePaletteItem extends DragSourcePanel {
  // Queried to determine the set of UI elements that accept drops of palette items
  private DropTargetProvider dropTargetProvider;

  // Component descriptor (needed for mock component instantiation)
  private SimpleComponentDescriptor scd;

  // Cached prototype of the component that this palette item creates.
  // Properties of the prototype may be queried by accessors.
  private MockComponent componentPrototype;

  //It is here to keep the selected panel item
  private static Widget selectedPaletteItemWidget;

  /**
   * Creates a new palette item.
   *
   * @param scd component descriptor for palette item
   * @param dropTargetProvider provider of targets that palette items can be dropped on
   */
<span class="nc" id="L48">  public SimplePaletteItem(SimpleComponentDescriptor scd, DropTargetProvider dropTargetProvider) {</span>
<span class="nc" id="L49">    this.dropTargetProvider = dropTargetProvider;</span>
<span class="nc" id="L50">    this.scd = scd;</span>

<span class="nc" id="L52">    componentPrototype = null;</span>

    // Initialize palette item UI
<span class="nc" id="L55">    HorizontalPanel panel = new HorizontalPanel();</span>
<span class="nc" id="L56">    panel.setStylePrimaryName(&quot;ode-SimplePaletteItem&quot;);</span>

<span class="nc" id="L58">    Image image = scd.getImage();</span>
<span class="nc" id="L59">    image.setStylePrimaryName(&quot;ode-SimplePaletteItem-icon&quot;);</span>
<span class="nc" id="L60">    panel.add(image);</span>
<span class="nc" id="L61">    panel.setCellHorizontalAlignment(image, HorizontalPanel.ALIGN_LEFT);</span>
<span class="nc" id="L62">    panel.setCellWidth(image, &quot;30px&quot;);</span>

<span class="nc" id="L64">    Label label = new Label(ComponentsTranslation.getComponentName(scd.getName()));</span>
<span class="nc" id="L65">    label.setHorizontalAlignment(Label.ALIGN_LEFT);</span>
<span class="nc" id="L66">    label.addStyleName(&quot;ode-SimplePaletteItem-caption&quot;);</span>
<span class="nc" id="L67">    panel.add(label);</span>

<span class="nc" id="L69">    HorizontalPanel optPanel = new HorizontalPanel();</span>

<span class="nc" id="L71">    ComponentHelpWidget helpImage = new ComponentHelpWidget(scd);</span>
<span class="nc" id="L72">    optPanel.add(helpImage);</span>
<span class="nc" id="L73">    optPanel.setCellHorizontalAlignment(helpImage, HorizontalPanel.ALIGN_LEFT);</span>

<span class="nc bnc" id="L75" title="All 2 branches missed.">    if (scd.getExternal()) {</span>
<span class="nc" id="L76">      ComponentRemoveWidget deleteImage = new ComponentRemoveWidget(scd);</span>
<span class="nc" id="L77">      optPanel.add(deleteImage);</span>
<span class="nc" id="L78">      optPanel.setCellHorizontalAlignment(deleteImage, HorizontalPanel.ALIGN_RIGHT);</span>
    }

<span class="nc" id="L81">    panel.add(optPanel);</span>
<span class="nc" id="L82">    panel.setCellHorizontalAlignment(optPanel, HorizontalPanel.ALIGN_RIGHT);</span>

<span class="nc" id="L84">    panel.setWidth(&quot;100%&quot;);</span>
<span class="nc" id="L85">    add(panel);</span>
<span class="nc" id="L86">    setWidth(&quot;100%&quot;);</span>

<span class="nc" id="L88">    addHandlers();</span>
<span class="nc" id="L89">  }</span>

  /**
   * Selects (sets the background to green of) a palette item when it is clicked.
   *
   * @param paletteItemWidget the Widget of the panel item to be selected
   */
  private static void select(Widget paletteItemWidget) {
<span class="nc bnc" id="L97" title="All 2 branches missed.">    if (selectedPaletteItemWidget != null) {</span>
<span class="nc" id="L98">      selectedPaletteItemWidget.getElement().getStyle().setProperty(&quot;backgroundColor&quot;, &quot;white&quot;);</span>
    }
<span class="nc" id="L100">    selectedPaletteItemWidget = paletteItemWidget;</span>
<span class="nc" id="L101">    selectedPaletteItemWidget.getElement().getStyle().setProperty(&quot;backgroundColor&quot;, &quot;#d2e0a6&quot;);</span>
<span class="nc" id="L102">  }</span>

  private void addHandlers() {
<span class="nc" id="L105">    addMouseDownHandler(new MouseDownHandler() {</span>
      @Override
      public void onMouseDown(MouseDownEvent arg0) {
<span class="nc" id="L108">        select(getWidget());</span>
<span class="nc" id="L109">      }</span>
    });
<span class="nc" id="L111">    addTouchStartHandler(new TouchStartHandler() {</span>
      @Override
      public void onTouchStart(TouchStartEvent event) {
<span class="nc" id="L114">        select(getWidget());</span>
<span class="nc" id="L115">      }</span>
    });
<span class="nc" id="L117">  }</span>

  /**
   * Returns a new mock component for the palette item.
   * &lt;p&gt;
   * The caller is assumed to take ownership of the returned component.
   *
   * @return mock component
   */
  public MockComponent createMockComponent() {
<span class="nc" id="L127">    cacheInternalComponentPrototype();</span>

<span class="nc" id="L129">    MockComponent returnedComponentPrototype = componentPrototype;</span>
<span class="nc" id="L130">    componentPrototype = null;</span>
<span class="nc" id="L131">    return returnedComponentPrototype;</span>
  }

  /**
   * Returns whether this palette item creates components with a visual representation.
   */
  public boolean isVisibleComponent() {
<span class="nc" id="L138">    cacheInternalComponentPrototype();</span>
<span class="nc" id="L139">    return componentPrototype.isVisibleComponent();</span>
  }

  private void cacheInternalComponentPrototype() {
<span class="nc bnc" id="L143" title="All 2 branches missed.">    if (componentPrototype == null) {</span>
<span class="nc" id="L144">      componentPrototype = scd.createMockComponentFromPalette();</span>
    }
<span class="nc" id="L146">  }</span>

  // DragSource implementation

  @Override
  public void onDragStart() {
    // no action
<span class="nc" id="L153">  }</span>

  @Override
  public Widget createDragWidget(int x, int y) {
<span class="nc" id="L157">    MockComponent component = createMockComponent();</span>
    // Some components override getPreferredWidth/Height because getOffsetWidth/Height (which is
    // what MockComponentsUtil.getPreferredSizeOfDetachedWidget uses) returns very inaccurate
    // values. These components can give us the width/height even when the component is not
    // attached.
<span class="nc" id="L162">    int width = component.getPreferredWidth();</span>
<span class="nc" id="L163">    int height = component.getPreferredHeight();</span>
<span class="nc bnc" id="L164" title="All 4 branches missed.">    if (width &lt;= 0 &amp;&amp; height &lt;= 0) {</span>
      // Other components don't override getPreferredWidth/Height, which means that we'll get 0 (or
      // less) because the component is not attached. So, we use getPreferredSizeOfDetachedWidget.
<span class="nc" id="L167">      int[] size = MockComponentsUtil.getPreferredSizeOfDetachedWidget(component);</span>
<span class="nc" id="L168">      width = size[0];</span>
<span class="nc" id="L169">      height = size[1];</span>
    }
<span class="nc" id="L171">    component.setPixelSize(width, height);</span>
<span class="nc" id="L172">    DragSourceSupport.configureDragWidgetToAppearWithCursorAt(component, width / 2, height / 2);</span>
<span class="nc" id="L173">    return component;</span>
  }

  @Override
  public Widget getDragWidget() {
<span class="nc" id="L178">    return dragSourceSupport.getDragWidget();</span>
  }

  @Override
  public DropTarget[] getDropTargets() {
<span class="nc" id="L183">    return dropTargetProvider.getDropTargets();</span>
  }

  @Override
  public void onDragEnd() {
    // no action
<span class="nc" id="L189">  }</span>

  // Utility methods

  public String getName() {
<span class="nc" id="L194">    return scd.getName();</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>